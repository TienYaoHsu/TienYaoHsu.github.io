
[{"content":"ğŸš§ æœ‰ä¸€äº›æƒ³æ³•ï¼Œä½†é‚„æ²’æœ‰å¯¦ä½œï¼Œç´°ç¯€ä¹Ÿæœªå®Œå–„ã€‚\nè¨ˆç•« #\rå¯¦ä½œ #\r","date":"18 February 2025","externalUrl":null,"permalink":"/projects/","section":"TienYao@Tech","summary":"\u003cp\u003eğŸš§ æœ‰ä¸€äº›æƒ³æ³•ï¼Œä½†é‚„æ²’æœ‰å¯¦ä½œï¼Œç´°ç¯€ä¹Ÿæœªå®Œå–„ã€‚\u003c/p\u003e\n\r\n\r\n\u003ch2 class=\"relative group\"\u003eè¨ˆç•« \r\n    \u003cdiv id=\"%E8%A8%88%E7%95%AB\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#%E8%A8%88%E7%95%AB\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h2\u003e\r\n\u003cul\u003e\n\u003cli\u003e\u003cinput disabled=\"\" type=\"checkbox\"\u003e \u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\u003ch2 class=\"relative group\"\u003eå¯¦ä½œ \r\n    \u003cdiv id=\"%E5%AF%A6%E4%BD%9C\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#%E5%AF%A6%E4%BD%9C\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h2\u003e\r\n\u003cul\u003e\n\u003cli\u003e\u003cinput disabled=\"\" type=\"checkbox\"\u003e \u003c/li\u003e\n\u003c/ul\u003e","title":"Projects","type":"page"},{"content":"","date":"18 February 2025","externalUrl":null,"permalink":"/","section":"TienYao@Tech","summary":"","title":"TienYao@Tech","type":"page"},{"content":"","date":"18 February 2025","externalUrl":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"","date":"18 February 2025","externalUrl":null,"permalink":"/tags/freertos/","section":"Tags","summary":"","title":"FreeRTOS","type":"tags"},{"content":"","date":"18 February 2025","externalUrl":null,"permalink":"/posts/","section":"Posts","summary":"","title":"Posts","type":"posts"},{"content":"","date":"18 February 2025","externalUrl":null,"permalink":"/tags/rtos/","section":"Tags","summary":"","title":"RTOS","type":"tags"},{"content":"","date":"18 February 2025","externalUrl":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"},{"content":"","date":"18 February 2025","externalUrl":null,"permalink":"/tags/zynq/","section":"Tags","summary":"","title":"ZYNQ","type":"tags"},{"content":"","date":"18 February 2025","externalUrl":null,"permalink":"/categories/zynq/","section":"Categories","summary":"","title":"ZYNQ","type":"categories"},{"content":"\rğŸ¤ FreeRTOS Task é€šè¨Šæ–¹æ³• #\r1. Queue é€šè¨Šæ©Ÿåˆ¶ #\r1.1 åŸºæœ¬æ¦‚å¿µ #\rQueue æ˜¯ FreeRTOS ä¸­æœ€å¸¸ç”¨çš„é€šè¨Šæ©Ÿåˆ¶ï¼Œé©åˆç”¨æ–¼å‚³é€è³‡æ–™ã€‚\n1.2 ç¨‹å¼ç¯„ä¾‹ #\r#include \u0026#34;FreeRTOS.h\u0026#34; #include \u0026#34;task.h\u0026#34; #include \u0026#34;queue.h\u0026#34; #include \u0026#34;xil_printf.h\u0026#34; // For xil_printf QueueHandle_t dataQueue; void vSenderTask(void *pvParameters) { int32_t valueToSend = 0; while(1) { xQueueSend(dataQueue, \u0026amp;valueToSend, portMAX_DELAY); valueToSend++; vTaskDelay(pdMS_TO_TICKS(1000)); } } void vReceiverTask(void *pvParameters) { int32_t receivedValue; while(1) { if(xQueueReceive(dataQueue, \u0026amp;receivedValue, portMAX_DELAY) == pdPASS) { xil_printf(\u0026#34;æ¥æ”¶åˆ°çš„å€¼: %d\\r\\n\u0026#34;, receivedValue); } } } int main(void) { dataQueue = xQueueCreate(10, sizeof(int32_t)); if(dataQueue != NULL) { xTaskCreate(vSenderTask, \u0026#34;Sender\u0026#34;, configMINIMAL_STACK_SIZE, NULL, 1, NULL); xTaskCreate(vReceiverTask, \u0026#34;Receiver\u0026#34;, configMINIMAL_STACK_SIZE, NULL, 1, NULL); vTaskStartScheduler(); } while(1); } 2. Semaphore é€šè¨Šæ©Ÿåˆ¶ #\r2.1 Binary Semaphore #\ré©ç”¨æ–¼ç°¡å–®çš„åŒæ­¥å’Œäº‹ä»¶é€šçŸ¥ã€‚\n#include \u0026#34;FreeRTOS.h\u0026#34; #include \u0026#34;task.h\u0026#34; #include \u0026#34;semphr.h\u0026#34; #include \u0026#34;xil_printf.h\u0026#34; // For xil_printf SemaphoreHandle_t binarySemaphore; void vTask1(void *pvParameters) { while(1) { xil_printf(\u0026#34;Task1 å®Œæˆæ“ä½œ\\r\\n\u0026#34;); xSemaphoreGive(binarySemaphore); vTaskDelay(pdMS_TO_TICKS(1000)); } } void vTask2(void *pvParameters) { while(1) { if(xSemaphoreTake(binarySemaphore, portMAX_DELAY) == pdTRUE) { xil_printf(\u0026#34;Task2 æ”¶åˆ°é€šçŸ¥ä¸¦åŸ·è¡Œ\\r\\n\u0026#34;); } } } int main(void) { binarySemaphore = xSemaphoreCreateBinary(); if(binarySemaphore != NULL) { xTaskCreate(vTask1, \u0026#34;Task1\u0026#34;, configMINIMAL_STACK_SIZE, NULL, 1, NULL); xTaskCreate(vTask2, \u0026#34;Task2\u0026#34;, configMINIMAL_STACK_SIZE, NULL, 1, NULL); vTaskStartScheduler(); } while(1); } 3. Mutex äº’æ–¥æ©Ÿåˆ¶ #\r3.1 ä¿è­·å…±äº«è³‡æº #\rMutex ä¸»è¦ç”¨æ–¼ä¿è­·å…±äº«è³‡æºï¼Œé¿å…å¤šå€‹ task åŒæ™‚å­˜å–ã€‚\n#include \u0026#34;FreeRTOS.h\u0026#34; #include \u0026#34;task.h\u0026#34; #include \u0026#34;semphr.h\u0026#34; #include \u0026#34;xil_printf.h\u0026#34; // For xil_printf SemaphoreHandle_t mutexHandle; int shared_resource = 0; void vTask1(void *pvParameters) { while(1) { if(xSemaphoreTake(mutexHandle, portMAX_DELAY) == pdTRUE) { shared_resource++; xil_printf(\u0026#34;Task1: shared_resource = %d\\r\\n\u0026#34;, shared_resource); xSemaphoreGive(mutexHandle); } vTaskDelay(pdMS_TO_TICKS(1000)); } } int main(void) { mutexHandle = xSemaphoreCreateMutex(); if(mutexHandle != NULL) { xTaskCreate(vTask1, \u0026#34;Task1\u0026#34;, configMINIMAL_STACK_SIZE, NULL, 1, NULL); vTaskStartScheduler(); } while(1); } 4. Event Groups äº‹ä»¶çµ„ #\r4.1 å¤šäº‹ä»¶åŒæ­¥ #\ré©åˆéœ€è¦ç­‰å¾…å¤šå€‹æ¢ä»¶åŒæ™‚æˆç«‹çš„å ´æ™¯ã€‚\n#include \u0026#34;FreeRTOS.h\u0026#34; #include \u0026#34;task.h\u0026#34; #include \u0026#34;event_groups.h\u0026#34; #include \u0026#34;xil_printf.h\u0026#34; // For xil_printf #define EVENT_BIT_0 (1 \u0026lt;\u0026lt; 0) #define EVENT_BIT_1 (1 \u0026lt;\u0026lt; 1) #define ALL_EVENTS (EVENT_BIT_0 | EVENT_BIT_1) EventGroupHandle_t eventGroup; void vTask3(void *pvParameters) { EventBits_t bits; while(1) { bits = xEventGroupWaitBits(eventGroup, ALL_EVENTS, pdTRUE, pdTRUE, portMAX_DELAY); if((bits \u0026amp; ALL_EVENTS) == ALL_EVENTS) { xil_printf(\u0026#34;Task3 æ”¶åˆ°æ‰€æœ‰äº‹ä»¶\\r\\n\u0026#34;); } } } int main(void) { eventGroup = xEventGroupCreate(); if(eventGroup != NULL) { xTaskCreate(vTask3, \u0026#34;Task3\u0026#34;, configMINIMAL_STACK_SIZE, NULL, 1, NULL); vTaskStartScheduler(); } while(1); } 5. Task Notification #\r5.1 è¼•é‡ç´šé€šè¨Š #\ræœ€æ–°ä¸”æ•ˆèƒ½æœ€ä½³çš„é€šè¨Šæ–¹å¼ã€‚\n#include \u0026#34;FreeRTOS.h\u0026#34; #include \u0026#34;task.h\u0026#34; #include \u0026#34;xil_printf.h\u0026#34; // For xil_printf TaskHandle_t xTask2Handle = NULL; void vTask1(void *pvParameters) { while(1) { xTaskNotify(xTask2Handle, 0x01, eSetBits); xil_printf(\u0026#34;Task1 ç™¼é€é€šçŸ¥\\r\\n\u0026#34;); vTaskDelay(pdMS_TO_TICKS(1000)); } } void vTask2(void *pvParameters) { uint32_t ulNotificationValue; while(1) { if(xTaskNotifyWait(0x00, 0xFFFFFFFF, \u0026amp;ulNotificationValue, portMAX_DELAY) == pdTRUE) { xil_printf(\u0026#34;Task2 æ”¶åˆ°é€šçŸ¥\\r\\n\u0026#34;); } } } int main(void) { xTaskCreate(vTask1, \u0026#34;Task1\u0026#34;, configMINIMAL_STACK_SIZE, NULL, 1, NULL); xTaskCreate(vTask2, \u0026#34;Task2\u0026#34;, configMINIMAL_STACK_SIZE, NULL, 1, \u0026amp;xTask2Handle); vTaskStartScheduler(); while(1); } 6. ä½¿ç”¨å»ºè­° #\r6.1 é¸æ“‡åˆé©çš„é€šè¨Šæ–¹å¼ #\rç°¡å–®é€šè¨Šï¼šå„ªå…ˆä½¿ç”¨ Task Notification è³‡æ–™å‚³è¼¸ï¼šä½¿ç”¨ Queue è³‡æºä¿è­·ï¼šä½¿ç”¨ Mutex å¤šäº‹ä»¶åŒæ­¥ï¼šä½¿ç”¨ Event Groups 6.2 æ•ˆèƒ½è€ƒé‡ #\rTask Notification æ•ˆèƒ½æœ€å¥½ Queue é©åˆè³‡æ–™å‚³è¼¸ä½†é–‹éŠ·è¼ƒå¤§ Semaphore å’Œ Mutex é©åˆåŒæ­¥å ´æ™¯ ğŸ’¡ æç¤ºï¼š\nåœ¨ä½¿ç”¨é€™äº›æ©Ÿåˆ¶æ™‚ï¼Œè¦æ³¨æ„é¿å…æ­»é– æ­£ç¢ºè¨­å®šä»»å‹™å„ªå…ˆç´š è¬¹æ…ä½¿ç”¨é˜»å¡æ™‚é–“ å»ºè­°åœ¨é–‹ç™¼åˆæœŸå°±è¦åŠƒå¥½é€šè¨Šæ¶æ§‹ ","date":"18 February 2025","externalUrl":null,"permalink":"/posts/freertos_task_communication/","section":"Posts","summary":"\u003ch1 class=\"relative group\"\u003eğŸ¤ FreeRTOS Task é€šè¨Šæ–¹æ³• \r\n    \u003cdiv id=\"-freertos-task-%E9%80%9A%E8%A8%8A%E6%96%B9%E6%B3%95\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#-freertos-task-%E9%80%9A%E8%A8%8A%E6%96%B9%E6%B3%95\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h1\u003e\r\n\r\n\r\n\u003ch2 class=\"relative group\"\u003e1. Queue é€šè¨Šæ©Ÿåˆ¶ \r\n    \u003cdiv id=\"1-queue-%E9%80%9A%E8%A8%8A%E6%A9%9F%E5%88%B6\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#1-queue-%E9%80%9A%E8%A8%8A%E6%A9%9F%E5%88%B6\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h2\u003e\r\n\r\n\r\n\u003ch3 class=\"relative group\"\u003e1.1 åŸºæœ¬æ¦‚å¿µ \r\n    \u003cdiv id=\"11-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#11-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h3\u003e\r\n\u003cp\u003eQueue æ˜¯ FreeRTOS ä¸­æœ€å¸¸ç”¨çš„é€šè¨Šæ©Ÿåˆ¶ï¼Œé©åˆç”¨æ–¼å‚³é€è³‡æ–™ã€‚\u003c/p\u003e","title":"ğŸ¤ FreeRTOS Task é€šè¨Šæ–¹æ³•","type":"posts"},{"content":"\rğŸ› ï¸ åœ¨ Xilinx SDK 2018.3 ä¸­ä½¿ç”¨ FreeRTOS é–‹ç™¼å¤šå·¥ç³»çµ± ğŸ’» #\rå°ˆæ¡ˆç°¡ä»‹ #\ré€™ç¯‡æ–‡ç« è¦è·Ÿå¤§å®¶åˆ†äº«å¦‚ä½•åœ¨ Xilinx Software Development Kit (SDK) 2018.3 ç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨ FreeRTOS ä¾†é–‹ç™¼ä¸€å€‹å¤šå·¥ç³»çµ±ã€‚æˆ‘å€‘æœƒå¯¦ä½œä»»å‹™ç®¡ç†ã€UART ä¸­æ–·è™•ç†ä»¥åŠä»»å‹™é–“çš„é€šè¨Šæ©Ÿåˆ¶ã€‚\né–‹ç™¼ç’°å¢ƒ #\rXilinx SDK 2018.3 FreeRTOS å³æ™‚ä½œæ¥­ç³»çµ± é–‹ç™¼æ¿ï¼šXilinx Zynq-7000 ç³»åˆ— ç³»çµ±æ¶æ§‹ #\rç¨‹å¼è™•ç†æµç¨‹ #\rgraph TD\rA[ç³»çµ±é–‹æ©Ÿ] --\u0026gt; B[åˆå§‹åŒ–éšæ®µ]\rB --\u0026gt; C1[å»ºç«‹UARTä½‡åˆ—]\rB --\u0026gt; C2[å»ºç«‹UARTè™ŸèªŒ]\rB --\u0026gt; C3[åˆå§‹åŒ–UARTè£ç½®]\rC1 --\u0026gt; D[å»ºç«‹èµ·å§‹ä»»å‹™]\rC2 --\u0026gt; D\rC3 --\u0026gt; D\rD --\u0026gt; E[å•Ÿå‹•FreeRTOSæ’ç¨‹å™¨]\rE --\u0026gt; F[èµ·å§‹ä»»å‹™åŸ·è¡Œ]\rF --\u0026gt; G1[è¨­å®šUARTä¸­æ–·]\rF --\u0026gt; G2[å»ºç«‹UARTä¸­æ–·è™•ç†ä»»å‹™]\rF --\u0026gt; G3[å»ºç«‹Hiåˆ—å°ä»»å‹™]\rF --\u0026gt; G4[å»ºç«‹Helloåˆ—å°ä»»å‹™]\rG1 --\u0026gt; H[åˆªé™¤èµ·å§‹ä»»å‹™]\rG2 --\u0026gt; H\rG3 --\u0026gt; H\rG4 --\u0026gt; H\rH --\u0026gt; I[å¤šå·¥ä»»å‹™ä¸¦è¡ŒåŸ·è¡Œ]\rI --\u0026gt; J1[UARTä¸­æ–·è™•ç†]\rI --\u0026gt; J2[Hiä»»å‹™åŸ·è¡Œ]\rI --\u0026gt; J3[Helloä»»å‹™åŸ·è¡Œ]\rJ1 --\u0026gt; K[æ¥æ”¶æŒ‡ä»¤è™•ç†]\rK --\u0026gt; L1[ä»»å‹™æ§åˆ¶æŒ‡ä»¤]\rK --\u0026gt; L2[è¨ˆæ•¸å™¨é‡ç½®æŒ‡ä»¤]\rL1 --\u0026gt; I\rL2 --\u0026gt; I ä»»å‹™æ¶æ§‹ #\rç³»çµ±åŒ…å«ä»¥ä¸‹å¹¾å€‹ä¸»è¦ä»»å‹™ï¼š\nèµ·å§‹ä»»å‹™ï¼ˆå„ªå…ˆæ¬Šï¼š1ï¼‰ UARTä¸­æ–·è™•ç†ä»»å‹™ï¼ˆå„ªå…ˆæ¬Šï¼š2ï¼‰ Hiåˆ—å°ä»»å‹™ï¼ˆå„ªå…ˆæ¬Šï¼š2ï¼‰ Helloåˆ—å°ä»»å‹™ï¼ˆå„ªå…ˆæ¬Šï¼š2ï¼‰ é€šè¨Šæ©Ÿåˆ¶ #\rä½¿ç”¨ä½‡åˆ—ï¼ˆQueueï¼‰è™•ç† UART æ¥æ”¶çš„è³‡æ–™ ä½¿ç”¨è™ŸèªŒï¼ˆSemaphoreï¼‰è™•ç† UART å‚³é€åŒæ­¥ ä»»å‹™å„ªå…ˆæ¬Šç®¡ç† è™•ç†æµç¨‹èªªæ˜ #\råˆå§‹åŒ–éšæ®µ\nå»ºç«‹ UART é€šè¨Šç”¨çš„ä½‡åˆ—ï¼ˆ32 ä½å…ƒçµ„ï¼‰å’Œè™ŸèªŒ åˆå§‹åŒ– UART è£ç½®ï¼ˆé®‘ç‡ 115200ï¼‰ å»ºç«‹èµ·å§‹ä»»å‹™ï¼ˆå„ªå…ˆæ¬Š 1ï¼‰ ä»»å‹™å»ºç«‹éšæ®µ\nèµ·å§‹ä»»å‹™è² è²¬å»ºç«‹å…¶ä»–ä»»å‹™ è¨­å®š UART ä¸­æ–·è™•ç†æ©Ÿåˆ¶ å»ºç«‹ä¸‰å€‹å·¥ä½œä»»å‹™ï¼ˆå„ªå…ˆæ¬Š 2ï¼‰ å®Œæˆå¾Œè‡ªè¡Œåˆªé™¤ åŸ·è¡Œéšæ®µ\nUART ä¸­æ–·è™•ç†ä»»å‹™ç­‰å¾…æ¥æ”¶æŒ‡ä»¤ Hi ä»»å‹™æ¯ 500ms åŸ·è¡Œä¸€æ¬¡ Hello ä»»å‹™æ¯ 1200ms åŸ·è¡Œä¸€æ¬¡ é€é UART æŒ‡ä»¤å¯å‹•æ…‹æ§åˆ¶ä»»å‹™ æŒ‡ä»¤è™•ç†æµç¨‹\næ¥æ”¶å­—å…ƒå­˜å…¥æŒ‡ä»¤ç·©è¡å€ é‡åˆ°æ›è¡Œå­—å…ƒå°±è§£æåŸ·è¡ŒæŒ‡ä»¤ æ”¯æ´ä»»å‹™æš«åœ/ç¹¼çºŒ/è¨ˆæ•¸å™¨é‡ç½®ç­‰æ“ä½œ å®Œæ•´ç¨‹å¼ç¢¼å¯¦ç¾ #\r1. ä¸»ç¨‹å¼ (main_cpu0.c) #\r/******************************************************************************* * æª”æ¡ˆåç¨±: main_cpu0.c * èªªæ˜: ä¸»ç¨‹å¼é€²å…¥é»ï¼Œè² è²¬åˆå§‹åŒ–UARTåŠå»ºç«‹FreeRTOSå·¥ä½œä»»å‹™ * ä½œè€…: TienYao *******************************************************************************/ #include \u0026lt;stdio.h\u0026gt; /* FreeRTOSç›¸é—œæ¨™é ­æª” */ #include \u0026#34;FreeRTOS.h\u0026#34; #include \u0026#34;task.h\u0026#34; #include \u0026#34;queue.h\u0026#34; #include \u0026#34;semphr.h\u0026#34; /* Xilinxç›¸é—œæ¨™é ­æª” */ #include \u0026#34;xparameters.h\u0026#34; #include \u0026#34;xuartps.h\u0026#34; #include \u0026#34;xscugic.h\u0026#34; /* ä½¿ç”¨è€…è‡ªè¨‚æ¨™é ­æª” */ #include \u0026#34;user_task.h\u0026#34; #include \u0026#34;uart_intr.h\u0026#34; int main() { /* è®Šæ•¸å®£å‘Š */ int status; XUartPs_Config *uartPsConfig; /* å»ºç«‹UARTé€šè¨Šç”¨çš„ä½‡åˆ—å’Œè™ŸèªŒ */ xUartRxQueue = xQueueCreate(32, sizeof(uint8_t)); xUartTxSemaphore = xSemaphoreCreateBinary(); /* æª¢æŸ¥ä½‡åˆ—å’Œè™ŸèªŒæ˜¯å¦å»ºç«‹æˆåŠŸ */ if (xUartRxQueue == NULL || xUartTxSemaphore == NULL) { return XST_FAILURE; } /* åˆå§‹åŒ–UART */ status = uart_init(uartPsConfig); if(status != XST_SUCCESS) { printf(\u0026#34;UARTåˆå§‹åŒ–å¤±æ•—\\n\u0026#34;); return XST_FAILURE; } /* å»ºç«‹èµ·å§‹ä»»å‹™ */ xTaskCreate( (TaskFunction_t)start_task, (const char*)\u0026#34;start_task\u0026#34;, (uint16_t)START_STK_SIZE, (void*)NULL, (UBaseType_t)START_TASK_PRIO, (TaskHandle_t*)\u0026amp;StartTask_Handler ); /* å•Ÿå‹•FreeRTOSæ’ç¨‹å™¨ */ vTaskStartScheduler(); /* æ°¸ä¹…è¿´åœˆ */ while(1); return 0; } 2. UARTä¸­æ–·è™•ç† (uart_intr.h) #\r/******************************************************************************* * æª”æ¡ˆåç¨±: uart_intr.h * èªªæ˜: UARTä¸­æ–·ç›¸é—œå®šç¾©èˆ‡å‡½å¼å®£å‘Š * ä½œè€…: TienYao *******************************************************************************/ #ifndef SRC_UART_INTR_H_ #define SRC_UART_INTR_H_ #include \u0026#34;xparameters.h\u0026#34; #include \u0026#34;xuartps.h\u0026#34; #include \u0026#34;xscugic.h\u0026#34; /* UARTèˆ‡ä¸­æ–·æ§åˆ¶å™¨è£ç½®IDå®šç¾© */ #define UART_0_DEVICE_ID XPAR_PS7_UART_0_DEVICE_ID #define SCUGIC_0_DEVICE_ID XPAR_PS7_SCUGIC_0_DEVICE_ID #define XUARTPS_0_INTR XPAR_XUARTPS_0_INTR /* UARTè£ç½®å¯¦é«” */ XUartPs uartPs; /* å‡½å¼åŸå‹å®£å‘Š */ int uart_init(XUartPs_Config *); #endif /* SRC_UART_INTR_H_ */ 3. UARTä¸­æ–·è™•ç†å¯¦ä½œ (uart_intr.c) #\r/******************************************************************************* * æª”æ¡ˆåç¨±: uart_intr.c * èªªæ˜: UARTä¸­æ–·åˆå§‹åŒ–èˆ‡è¨­å®š * ä½œè€…: TienYao *******************************************************************************/ #include \u0026#34;uart_intr.h\u0026#34; int uart_init(XUartPs_Config *uartPsConfig) { int status; /* æŸ¥æ‰¾ä¸¦å–å¾—UARTè£ç½®è¨­å®š */ uartPsConfig = XUartPs_LookupConfig(UART_0_DEVICE_ID); if(uartPsConfig == NULL) { return XST_FAILURE; } /* åˆå§‹åŒ–UARTè£ç½® */ status = XUartPs_CfgInitialize(\u0026amp;uartPs, uartPsConfig, uartPsConfig-\u0026gt;BaseAddress); if(status != XST_SUCCESS) { return XST_FAILURE; } /* è¨­å®šUARTé‹ä½œæ¨¡å¼ã€é®‘ç‡åŠFIFOè‡¨ç•Œå€¼ */ XUartPs_SetOptions(\u0026amp;uartPs, XUARTPS_OPER_MODE_NORMAL); XUartPs_SetBaudRate(\u0026amp;uartPs, 115200); XUartPs_SetFifoThreshold(\u0026amp;uartPs, 1); return XST_SUCCESS; } 4. ä½¿ç”¨è€…ä»»å‹™å®šç¾© (user_task.h) #\r/******************************************************************************* * æª”æ¡ˆåç¨±: user_task.h * èªªæ˜: FreeRTOSä»»å‹™ç›¸é—œå®šç¾©èˆ‡å‡½å¼å®£å‘Š * ä½œè€…: TienYao *******************************************************************************/ #ifndef SRC_USER_TASK_H_ #define SRC_USER_TASK_H_ #include \u0026#34;FreeRTOS.h\u0026#34; #include \u0026#34;task.h\u0026#34; #include \u0026#34;queue.h\u0026#34; #include \u0026#34;semphr.h\u0026#34; #include \u0026#34;xscugic.h\u0026#34; /* ä¸­æ–·æ§åˆ¶å™¨å¯¦é«” * æ­¤è®Šæ•¸ç‚ºXilinxé€šç”¨ä¸­æ–·æ§åˆ¶å™¨(GIC)çš„å¯¦é«” * externé—œéµå­—è¡¨ç¤ºæ­¤è®Šæ•¸åœ¨å…¶ä»–æª”æ¡ˆä¸­å®šç¾© * ç”¨æ–¼è™•ç†æ‰€æœ‰ç³»çµ±ä¸­æ–·ï¼ŒåŒ…å«UARTä¸­æ–· */ extern XScuGic xInterruptController; /* UARTé€šè¨Šç”¨ä½‡åˆ—å’Œè™ŸèªŒ */ QueueHandle_t xUartRxQueue; SemaphoreHandle_t xUartTxSemaphore; /* èµ·å§‹ä»»å‹™ç›¸é—œå®šç¾© */ #define START_TASK_PRIO 1 #define START_STK_SIZE 128 TaskHandle_t StartTask_Handler; void start_task(); /* UARTä¸­æ–·è™•ç†ä»»å‹™ç›¸é—œå®šç¾© */ #define UART_INT_TASK_PRIO 2 #define UART_INT_STK_SIZE 250 TaskHandle_t uart_int_task_handler; void uart_int_task(); /* Hiåˆ—å°ä»»å‹™ç›¸é—œå®šç¾© */ #define PRINT_HI_TASK_PRIO 2 #define PRINT_HI_STK_SIZE 250 TaskHandle_t print_hi_Task_handler; void print_hi_task(); /* Helloåˆ—å°ä»»å‹™ç›¸é—œå®šç¾© */ #define PRINT_HELLO_TASK_PRIO 2 #define PRINT_HELLO_STK_SIZE 250 TaskHandle_t print_hello_Task_handler; void print_hello_task(); /* UARTä¸­æ–·è™•ç†å‡½å¼ */ void uart_intr_handler(void *); #endif /* SRC_USER_TASK_H_ */ 5. ä½¿ç”¨è€…ä»»å‹™å¯¦ä½œ (user_task.c) #\r/******************************************************************************* * æª”æ¡ˆåç¨±: user_task.c * èªªæ˜: FreeRTOSä»»å‹™å¯¦ä½œï¼ŒåŒ…å«UARTä¸­æ–·è™•ç†ã€Hi/Helloåˆ—å°ä»»å‹™ç­‰ * ä½œè€…: TienYao *******************************************************************************/ #include \u0026#34;user_task.h\u0026#34; #include \u0026#34;uart_intr.h\u0026#34; #include \u0026lt;stdio.h\u0026gt; /* Hiå’ŒHelloä»»å‹™çš„è¨ˆæ•¸å™¨ */ unsigned hiLoop = 0; /* Hiä»»å‹™çš„åˆ—å°æ¬¡æ•¸è¨ˆæ•¸å™¨ */ unsigned helloLoop = 0; /* Helloä»»å‹™çš„åˆ—å°æ¬¡æ•¸è¨ˆæ•¸å™¨ */ /** * @brief UARTä¸­æ–·è™•ç†å‡½å¼ * @param call_back_ref: UARTè£ç½®æŒ‡æ¨™ * @note è™•ç†UARTæ¥æ”¶å’Œå‚³é€ä¸­æ–· */ void uart_intr_handler(void *call_back_ref) { XUartPs *UartPs = (XUartPs *)call_back_ref; uint32_t IsrStatus = XUartPs_ReadReg(UartPs-\u0026gt;Config.BaseAddress, XUARTPS_ISR_OFFSET); BaseType_t xHigherPriorityTaskWoken = pdFALSE; /* è™•ç†æ¥æ”¶ä¸­æ–· */ if (IsrStatus \u0026amp; XUARTPS_IXR_RXOVR) { uint8_t ReceivedChar = XUartPs_ReadReg(UartPs-\u0026gt;Config.BaseAddress, XUARTPS_FIFO_OFFSET); xQueueSendFromISR(xUartRxQueue, \u0026amp;ReceivedChar, \u0026amp;xHigherPriorityTaskWoken); } /* è™•ç†å‚³é€ä¸­æ–· */ if (IsrStatus \u0026amp; XUARTPS_IXR_TXEMPTY) { xSemaphoreGiveFromISR(xUartTxSemaphore, \u0026amp;xHigherPriorityTaskWoken); } /* æ¸…é™¤ä¸­æ–·ç‹€æ…‹ä¸¦æª¢æŸ¥æ˜¯å¦éœ€è¦åˆ‡æ›ä»»å‹™ */ XUartPs_WriteReg(UartPs-\u0026gt;Config.BaseAddress, XUARTPS_ISR_OFFSET, IsrStatus); portYIELD_FROM_ISR(xHigherPriorityTaskWoken); } /** * @brief UARTä¸­æ–·è™•ç†ä»»å‹™ * @param pvParameters: ä»»å‹™åƒæ•¸ï¼ˆæœªä½¿ç”¨ï¼‰ * @note è™•ç†UARTæ¥æ”¶åˆ°çš„æŒ‡ä»¤ */ void uart_int_task(void *pvParameters) { uint8_t ReceivedChar; char cmd[16]; u8 cnt = 0; while (1) { /* ç­‰å¾…æ¥æ”¶å­—å…ƒ */ if (xQueueReceive(xUartRxQueue, \u0026amp;ReceivedChar, portMAX_DELAY) == pdTRUE) { if(ReceivedChar == \u0026#39;\\r\u0026#39;) { /* æ”¶åˆ°æ›è¡Œå­—å…ƒï¼Œè¡¨ç¤ºæŒ‡ä»¤çµæŸ */ xil_printf(\u0026#34;%s\\n\u0026#34;, cmd); /* è§£æä¸¦åŸ·è¡ŒæŒ‡ä»¤ */ if(!strcmp(\u0026#34;stop_hi\u0026#34;, cmd)) { vTaskSuspend(print_hi_Task_handler); /* æš«åœHiä»»å‹™ */ } else if(!strcmp(\u0026#34;go_hi\u0026#34;, cmd)) { vTaskResume(print_hi_Task_handler); /* ç¹¼çºŒHiä»»å‹™ */ } else if(!strcmp(\u0026#34;clear_go_loop\u0026#34;, cmd)) { hiLoop = 0; /* é‡ç½®Hiè¨ˆæ•¸å™¨ */ } else if (!strcmp(\u0026#34;stop_hello\u0026#34;, cmd)) { vTaskSuspend(print_hi_Task_handler); /* æš«åœHelloä»»å‹™ */ } else if(!strcmp(\u0026#34;go_hello\u0026#34;, cmd)) { vTaskResume(print_hi_Task_handler); /* ç¹¼çºŒHelloä»»å‹™ */ } else if(!strcmp(\u0026#34;clear_hello_loop\u0026#34;, cmd)) { helloLoop = 0; /* é‡ç½®Helloè¨ˆæ•¸å™¨ */ } else { printf(\u0026#34;æœªçŸ¥æŒ‡ä»¤\\n\u0026#34;); /* æœªçŸ¥æŒ‡ä»¤ */ } cnt = 0; } else { cmd[cnt] = ReceivedChar; /* å„²å­˜æŒ‡ä»¤å­—å…ƒ */ cnt++; cmd[cnt] = \u0026#39;\\0\u0026#39;; /* å­—ä¸²çµå°¾ */ } } } } /** * @brief Hiåˆ—å°ä»»å‹™ * @note æ¯500æ¯«ç§’åˆ—å°ä¸€æ¬¡Hi */ void print_hi_task() { while(1) { vTaskDelay(500); /* å»¶é²500æ¯«ç§’ */ printf(\u0026#34;Hi æ¬¡æ•¸ %d\\n\u0026#34;, hiLoop++); /* åˆ—å°Hiå’Œè¨ˆæ•¸ */ } } /** * @brief Helloåˆ—å°ä»»å‹™ * @note æ¯1200æ¯«ç§’åˆ—å°ä¸€æ¬¡Hello */ void print_hello_task() { while(1) { vTaskDelay(1200); /* å»¶é²1200æ¯«ç§’ */ printf(\u0026#34;Hello æ¬¡æ•¸ %d\\n\u0026#34;, helloLoop++); /* åˆ—å°Helloå’Œè¨ˆæ•¸ */ } } /** * @brief èµ·å§‹ä»»å‹™ * @note åˆå§‹åŒ–ç³»çµ±ä¸¦å»ºç«‹å…¶ä»–ä»»å‹™ */ void start_task() { taskENTER_CRITICAL(); /* é€²å…¥è‡¨ç•Œå€ */ /* è¨­å®šUARTä¸­æ–· */ XScuGic_Connect(\u0026amp;xInterruptController, XUARTPS_0_INTR, (Xil_InterruptHandler) uart_intr_handler, (void *)\u0026amp;uartPs); XUartPs_SetInterruptMask(\u0026amp;uartPs, XUARTPS_IXR_RXOVR); Xil_ExceptionInit(); XScuGic_Enable(\u0026amp;xInterruptController, XUARTPS_0_INTR); /* å»ºç«‹UARTä¸­æ–·è™•ç†ä»»å‹™ */ xTaskCreate( (TaskFunction_t)uart_int_task, (const char*)\u0026#34;uart_int_task\u0026#34;, (uint16_t)UART_INT_STK_SIZE, (void*)NULL, (UBaseType_t)UART_INT_TASK_PRIO, (TaskHandle_t*)\u0026amp;uart_int_task_handler ); /* å»ºç«‹Hiåˆ—å°ä»»å‹™ */ xTaskCreate( (TaskFunction_t)print_hi_task, (const char*)\u0026#34;print_hi_task\u0026#34;, (uint16_t)PRINT_HI_STK_SIZE, (void*)NULL, (UBaseType_t)PRINT_HI_TASK_PRIO, (TaskHandle_t*)\u0026amp;print_hi_Task_handler ); /* å»ºç«‹Helloåˆ—å°ä»»å‹™ */ xTaskCreate( (TaskFunction_t)print_hello_task, (const char*)\u0026#34;print_hello_task\u0026#34;, (uint16_t)PRINT_HELLO_STK_SIZE, (void*)NULL, (UBaseType_t)PRINT_HELLO_TASK_PRIO, (TaskHandle_t*)\u0026amp;print_hello_Task_handler ); vTaskDelete(StartTask_Handler); /* åˆªé™¤èµ·å§‹ä»»å‹™ */ taskEXIT_CRITICAL(); /* é€€å‡ºè‡¨ç•Œå€ */ } ç‰¹è‰²åŠŸèƒ½ #\r1. å‹•æ…‹ä»»å‹™æ§åˆ¶ #\rå¯ä»¥é€é UART æŒ‡ä»¤å‹•æ…‹æ§åˆ¶ä»»å‹™çš„æš«åœå’Œç¹¼çºŒ æ”¯æ´è¨ˆæ•¸å™¨é‡ç½®åŠŸèƒ½ ä»»å‹™å„ªå…ˆæ¬Šå¯èª¿æ•´ 2. ä¸­æ–·è™•ç†æ©Ÿåˆ¶ #\rä½¿ç”¨ä½‡åˆ—è™•ç† UART æ¥æ”¶ä¸­æ–· ä½¿ç”¨è™ŸèªŒè™•ç† UART å‚³é€åŒæ­¥ æ”¯æ´é«˜å„ªå…ˆæ¬Šä»»å‹™æ¶ä½” ä½¿ç”¨èªªæ˜ #\rUART æŒ‡ä»¤åˆ—è¡¨ #\rstop_hiï¼šæš«åœ Hi ä»»å‹™ go_hiï¼šç¹¼çºŒ Hi ä»»å‹™ clear_go_loopï¼šé‡ç½® Hi è¨ˆæ•¸å™¨ stop_helloï¼šæš«åœ Hello ä»»å‹™ go_helloï¼šç¹¼çºŒ Hello ä»»å‹™ clear_hello_loopï¼šé‡ç½® Hello è¨ˆæ•¸å™¨ æŠ€è¡“é‡é» #\rFreeRTOS ä»»å‹™ç®¡ç† ä¸­æ–·è™•ç† ä»»å‹™é–“é€šè¨Šï¼ˆä½‡åˆ—ã€è™ŸèªŒï¼‰ è‡¨ç•Œå€ä¿è­· UART é€šè¨Šå”å®š æ³¨æ„äº‹é … #\råœ¨ Zynq-7000 ä¸Šä½¿ç”¨ FreeRTOS åŠ å…¥ UART ä¸­æ–·åŠŸèƒ½æ™‚ï¼Œè¦ç‰¹åˆ¥æ³¨æ„ä»¥ä¸‹å¹¾é»ï¼š\nä¸­æ–·æ§åˆ¶å™¨åˆå§‹åŒ–\nFreeRTOS BSP è£¡çš„ portZynq7000.c å·²ç¶“å®šç¾©å¥½å…¨åŸŸä¸­æ–·æ§åˆ¶å™¨ XScuGic xInterruptController PS åªæœ‰ä¸€å€‹ä¸­æ–·æ§åˆ¶å™¨è³‡æºï¼Œå¦‚æœè‡ªå·±é‡æ–°åˆå§‹åŒ–ä¸­æ–·æ§åˆ¶å™¨ï¼ˆç›´æ¥ä½¿ç”¨ FreeRTOS BSP è£¡çš„ portZynq7000.c å®šç¾©çš„ä¸­æ–·æ§åˆ¶å™¨å°±å¥½ï¼‰ï¼Œå¯èƒ½æœƒå°è‡´ä»»å‹™ç„¡æ³•æ­£å¸¸åŸ·è¡Œ ä¸€å®šè¦ä½¿ç”¨ extern XScuGic xInterruptController å®£å‘Šé€™å€‹å…¨åŸŸè®Šæ•¸ å…¶å®ƒå°±ç”¨ Xilinx çš„æ–¹æ³•é€²è¡Œ config èˆ‡ connect è¨­å®šå°±å¯ä»¥äº† åˆå§‹åŒ–æ™‚åº\nä¸­æ–·åˆå§‹åŒ–ä¸€å®šè¦åœ¨åŸ·è¡Œç·’å•Ÿå‹•å‰å®Œæˆ ä¸èƒ½åœ¨ main å‡½å¼ä¸­åˆå§‹åŒ–ä¸­æ–· è¦åœ¨ vTaskStartScheduler() ä¹‹å‰å®Œæˆæ‰€æœ‰ä¸­æ–·è¨­å®š æœªä¾†å±•æœ› #\råŠ å…¥æ›´å¤šä»»å‹™ç®¡ç†åŠŸèƒ½ å„ªåŒ–ä¸­æ–·è™•ç†æ©Ÿåˆ¶ å¢åŠ æ›´å¤šé€šè¨Šä»‹é¢æ”¯æ´ åŠ å…¥ä»»å‹™ç›£æ§åŠŸèƒ½ ","date":"11 February 2025","externalUrl":null,"permalink":"/posts/zynq_freertos_multitask/","section":"Posts","summary":"\u003ch1 class=\"relative group\"\u003eğŸ› ï¸ åœ¨ Xilinx SDK 2018.3 ä¸­ä½¿ç”¨ FreeRTOS é–‹ç™¼å¤šå·¥ç³»çµ± ğŸ’» \r\n    \u003cdiv id=\"-%E5%9C%A8-xilinx-sdk-20183-%E4%B8%AD%E4%BD%BF%E7%94%A8-freertos-%E9%96%8B%E7%99%BC%E5%A4%9A%E5%B7%A5%E7%B3%BB%E7%B5%B1-\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#-%E5%9C%A8-xilinx-sdk-20183-%E4%B8%AD%E4%BD%BF%E7%94%A8-freertos-%E9%96%8B%E7%99%BC%E5%A4%9A%E5%B7%A5%E7%B3%BB%E7%B5%B1-\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h1\u003e\r\n\r\n\r\n\u003ch2 class=\"relative group\"\u003eå°ˆæ¡ˆç°¡ä»‹ \r\n    \u003cdiv id=\"%E5%B0%88%E6%A1%88%E7%B0%A1%E4%BB%8B\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#%E5%B0%88%E6%A1%88%E7%B0%A1%E4%BB%8B\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h2\u003e\r\n\u003cp\u003eé€™ç¯‡æ–‡ç« è¦è·Ÿå¤§å®¶åˆ†äº«å¦‚ä½•åœ¨ Xilinx Software Development Kit (SDK) 2018.3 ç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨ FreeRTOS ä¾†é–‹ç™¼ä¸€å€‹å¤šå·¥ç³»çµ±ã€‚æˆ‘å€‘æœƒå¯¦ä½œä»»å‹™ç®¡ç†ã€UART ä¸­æ–·è™•ç†ä»¥åŠä»»å‹™é–“çš„é€šè¨Šæ©Ÿåˆ¶ã€‚\u003c/p\u003e","title":"ğŸ› ï¸ åœ¨ Xilinx SDK 2018.3 ä¸­ä½¿ç”¨ FreeRTOS é–‹ç™¼å¤šå·¥ç³»çµ± ğŸ’»","type":"posts"},{"content":"\rğŸ¢ ROS2 å·¡é‚æœå‹™ç¯€é»é–‹ç™¼æ•™å­¸(ä½¿ç”¨ Parameters) #\rå‰è¨€ #\råœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å€‘å°‡åŸºæ–¼ä¹‹å‰çš„å·¡é‚æœå‹™ç¯€é»ï¼ŒåŠ å…¥ ROS2 çš„åƒæ•¸åŠŸèƒ½ã€‚é€éåƒæ•¸æœå‹™ï¼Œæˆ‘å€‘å¯ä»¥å‹•æ…‹åœ°ä¿®æ”¹å’Œç›£æ§ç¯€é»çš„è¡Œç‚ºï¼Œä½¿ç³»çµ±æ›´åŠ éˆæ´»ã€‚é€™å€‹å°ˆæ¡ˆå±•ç¤ºäº†å¦‚ä½•åœ¨ ROS2 ä¸­å¯¦ç¾åƒæ•¸çš„è¨­å®šå’Œä½¿ç”¨ï¼Œä»¥åŠå¦‚ä½•çµåˆæœå‹™ç«¯ï¼ˆServerï¼‰å’Œå®¢æˆ¶ç«¯ï¼ˆClientï¼‰çš„é€šä¿¡ã€‚\nå°ˆæ¡ˆæ¶æ§‹ #\r1. æª”æ¡ˆçµæ§‹ #\rpatrol_parameters/\râ”œâ”€â”€ CMakeLists.txt # æ§‹å»ºé…ç½®æ–‡ä»¶\râ”œâ”€â”€ package.xml # åŒ…é…ç½®æ–‡ä»¶\râ”œâ”€â”€ srv/\râ”‚ â””â”€â”€ Patrol.srv # å·¡é‚æœå‹™ä»‹é¢å®šç¾©\râ”œâ”€â”€ src/\râ”œâ”€â”€ service_parameters.cpp # åƒæ•¸æœå‹™ç«¯ç¯€é»å¯¦ç¾\râ””â”€â”€ client_parameters.cpp # åƒæ•¸å®¢æˆ¶ç«¯ç¯€é»å¯¦ç¾ 2. å®Œæ•´ç¨‹å¼ç¢¼å¯¦ç¾ #\r2.1 åƒæ•¸å®¢æˆ¶ç«¯ç¨‹å¼ç¢¼ (client_parameters.cpp) #\r// ===== åŒ…å«å¿…è¦çš„æ¨™é ­æª” ===== #include \u0026#34;rclcpp/rclcpp.hpp\u0026#34; // ROS2 C++ å®¢æˆ¶ç«¯åº«,æä¾›ROS2åŸºæœ¬åŠŸèƒ½ #include \u0026#34;patrol/srv/patrol.hpp\u0026#34; // è‡ªå®šç¾©çš„å·¡é‚æœå‹™ä»‹é¢ #include \u0026#34;rclcpp/time.hpp\u0026#34; // ROS2 æ™‚é–“ç›¸é—œåŠŸèƒ½,ç”¨æ–¼è™•ç†æ™‚é–“ #include \u0026lt;random\u0026gt; // C++ éš¨æ©Ÿæ•¸ç”Ÿæˆåº«,ç”¨æ–¼ç”Ÿæˆéš¨æ©Ÿç›®æ¨™ä½ç½® #include \u0026#34;rcl_interfaces/msg/parameter.hpp\u0026#34; // ROS2 åƒæ•¸è¨Šæ¯,ç”¨æ–¼åƒæ•¸å®šç¾© #include \u0026#34;rcl_interfaces/msg/parameter_value.hpp\u0026#34; // ROS2 åƒæ•¸å€¼è¨Šæ¯,ç”¨æ–¼è¨­ç½®åƒæ•¸å€¼ #include \u0026#34;rcl_interfaces/msg/parameter_type.hpp\u0026#34; // ROS2 åƒæ•¸é¡å‹è¨Šæ¯,å®šç¾©åƒæ•¸é¡å‹ #include \u0026#34;rcl_interfaces/srv/set_parameters.hpp\u0026#34; // ROS2 è¨­ç½®åƒæ•¸æœå‹™,ç”¨æ–¼å‹•æ…‹ä¿®æ”¹åƒæ•¸ /** * @brief å®¢æˆ¶ç«¯ç¯€é»é¡åˆ¥ * * æ­¤é¡åˆ¥ç¹¼æ‰¿è‡ª rclcpp::Node,å¯¦ç¾äº†ä¸€å€‹ROS2å®¢æˆ¶ç«¯ç¯€é» * ä¸»è¦åŠŸèƒ½æ˜¯ç™¼é€å·¡é‚è«‹æ±‚å’Œæ›´æ–°ç›®æ¨™åƒæ•¸ */ class Client: public rclcpp::Node { private: rclcpp::Client\u0026lt;patrol::srv::Patrol\u0026gt;::SharedPtr client_; // å·¡é‚æœå‹™å®¢æˆ¶ç«¯,ç”¨æ–¼ç™¼é€å·¡é‚è«‹æ±‚ std::shared_ptr\u0026lt;patrol::srv::Patrol::Request\u0026gt; request_; // æœå‹™è«‹æ±‚ç‰©ä»¶,å„²å­˜è«‹æ±‚å…§å®¹ rclcpp::TimerBase::SharedPtr timer_; // å®šæ™‚å™¨,ç”¨æ–¼å®šæœŸç™¼é€è«‹æ±‚ public: Client(std::string nodeName); // å»ºæ§‹å‡½æ•¸,åˆå§‹åŒ–ç¯€é» ~Client() = default; // é è¨­è§£æ§‹å‡½æ•¸ void cb(); // å®šæ™‚å›èª¿å‡½æ•¸,è™•ç†å®šæ™‚ä»»å‹™ std::shared_ptr\u0026lt;rcl_interfaces::srv::SetParameters::Response\u0026gt; call_set_parameters(rcl_interfaces::msg::Parameter \u0026amp;parameter); // è¨­ç½®åƒæ•¸å‡½æ•¸ void update_target_parameters(double x, double y); // æ›´æ–°ç›®æ¨™ä½ç½®åƒæ•¸çš„å‡½æ•¸ }; /** * @brief å®¢æˆ¶ç«¯ç¯€é»å»ºæ§‹å‡½æ•¸ * @param nodeName ç¯€é»åç¨± * * åˆå§‹åŒ–ç¯€é»,å‰µå»ºæœå‹™å®¢æˆ¶ç«¯å’Œå®šæ™‚å™¨ */ Client::Client(std::string nodeName): Node(nodeName) { // å‰µå»ºå·¡é‚æœå‹™å®¢æˆ¶ç«¯,æœå‹™åç‚º\u0026#34;patrol\u0026#34; this-\u0026gt;client_ = this-\u0026gt;create_client\u0026lt;patrol::srv::Patrol\u0026gt;(\u0026#34;patrol\u0026#34;); RCLCPP_INFO(this-\u0026gt;get_logger(),\u0026#34;Client has been created\u0026#34;); // è¼¸å‡ºå‰µå»ºæˆåŠŸæ—¥èªŒ // å‰µå»ºå®šæ™‚å™¨,æ¯20ç§’è§¸ç™¼ä¸€æ¬¡å›èª¿å‡½æ•¸ this-\u0026gt;timer_ = this-\u0026gt;create_wall_timer(std::chrono::seconds(20), std::bind(\u0026amp;Client::cb, this)); } /** * @brief æ›´æ–°ç›®æ¨™åƒæ•¸å‡½æ•¸ * @param x Xè»¸ç›®æ¨™åº§æ¨™ * @param y Yè»¸ç›®æ¨™åº§æ¨™ * * æ›´æ–°æœå‹™ç¯€é»çš„ç›®æ¨™ä½ç½®åƒæ•¸ */ void Client::update_target_parameters(double x, double y) { // === è¨­ç½® X åº§æ¨™åƒæ•¸ === auto param = rcl_interfaces::msg::Parameter(); param.name = \u0026#34;Target_X\u0026#34;; auto param_value = rcl_interfaces::msg::ParameterValue(); param_value.type = rcl_interfaces::msg::ParameterType::PARAMETER_DOUBLE; param_value.double_value = x; param.value = param_value; auto response = call_set_parameters(param); // æª¢æŸ¥Xåº§æ¨™åƒæ•¸è¨­ç½®çµæœ if(response == nullptr) { RCLCPP_ERROR(this-\u0026gt;get_logger(), \u0026#34;Failed to update target parameters\u0026#34;); } else { for(auto result: response-\u0026gt;results) { if(result.successful) { RCLCPP_INFO(this-\u0026gt;get_logger(), \u0026#34;Target parameters updated successfully\u0026#34;); } else { RCLCPP_ERROR(this-\u0026gt;get_logger(), \u0026#34;Failed to update target parameters\u0026#34;); } } } // === è¨­ç½® Y åº§æ¨™åƒæ•¸ === param.name = \u0026#34;Target_Y\u0026#34;; param_value.double_value = y; param.value = param_value; response = call_set_parameters(param); // æª¢æŸ¥Yåº§æ¨™åƒæ•¸è¨­ç½®çµæœ if(response == nullptr) { RCLCPP_ERROR(this-\u0026gt;get_logger(), \u0026#34;Failed to update target parameters\u0026#34;); } else { for(auto result: response-\u0026gt;results) { if(result.successful) { RCLCPP_INFO(this-\u0026gt;get_logger(), \u0026#34;Target parameters updated successfully\u0026#34;); } } } } /** * @brief è¨­ç½®åƒæ•¸æœå‹™èª¿ç”¨å‡½æ•¸ * @param parameter è¦è¨­ç½®çš„åƒæ•¸ * @return åƒæ•¸è¨­ç½®éŸ¿æ‡‰ * * èª¿ç”¨æœå‹™ç¯€é»çš„åƒæ•¸è¨­ç½®æœå‹™ */ std::shared_ptr\u0026lt;rcl_interfaces::srv::SetParameters::Response\u0026gt; Client::call_set_parameters(rcl_interfaces::msg::Parameter \u0026amp;parameter) { // å‰µå»ºåƒæ•¸å®¢æˆ¶ç«¯,é€£æ¥åˆ°æœå‹™ç¯€é»çš„åƒæ•¸æœå‹™ auto param_client = this-\u0026gt;create_client\u0026lt;rcl_interfaces::srv::SetParameters\u0026gt;(\u0026#34;/service_parameters_node/set_parameters\u0026#34;); // ç­‰å¾…æœå‹™å¯ç”¨,æ¯ç§’æª¢æŸ¥ä¸€æ¬¡ while(!param_client-\u0026gt;wait_for_service(std::chrono::seconds(1))){ if(!rclcpp::ok()){ RCLCPP_ERROR(this-\u0026gt;get_logger(),\u0026#34;Interrupted while waiting for the service. Exiting.\u0026#34;); return nullptr; } RCLCPP_INFO(this-\u0026gt;get_logger(), \u0026#34;Service not available, waiting again...\u0026#34;); } // ç™¼é€åƒæ•¸è¨­ç½®è«‹æ±‚ auto request = std::make_shared\u0026lt;rcl_interfaces::srv::SetParameters::Request\u0026gt;(); request-\u0026gt;parameters.push_back(parameter); auto future = param_client-\u0026gt;async_send_request(request); rclcpp::spin_until_future_complete(this-\u0026gt;get_node_base_interface(), future); auto response = future.get(); return response; } /** * @brief å®šæ™‚å›èª¿å‡½æ•¸ * * å®šæœŸç”Ÿæˆéš¨æ©Ÿç›®æ¨™ä½ç½®ä¸¦ç™¼é€å·¡é‚è«‹æ±‚ */ void Client::cb() { // ç­‰å¾…å·¡é‚æœå‹™å¯ç”¨ while(!this-\u0026gt;client_-\u0026gt;wait_for_service(std::chrono::seconds(1))) { if(!rclcpp::ok()){ RCLCPP_ERROR(this-\u0026gt;get_logger(), \u0026#34;Interrupted while waiting for the service. Exiting.\u0026#34;); return; } RCLCPP_INFO(this-\u0026gt;get_logger(), \u0026#34;Service not available, waiting again...\u0026#34;); } this-\u0026gt;request_ = std::make_shared\u0026lt;patrol::srv::Patrol::Request\u0026gt;(); // === ç”Ÿæˆéš¨æ©Ÿç›®æ¨™ä½ç½® === std::random_device rd; // å‰µå»ºéš¨æ©Ÿæ•¸ç”Ÿæˆå™¨ std::mt19937 gen(rd()); // ä½¿ç”¨ Mersenne Twister æ¼”ç®—æ³• std::uniform_real_distribution\u0026lt;double\u0026gt; dis_float(1.0, 10.0); // å®šç¾©å‡å‹»åˆ†ä½ˆç¯„åœ 1.0-10.0 double random_float = dis_float(gen); // è¨­ç½®è«‹æ±‚çš„ç›®æ¨™ä½ç½® this-\u0026gt;request_-\u0026gt;target_x = random_float = dis_float(gen); this-\u0026gt;request_-\u0026gt;target_y = random_float = dis_float(gen); RCLCPP_INFO(this-\u0026gt;get_logger(), \u0026#34;Requesting patrol to (%f, %f)\u0026#34;, this-\u0026gt;request_-\u0026gt;target_x, this-\u0026gt;request_-\u0026gt;target_y); // ç™¼é€ç•°æ­¥è«‹æ±‚ä¸¦è¨­ç½®å›èª¿è™•ç†çµæœ auto result = this-\u0026gt;client_-\u0026gt;async_send_request(this-\u0026gt;request_, [this](rclcpp::Client\u0026lt;patrol::srv::Patrol\u0026gt;::SharedFuture future) -\u0026gt; void { auto response = future.get(); if(response-\u0026gt;result == patrol::srv::Patrol::Response::SUCCESS) { RCLCPP_INFO(this-\u0026gt;get_logger(), \u0026#34;Patrol to (%f, %f) successful\u0026#34;, this-\u0026gt;request_-\u0026gt;target_x, this-\u0026gt;request_-\u0026gt;target_y); } else { RCLCPP_ERROR(this-\u0026gt;get_logger(), \u0026#34;Patrol to (%f, %f) failed\u0026#34;, this-\u0026gt;request_-\u0026gt;target_x, this-\u0026gt;request_-\u0026gt;target_y); } }); } /** * @brief ä¸»å‡½æ•¸ * * åˆå§‹åŒ–ROS2ç³»çµ±,å‰µå»ºä¸¦é‹è¡Œå®¢æˆ¶ç«¯ç¯€é» */ int main(int argc, char **argv) { rclcpp::init(argc, argv); // åˆå§‹åŒ– ROS2 ç³»çµ± auto client = std::make_shared\u0026lt;Client\u0026gt;(\u0026#34;client_parameters_node\u0026#34;); // å‰µå»ºå®¢æˆ¶ç«¯ç¯€é» client-\u0026gt;update_target_parameters(10.0, 10.0); // è¨­ç½®åˆå§‹ç›®æ¨™åƒæ•¸ rclcpp::spin(client); // é‹è¡Œç¯€é»,è™•ç†å›èª¿ rclcpp::shutdown(); // é—œé–‰ ROS2 ç³»çµ± return 0; } 2.2 åƒæ•¸æœå‹™ç«¯ç¨‹å¼ç¢¼ (service_parameters.cpp) #\r// ===== åŒ…å«å¿…è¦çš„æ¨™é ­æª” ===== #include \u0026#34;rclcpp/rclcpp.hpp\u0026#34; // ROS2 C++ å®¢æˆ¶ç«¯åº« #include \u0026#34;patrol/srv/patrol.hpp\u0026#34; // å·¡é‚æœå‹™ä»‹é¢ #include \u0026#34;geometry_msgs/msg/pose.hpp\u0026#34; // ä½ç½®è¨Šæ¯ #include \u0026#34;turtlesim/msg/pose.hpp\u0026#34; // turtlesim ä½ç½®è¨Šæ¯ #include \u0026#34;geometry_msgs/msg/twist.hpp\u0026#34; // é€Ÿåº¦è¨Šæ¯ #include \u0026#34;rcl_interfaces/msg/parameter_descriptor.hpp\u0026#34; // åƒæ•¸æè¿°ç¬¦ #include \u0026#34;rcl_interfaces/msg/parameter_type.hpp\u0026#34; // åƒæ•¸é¡å‹ /** * @brief åƒæ•¸æœå‹™ç¯€é»é¡åˆ¥ * * æ­¤é¡åˆ¥ç¹¼æ‰¿è‡ª rclcpp::Node,å¯¦ç¾äº†ä¸€å€‹å¸¶åƒæ•¸çš„ROS2æœå‹™ç¯€é» */ class ServiceParameters : public rclcpp::Node { private: // æˆå“¡è®Šé‡ double targetX_ {1.0}; // ç›®æ¨™ X åº§æ¨™ double targetY_ {1.0}; // ç›®æ¨™ Y åº§æ¨™ // ROS2 é€šä¿¡çµ„ä»¶ rclcpp::Service\u0026lt;patrol::srv::Patrol\u0026gt;::SharedPtr service_; // å·¡é‚æœå‹™ turtlesim::msg::Pose::SharedPtr turtlePose_; // ç•¶å‰ä½ç½® rclcpp::Subscription\u0026lt;turtlesim::msg::Pose\u0026gt;::SharedPtr turtlePoseSub_; // ä½ç½®è¨‚é–±è€… rclcpp::Publisher\u0026lt;geometry_msgs::msg::Twist\u0026gt;::SharedPtr publisher_; // é€Ÿåº¦ç™¼å¸ƒè€… // åƒæ•¸å›èª¿å‡½æ•¸ OnSetParametersCallbackHandle::SharedPtr parameter_callback_handle_; public: // å»ºæ§‹å‡½æ•¸ ServiceParameters(std::string nodeName) : Node(nodeName) { // å®£å‘Šä¸¦è¨»å†Šåƒæ•¸ rcl_interfaces::msg::ParameterDescriptor descriptor; descriptor.description = \u0026#34;Target position parameter\u0026#34;; descriptor.read_only = false; this-\u0026gt;declare_parameter(\u0026#34;Target_X\u0026#34;, 1.0, descriptor); this-\u0026gt;declare_parameter(\u0026#34;Target_Y\u0026#34;, 1.0, descriptor); // è¨­ç½®åƒæ•¸å›èª¿ parameter_callback_handle_ = this-\u0026gt;add_on_set_parameters_callback( std::bind(\u0026amp;ServiceParameters::parametersCallback, this, std::placeholders::_1)); // å‰µå»ºä½ç½®è¨‚é–±è€… turtlePoseSub_ = this-\u0026gt;create_subscription\u0026lt;turtlesim::msg::Pose\u0026gt;( \u0026#34;/turtle1/pose\u0026#34;, 10, [this](const turtlesim::msg::Pose::SharedPtr msg) { turtlePose_ = msg; move_to_target(turtlePose_-\u0026gt;x, turtlePose_-\u0026gt;y); } ); // å‰µå»ºé€Ÿåº¦ç™¼å¸ƒè€… publisher_ = this-\u0026gt;create_publisher\u0026lt;geometry_msgs::msg::Twist\u0026gt;(\u0026#34;/turtle1/cmd_vel\u0026#34;, 10); // å‰µå»ºæœå‹™ service_ = this-\u0026gt;create_service\u0026lt;patrol::srv::Patrol\u0026gt;( \u0026#34;patrol\u0026#34;, std::bind(\u0026amp;ServiceParameters::handle_patrol, this, std::placeholders::_1, std::placeholders::_2) ); } // åƒæ•¸å›èª¿å‡½æ•¸ rcl_interfaces::msg::SetParametersResult parametersCallback( const std::vector\u0026lt;rclcpp::Parameter\u0026gt; \u0026amp;parameters) { rcl_interfaces::msg::SetParametersResult result; result.successful = true; for(const auto \u0026amp;param : parameters) { if(param.get_name() == \u0026#34;Target_X\u0026#34;) { targetX_ = param.as_double(); RCLCPP_INFO(this-\u0026gt;get_logger(), \u0026#34;Target_X updated to: %f\u0026#34;, targetX_); } else if(param.get_name() == \u0026#34;Target_Y\u0026#34;) { targetY_ = param.as_double(); RCLCPP_INFO(this-\u0026gt;get_logger(), \u0026#34;Target_Y updated to: %f\u0026#34;, targetY_); } } return result; } // æœå‹™å›èª¿å‡½æ•¸ void handle_patrol( const std::shared_ptr\u0026lt;patrol::srv::Patrol::Request\u0026gt; request, const std::shared_ptr\u0026lt;patrol::srv::Patrol::Response\u0026gt; response) { if((request-\u0026gt;target_x \u0026gt; 0.0f \u0026amp;\u0026amp; request-\u0026gt;target_x \u0026lt; 12.0f) \u0026amp;\u0026amp; (request-\u0026gt;target_y \u0026gt; 0.0f \u0026amp;\u0026amp; request-\u0026gt;target_y \u0026lt; 12.0f)) { targetX_ = request-\u0026gt;target_x; targetY_ = request-\u0026gt;target_y; response-\u0026gt;result = patrol::srv::Patrol::Response::SUCCESS; } else { response-\u0026gt;result = patrol::srv::Patrol::Response::FAIL; } } // ç§»å‹•æ§åˆ¶å‡½æ•¸ void move_to_target(double currentX, double currentY) { auto twist = geometry_msgs::msg::Twist(); double dx = targetX_ - currentX; double dy = targetY_ - currentY; double distance = std::sqrt(dx * dx + dy * dy); double target_angle = std::atan2(dy, dx); double angle_diff = target_angle - turtlePose_-\u0026gt;theta; if (distance \u0026gt; 0.1) { if(fabs(angle_diff) \u0026gt; 0.2) { twist.angular.z = 1.0 * angle_diff; } else { twist.linear.x = 0.5 * distance; } RCLCPP_INFO(this-\u0026gt;get_logger(), \u0026#34;Moving to target: (%f, %f), current: (%f, %f)\u0026#34;, targetX_, targetY_, currentX, currentY); publisher_-\u0026gt;publish(twist); } } }; // ä¸»å‡½æ•¸ int main(int argc, char **argv) { rclcpp::init(argc, argv); auto node = std::make_shared\u0026lt;ServiceParameters\u0026gt;(\u0026#34;service_parameters_node\u0026#34;); rclcpp::spin(node); rclcpp::shutdown(); return 0; } 3. åƒæ•¸èªªæ˜ #\r3.1 å‹•æ…‹åƒæ•¸ #\råœ¨æœ¬å°ˆæ¡ˆä¸­ï¼Œæˆ‘å€‘å¯¦ç¾äº†ä»¥ä¸‹å‹•æ…‹åƒæ•¸ï¼š\nç›®æ¨™ä½ç½®åƒæ•¸ Target_Xï¼šç›®æ¨™ X åº§æ¨™ Target_Yï¼šç›®æ¨™ Y åº§æ¨™ é€™äº›åƒæ•¸å¯ä»¥åœ¨é‹è¡Œæ™‚å‹•æ…‹ä¿®æ”¹ï¼Œä½¿ç³»çµ±æ›´å…·å½ˆæ€§ã€‚\n3.2 åƒæ•¸æ›´æ–°æ©Ÿåˆ¶ #\rvoid Client::update_target_parameters(double x, double y) { // å‰µå»ºä¸¦è¨­å®š X åº§æ¨™åƒæ•¸ auto param = rcl_interfaces::msg::Parameter(); param.name = \u0026#34;Target_X\u0026#34;; auto param_value = rcl_interfaces::msg::ParameterValue(); param_value.type = rcl_interfaces::msg::ParameterType::PARAMETER_DOUBLE; param_value.double_value = x; param.value = param_value; // ... [æ›´å¤šå¯¦ç¾ç´°ç¯€] } 4. é…ç½®æ–‡ä»¶èªªæ˜ #\r4.1 CMakeLists.txt #\r# æŒ‡å®š CMake æœ€ä½ç‰ˆæœ¬è¦æ±‚ cmake_minimum_required(VERSION 3.8) # å®šç¾©å°ˆæ¡ˆåç¨± project(patrol_parameters) # å¦‚æœä½¿ç”¨ GCC æˆ– Clang ç·¨è­¯å™¨ï¼Œæ·»åŠ ç·¨è­¯è­¦å‘Šé¸é … if(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES \u0026#34;Clang\u0026#34;) add_compile_options(-Wall -Wextra -Wpedantic) endif() # å°‹æ‰¾ä¸¦è¼‰å…¥æ‰€éœ€çš„ä¾è³´å¥—ä»¶ find_package(ament_cmake REQUIRED) # ROS 2 CMake å·¥å…· find_package(rclcpp REQUIRED) # ROS 2 C++ å®¢æˆ¶ç«¯ç¨‹å¼åº« find_package(std_msgs REQUIRED) # æ¨™æº–è¨Šæ¯é¡å‹ find_package(rosidl_default_generators REQUIRED)# æœå‹™ä»‹é¢ç”Ÿæˆå™¨ find_package(turtlesim REQUIRED) # çƒé¾œæ¨¡æ“¬å™¨å¥—ä»¶ find_package(geometry_msgs REQUIRED) # å¹¾ä½•è¨Šæ¯é¡å‹ find_package(patrol REQUIRED) # å·¡é‚æœå‹™ä»‹é¢ find_package(rcl_interfaces REQUIRED) # ROS2 åƒæ•¸ä»‹é¢ # å‰µå»ºå¯åŸ·è¡Œæª” add_executable(service_parameters_node src/service_parameters.cpp) add_executable(client_parameters_node src/client_parameters.cpp) # ç‚ºå¯åŸ·è¡Œæª”æ·»åŠ ä¾è³´ ament_target_dependencies(service_parameters_node rclcpp # ROS 2 C++ å®¢æˆ¶ç«¯ç¨‹å¼åº« std_msgs # æ¨™æº–è¨Šæ¯é¡å‹ geometry_msgs # å¹¾ä½•è¨Šæ¯é¡å‹ turtlesim # çƒé¾œæ¨¡æ“¬å™¨å¥—ä»¶ patrol # å·¡é‚æœå‹™ä»‹é¢ rcl_interfaces # ROS2 åƒæ•¸ä»‹é¢ ) ament_target_dependencies(client_parameters_node rclcpp # ROS 2 C++ å®¢æˆ¶ç«¯ç¨‹å¼åº« std_msgs # æ¨™æº–è¨Šæ¯é¡å‹ geometry_msgs # å¹¾ä½•è¨Šæ¯é¡å‹ turtlesim # çƒé¾œæ¨¡æ“¬å™¨å¥—ä»¶ patrol # å·¡é‚æœå‹™ä»‹é¢ rcl_interfaces # ROS2 åƒæ•¸ä»‹é¢ ) # å®‰è£å¯åŸ·è¡Œæª”åˆ°æŒ‡å®šç›®éŒ„ install(TARGETS service_parameters_node client_parameters_node DESTINATION lib/${PROJECT_NAME} ) # å®Œæˆ ament å¥—ä»¶çš„é…ç½® ament_package() 4.2 package.xml #\r\u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt; \u0026lt;!-- æŒ‡å®š XML æ¨¡å¼å®šç¾©ï¼ˆXSDï¼‰æª”æ¡ˆçš„ä½ç½®ï¼Œç”¨æ–¼é©—è­‰æ­¤æª”æ¡ˆçš„æ ¼å¼ --\u0026gt; \u0026lt;?xml-model href=\u0026#34;http://download.ros.org/schema/package_format3.xsd\u0026#34; schematypens=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34;?\u0026gt; \u0026lt;!-- ROS 2 å¥—ä»¶é…ç½®æª”æ¡ˆï¼Œä½¿ç”¨æ ¼å¼ç‰ˆæœ¬ 3 --\u0026gt; \u0026lt;package format=\u0026#34;3\u0026#34;\u0026gt; \u0026lt;!-- å¥—ä»¶åŸºæœ¬è³‡è¨Š --\u0026gt; \u0026lt;name\u0026gt;patrol_parameters\u0026lt;/name\u0026gt; \u0026lt;!-- å¥—ä»¶åç¨± --\u0026gt; \u0026lt;version\u0026gt;0.0.0\u0026lt;/version\u0026gt; \u0026lt;!-- å¥—ä»¶ç‰ˆæœ¬ --\u0026gt; \u0026lt;description\u0026gt;ROS2 å·¡é‚æœå‹™ç¯€é»ï¼ˆå¸¶åƒæ•¸ï¼‰\u0026lt;/description\u0026gt; \u0026lt;!-- å¥—ä»¶æè¿° --\u0026gt; \u0026lt;maintainer email=\u0026#34;tienyao@todo.todo\u0026#34;\u0026gt;tienyao\u0026lt;/maintainer\u0026gt; \u0026lt;!-- ç¶­è­·è€…è³‡è¨Š --\u0026gt; \u0026lt;license\u0026gt;TODO: License declaration\u0026lt;/license\u0026gt; \u0026lt;!-- æˆæ¬Šè²æ˜ --\u0026gt; \u0026lt;!-- å»ºæ§‹å·¥å…·ä¾è³´ --\u0026gt; \u0026lt;buildtool_depend\u0026gt;ament_cmake\u0026lt;/buildtool_depend\u0026gt; \u0026lt;!-- ä½¿ç”¨ ament_cmake ä½œç‚ºå»ºæ§‹å·¥å…· --\u0026gt; \u0026lt;!-- å»ºæ§‹æ™‚ä¾è³´ --\u0026gt; \u0026lt;build_depend\u0026gt;rosidl_default_generators\u0026lt;/build_depend\u0026gt;\u0026lt;!-- ç”¨æ–¼ç”Ÿæˆä»‹é¢æª”æ¡ˆ --\u0026gt; \u0026lt;!-- åŸ·è¡Œæ™‚ä¾è³´ --\u0026gt; \u0026lt;exec_depend\u0026gt;rosidl_default_runtime\u0026lt;/exec_depend\u0026gt; \u0026lt;!-- åŸ·è¡Œæ™‚éœ€è¦çš„ä»‹é¢é‹è¡Œåº« --\u0026gt; \u0026lt;!-- å»ºæ§‹å’ŒåŸ·è¡Œéƒ½éœ€è¦çš„ä¾è³´ --\u0026gt; \u0026lt;depend\u0026gt;rclcpp\u0026lt;/depend\u0026gt; \u0026lt;!-- ROS 2 C++ å®¢æˆ¶ç«¯ç¨‹å¼åº« --\u0026gt; \u0026lt;depend\u0026gt;std_msgs\u0026lt;/depend\u0026gt; \u0026lt;!-- æ¨™æº–è¨Šæ¯é¡å‹ --\u0026gt; \u0026lt;depend\u0026gt;turtlesim\u0026lt;/depend\u0026gt; \u0026lt;!-- çƒé¾œæ¨¡æ“¬å™¨å¥—ä»¶ --\u0026gt; \u0026lt;depend\u0026gt;geometry_msgs\u0026lt;/depend\u0026gt; \u0026lt;!-- å¹¾ä½•è¨Šæ¯é¡å‹ --\u0026gt; \u0026lt;depend\u0026gt;patrol\u0026lt;/depend\u0026gt; \u0026lt;!-- å·¡é‚æœå‹™ä»‹é¢ --\u0026gt; \u0026lt;depend\u0026gt;rcl_interfaces\u0026lt;/depend\u0026gt; \u0026lt;!-- ROS2 åƒæ•¸ä»‹é¢ --\u0026gt; \u0026lt;!-- æ¸¬è©¦ç›¸é—œä¾è³´ --\u0026gt; \u0026lt;test_depend\u0026gt;ament_lint_auto\u0026lt;/test_depend\u0026gt; \u0026lt;!-- è‡ªå‹•åŒ–ç¨‹å¼ç¢¼æª¢æŸ¥å·¥å…· --\u0026gt; \u0026lt;test_depend\u0026gt;ament_lint_common\u0026lt;/test_depend\u0026gt; \u0026lt;!-- å¸¸ç”¨ç¨‹å¼ç¢¼æª¢æŸ¥è¦å‰‡ --\u0026gt; \u0026lt;!-- ROS 2 å¥—ä»¶ç‰¹å®šè³‡è¨Š --\u0026gt; \u0026lt;export\u0026gt; \u0026lt;build_type\u0026gt;ament_cmake\u0026lt;/build_type\u0026gt; \u0026lt;!-- æŒ‡å®šä½¿ç”¨ ament_cmake å»ºæ§‹ç³»çµ± --\u0026gt; \u0026lt;/export\u0026gt; \u0026lt;/package\u0026gt; åŸ·è¡Œæ–¹å¼ #\rç·¨è­¯å°ˆæ¡ˆ cd ros2_ws colcon build --packages-select patrol_parameters åŸ·è¡Œç¯€é» # çµ‚ç«¯æ©Ÿ 1ï¼šå•Ÿå‹• turtlesim ros2 run turtlesim turtlesim_node # çµ‚ç«¯æ©Ÿ 2ï¼šå•Ÿå‹•åƒæ•¸æœå‹™ç«¯ ros2 run patrol_parameters service_parameters_node # çµ‚ç«¯æ©Ÿ 3ï¼šå•Ÿå‹•åƒæ•¸å®¢æˆ¶ç«¯ ros2 run patrol_parameters client_parameters_node ä½¿ç”¨ ROS2 æŒ‡ä»¤æŸ¥çœ‹å’Œè¨­å®šåƒæ•¸ #\råˆ—å‡ºæ‰€æœ‰åƒæ•¸ ros2 param list æŸ¥çœ‹ç‰¹å®šåƒæ•¸å€¼ ros2 param get /service_parameters_node Target_X ros2 param get /service_parameters_node Target_Y æ‰‹å‹•è¨­å®šåƒæ•¸ ros2 param set /service_parameters_node Target_X 5.0 ros2 param set /service_parameters_node Target_Y 5.0 æŠ€è¡“è¦é»èªªæ˜ #\råƒæ•¸æœå‹™æ©Ÿåˆ¶\nä½¿ç”¨ ROS2 åƒæ•¸æœå‹™é€²è¡Œå‹•æ…‹é…ç½® æ”¯æ´åƒæ•¸çš„å³æ™‚æ›´æ–°å’Œç›£æ§ æä¾›åƒæ•¸è®Šæ›´çš„å›èª¿æ©Ÿåˆ¶ éåŒæ­¥é€šä¿¡\nä½¿ç”¨éåŒæ­¥æ–¹å¼ç™¼é€åƒæ•¸æ›´æ–°è«‹æ±‚ è™•ç†åƒæ•¸æ›´æ–°çš„å›æ‡‰å’ŒéŒ¯èª¤æƒ…æ³ ç¢ºä¿ç³»çµ±çš„ç©©å®šæ€§å’Œå¯é æ€§ éŒ¯èª¤è™•ç†\næª¢æŸ¥åƒæ•¸æ›´æ–°çš„çµæœ æä¾›è©³ç´°çš„éŒ¯èª¤æ—¥èªŒ ç¢ºä¿ç³»çµ±çš„å¥å£¯æ€§ åƒè€ƒè³‡æº #\rROS2 Parameters æ•™ç¨‹ ROS2 Services æ•™ç¨‹ çµèª #\ré€éé€™å€‹å°ˆæ¡ˆï¼Œæˆ‘å€‘å­¸ç¿’äº†å¦‚ä½•åœ¨ ROS2 ä¸­ä½¿ç”¨åƒæ•¸æœå‹™ä¾†å¯¦ç¾å‹•æ…‹é…ç½®ã€‚çµåˆåƒæ•¸å’Œæœå‹™çš„æ©Ÿåˆ¶ï¼Œä½¿å¾—ç³»çµ±æ›´åŠ éˆæ´»ä¸”æ˜“æ–¼ç®¡ç†ã€‚å®Œæ•´çš„ç¨‹å¼ç¢¼å¯¦ç¾å’Œè©³ç´°çš„æ³¨è§£ï¼Œæœ‰åŠ©æ–¼ç†è§£ ROS2 çš„åƒæ•¸æ©Ÿåˆ¶å’Œå¯¦ä½œæ–¹æ³•ã€‚\n","date":"11 February 2025","externalUrl":null,"permalink":"/posts/ros2_patrol_parameter/","section":"Posts","summary":"\u003ch1 class=\"relative group\"\u003eğŸ¢ ROS2 å·¡é‚æœå‹™ç¯€é»é–‹ç™¼æ•™å­¸(ä½¿ç”¨ Parameters) \r\n    \u003cdiv id=\"-ros2-%E5%B7%A1%E9%82%8F%E6%9C%8D%E5%8B%99%E7%AF%80%E9%BB%9E%E9%96%8B%E7%99%BC%E6%95%99%E5%AD%B8%E4%BD%BF%E7%94%A8-parameters\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#-ros2-%E5%B7%A1%E9%82%8F%E6%9C%8D%E5%8B%99%E7%AF%80%E9%BB%9E%E9%96%8B%E7%99%BC%E6%95%99%E5%AD%B8%E4%BD%BF%E7%94%A8-parameters\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h1\u003e\r\n\r\n\r\n\u003ch2 class=\"relative group\"\u003eå‰è¨€ \r\n    \u003cdiv id=\"%E5%89%8D%E8%A8%80\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h2\u003e\r\n\u003cp\u003eåœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å€‘å°‡åŸºæ–¼ä¹‹å‰çš„å·¡é‚æœå‹™ç¯€é»ï¼ŒåŠ å…¥ ROS2 çš„åƒæ•¸åŠŸèƒ½ã€‚é€éåƒæ•¸æœå‹™ï¼Œæˆ‘å€‘å¯ä»¥å‹•æ…‹åœ°ä¿®æ”¹å’Œç›£æ§ç¯€é»çš„è¡Œç‚ºï¼Œä½¿ç³»çµ±æ›´åŠ éˆæ´»ã€‚é€™å€‹å°ˆæ¡ˆå±•ç¤ºäº†å¦‚ä½•åœ¨ ROS2 ä¸­å¯¦ç¾åƒæ•¸çš„è¨­å®šå’Œä½¿ç”¨ï¼Œä»¥åŠå¦‚ä½•çµåˆæœå‹™ç«¯ï¼ˆServerï¼‰å’Œå®¢æˆ¶ç«¯ï¼ˆClientï¼‰çš„é€šä¿¡ã€‚\u003c/p\u003e","title":"ğŸ¢ ROS2 å·¡é‚æœå‹™ç¯€é»é–‹ç™¼æ•™å­¸(ä½¿ç”¨ Parameters)","type":"posts"},{"content":"","date":"11 February 2025","externalUrl":null,"permalink":"/tags/parameters/","section":"Tags","summary":"","title":"Parameters","type":"tags"},{"content":"","date":"11 February 2025","externalUrl":null,"permalink":"/tags/ros2/","section":"Tags","summary":"","title":"ROS2","type":"tags"},{"content":"","date":"11 February 2025","externalUrl":null,"permalink":"/categories/ros2/","section":"Categories","summary":"","title":"ROS2","type":"categories"},{"content":"\rğŸ¢ ROS2 å·¡é‚æœå‹™ç¯€é»é–‹ç™¼æ•™å­¸(ä½¿ç”¨ Service å’Œ Client) #\rå‰è¨€ #\råœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å€‘å°‡å¯¦ä½œä¸€å€‹ ROS2 çš„å·¡é‚æœå‹™ç¯€é»ï¼Œé€é Service å’Œ Topic çš„çµåˆä¾†æ§åˆ¶ turtlesim ä¸­çš„çƒé¾œç§»å‹•åˆ°æŒ‡å®šä½ç½®ã€‚é€™å€‹å°ˆæ¡ˆå±•ç¤ºäº†å¦‚ä½•åœ¨ ROS2 ä¸­å¯¦ç¾æœå‹™ç«¯ï¼ˆServerï¼‰å’Œå®¢æˆ¶ç«¯ï¼ˆClientï¼‰çš„é€šä¿¡ï¼Œä»¥åŠåŸºæœ¬çš„é‹å‹•æ§åˆ¶ã€‚\nå°ˆæ¡ˆæ¶æ§‹ #\r1. æª”æ¡ˆçµæ§‹ #\rpatrol/\râ”œâ”€â”€ CMakeLists.txt # æ§‹å»ºé…ç½®æ–‡ä»¶\râ”œâ”€â”€ package.xml # åŒ…é…ç½®æ–‡ä»¶\râ”œâ”€â”€ src/\râ”‚ â”œâ”€â”€ service.cpp # æœå‹™ç«¯ç¯€é»å¯¦ç¾\râ”‚ â””â”€â”€ client.cpp # å®¢æˆ¶ç«¯ç¯€é»å¯¦ç¾\râ””â”€â”€ srv/\râ””â”€â”€ Patrol.srv # æœå‹™ä»‹é¢å®šç¾© 2. æœå‹™ä»‹é¢å®šç¾© #\r# Patrol.srv\rfloat64 target_x # ç›®æ¨™ X åº§æ¨™\rfloat64 target_y # ç›®æ¨™ Y åº§æ¨™\r---\rint8 SUCCESS = 1 # æˆåŠŸç‹€æ…‹ç¢¼\rint8 FAIL = 0 # å¤±æ•—ç‹€æ…‹ç¢¼\rint8 result # åŸ·è¡Œçµæœ 3. å®Œæ•´ç¨‹å¼ç¢¼å¯¦ç¾ #\r3.1 æœå‹™ç«¯ç¨‹å¼ç¢¼ (service.cpp) #\r// åŒ…å«å¿…è¦çš„æ¨™é ­æ–‡ä»¶ #include \u0026#34;rclcpp/rclcpp.hpp\u0026#34; // ROS2 C++ å®¢æˆ¶ç«¯åº« #include \u0026#34;patrol/srv/patrol.hpp\u0026#34; // ç”Ÿæˆçš„æœå‹™ä»‹é¢ #include \u0026#34;geometry_msgs/msg/pose.hpp\u0026#34; // ä½ç½®è¨Šæ¯ #include \u0026#34;turtlesim/msg/pose.hpp\u0026#34; // turtlesim ä½ç½®è¨Šæ¯ #include \u0026#34;geometry_msgs/msg/twist.hpp\u0026#34; // é€Ÿåº¦è¨Šæ¯ // å·¡é‚æœå‹™ç¯€é»é¡åˆ¥ï¼Œç¹¼æ‰¿è‡ª rclcpp::Node class PatrolService: public rclcpp::Node { private: // æˆå“¡è®Šé‡ double targetX_ {1.0}; // ç›®æ¨™ X åº§æ¨™ï¼Œé è¨­å€¼ç‚º 1.0 double targetY_ {1.0}; // ç›®æ¨™ Y åº§æ¨™ï¼Œé è¨­å€¼ç‚º 1.0 // ROS2 é€šä¿¡çµ„ä»¶ rclcpp::Service\u0026lt;patrol::srv::Patrol\u0026gt;::SharedPtr service_; // å·¡é‚æœå‹™ turtlesim::msg::Pose::SharedPtr turtlePose_; // å„²å­˜çƒé¾œç•¶å‰ä½ç½® rclcpp::Subscription\u0026lt;turtlesim::msg::Pose\u0026gt;::SharedPtr turtlePoseSub_; // è¨‚é–±çƒé¾œä½ç½® rclcpp::Publisher\u0026lt;geometry_msgs::msg::Twist\u0026gt;::SharedPtr publisher_; // ç™¼å¸ƒé€Ÿåº¦å‘½ä»¤ public: // å»ºæ§‹å‡½æ•¸ï¼Œåˆå§‹åŒ–ç¯€é» PatrolService(std::string nodeName); // è§£æ§‹å‡½æ•¸ï¼Œä½¿ç”¨é è¨­å¯¦ä½œ ~PatrolService() = default; // è™•ç†å·¡é‚æœå‹™è«‹æ±‚çš„å›èª¿å‡½æ•¸ void handle_patrol(const std::shared_ptr\u0026lt;patrol::srv::Patrol::Request\u0026gt; request, const std::shared_ptr\u0026lt;patrol::srv::Patrol::Response\u0026gt; response); // æ§åˆ¶çƒé¾œç§»å‹•åˆ°ç›®æ¨™ä½ç½®çš„å‡½æ•¸ void move_to_target(double targetX, double targetY); }; // å»ºæ§‹å‡½æ•¸å¯¦ç¾ PatrolService::PatrolService(std::string nodeName): Node(nodeName) { // å‰µå»ºä½ç½®è¨‚é–±è€…ï¼Œè¨‚é–±çƒé¾œçš„ä½ç½®è³‡è¨Š turtlePoseSub_ = this-\u0026gt;create_subscription\u0026lt;turtlesim::msg::Pose\u0026gt;( \u0026#34;/turtle1/pose\u0026#34;, // è©±é¡Œåç¨± 10, // QoS è¨­å®š [this](const turtlesim::msg::Pose::SharedPtr msg) { // å›èª¿å‡½æ•¸ turtlePose_ = msg; // æ›´æ–°çƒé¾œä½ç½® move_to_target(turtlePose_-\u0026gt;x, turtlePose_-\u0026gt;y); // åŸ·è¡Œç§»å‹•æ§åˆ¶ } ); // å‰µå»ºé€Ÿåº¦ç™¼å¸ƒè€…ï¼Œç”¨æ–¼ç™¼é€ç§»å‹•å‘½ä»¤ publisher_ = this-\u0026gt;create_publisher\u0026lt;geometry_msgs::msg::Twist\u0026gt;(\u0026#34;/turtle1/cmd_vel\u0026#34;, 10); // å‰µå»ºå·¡é‚æœå‹™ service_ = this-\u0026gt;create_service\u0026lt;patrol::srv::Patrol\u0026gt;( \u0026#34;patrol\u0026#34;, // æœå‹™åç¨± std::bind(\u0026amp;PatrolService::handle_patrol, this, std::placeholders::_1, std::placeholders::_2) // æœå‹™å›èª¿å‡½æ•¸ ); } // æœå‹™å›èª¿å‡½æ•¸å¯¦ç¾ void PatrolService::handle_patrol( const std::shared_ptr\u0026lt;patrol::srv::Patrol::Request\u0026gt; request, const std::shared_ptr\u0026lt;patrol::srv::Patrol::Response\u0026gt; response) { // æª¢æŸ¥ç›®æ¨™åº§æ¨™æ˜¯å¦åœ¨æœ‰æ•ˆç¯„åœå…§ï¼ˆ0-12ä¹‹é–“ï¼‰ if((request-\u0026gt;target_x \u0026gt; 0.0f \u0026amp;\u0026amp; request-\u0026gt;target_x \u0026lt; 12.0f) \u0026amp;\u0026amp; (request-\u0026gt;target_y \u0026gt; 0.0f \u0026amp;\u0026amp; request-\u0026gt;target_y \u0026lt; 12.0f)) { // æ›´æ–°ç›®æ¨™ä½ç½® targetX_ = request-\u0026gt;target_x; targetY_ = request-\u0026gt;target_y; response-\u0026gt;result = patrol::srv::Patrol::Response::SUCCESS; // è¨­ç½®æˆåŠŸç‹€æ…‹ } else { // åº§æ¨™ç„¡æ•ˆï¼Œè¨­ç½®å¤±æ•—ç‹€æ…‹ response-\u0026gt;result = patrol::srv::Patrol::Response::FAIL; } } // ç§»å‹•æ§åˆ¶å‡½æ•¸å¯¦ç¾ void PatrolService::move_to_target(double currentX, double currentY) { // å‰µå»ºé€Ÿåº¦è¨Šæ¯ç‰©ä»¶ auto twist = geometry_msgs::msg::Twist(); // è¨ˆç®—ç•¶å‰ä½ç½®åˆ°ç›®æ¨™ä½ç½®çš„å·®å€¼ double dx = targetX_ - currentX; double dy = targetY_ - currentY; // è¨ˆç®—è·é›¢ double distance = std::sqrt(dx * dx + dy * dy); // è¨ˆç®—ç›®æ¨™è§’åº¦ï¼ˆä½¿ç”¨ atan2 ç¢ºä¿è§’åº¦åœ¨æ­£ç¢ºçš„è±¡é™ï¼‰ double target_angle = std::atan2(dy, dx); // è¨ˆç®—è§’åº¦å·® double angle_diff = target_angle - turtlePose_-\u0026gt;theta; // å¦‚æœè·é›¢å¤§æ–¼é–¾å€¼ï¼ˆ0.1ï¼‰ï¼Œå‰‡ç¹¼çºŒç§»å‹• if (distance \u0026gt; 0.1) { // å¦‚æœè§’åº¦å·®å¤§æ–¼é–¾å€¼ï¼Œå„ªå…ˆèª¿æ•´æ–¹å‘ if(fabs(angle_diff) \u0026gt; 0.2) { twist.angular.z = 1.0 * angle_diff; // è§’é€Ÿåº¦èˆ‡è§’åº¦å·®æˆæ­£æ¯” } else { twist.linear.x = 0.5 * distance; // ç·šé€Ÿåº¦èˆ‡è·é›¢æˆæ­£æ¯” } // è¼¸å‡ºç•¶å‰ä½ç½®è³‡è¨Šï¼Œç”¨æ–¼é™¤éŒ¯ RCLCPP_INFO(this-\u0026gt;get_logger(), \u0026#34;currentX: %f, currentY: %f\u0026#34;, currentX, currentY); // ç™¼å¸ƒé€Ÿåº¦å‘½ä»¤ publisher_-\u0026gt;publish(twist); } } // ä¸»å‡½æ•¸ int main(int argc, char **argv) { rclcpp::init(argc, argv); // åˆå§‹åŒ– ROS2 auto node = std::make_shared\u0026lt;PatrolService\u0026gt;(\u0026#34;patrol_service_node\u0026#34;); // å‰µå»ºæœå‹™ç¯€é» rclcpp::spin(node); // é‹è¡Œç¯€é» rclcpp::shutdown(); // é—œé–‰ ROS2 return 0; } 3.2 å®¢æˆ¶ç«¯ç¨‹å¼ç¢¼ (client.cpp) #\r#include \u0026#34;rclcpp/rclcpp.hpp\u0026#34; // ROS2 C++ å®¢æˆ¶ç«¯åº« #include \u0026#34;patrol/srv/patrol.hpp\u0026#34; // ç”Ÿæˆçš„æœå‹™ä»‹é¢ #include \u0026#34;rclcpp/time.hpp\u0026#34; // æ™‚é–“ç›¸é—œåŠŸèƒ½ #include \u0026lt;random\u0026gt; // éš¨æ©Ÿæ•¸ç”Ÿæˆ // å·¡é‚å®¢æˆ¶ç«¯é¡åˆ¥ï¼Œç¹¼æ‰¿è‡ª rclcpp::Node class Client: public rclcpp::Node { private: // ROS2 é€šä¿¡çµ„ä»¶ rclcpp::Client\u0026lt;patrol::srv::Patrol\u0026gt;::SharedPtr client_; // æœå‹™å®¢æˆ¶ç«¯ std::shared_ptr\u0026lt;patrol::srv::Patrol::Request\u0026gt; request_; // è«‹æ±‚ç‰©ä»¶ rclcpp::TimerBase::SharedPtr timer_; // å®šæ™‚å™¨ public: // å»ºæ§‹å‡½æ•¸ï¼Œåˆå§‹åŒ–ç¯€é» Client(std::string nodeName): Node(nodeName) { // å‰µå»ºæœå‹™å®¢æˆ¶ç«¯ this-\u0026gt;client_ = this-\u0026gt;create_client\u0026lt;patrol::srv::Patrol\u0026gt;(\u0026#34;patrol\u0026#34;); RCLCPP_INFO(this-\u0026gt;get_logger(), \u0026#34;Client has been created\u0026#34;); // å‰µå»ºå®šæ™‚å™¨ï¼Œæ¯5ç§’ç™¼é€ä¸€æ¬¡è«‹æ±‚ this-\u0026gt;timer_ = this-\u0026gt;create_wall_timer( std::chrono::seconds(5), std::bind(\u0026amp;Client::cb, this) ); } // è§£æ§‹å‡½æ•¸ï¼Œä½¿ç”¨é è¨­å¯¦ä½œ ~Client() = default; // å®šæ™‚å™¨å›èª¿å‡½æ•¸ void cb() { // ç­‰å¾…æœå‹™å¯ç”¨ while(!this-\u0026gt;client_-\u0026gt;wait_for_service(std::chrono::seconds(1))) { if(!rclcpp::ok()){ RCLCPP_ERROR(this-\u0026gt;get_logger(), \u0026#34;Interrupted while waiting for the service. Exiting.\u0026#34;); return; } RCLCPP_INFO(this-\u0026gt;get_logger(), \u0026#34;Service not available, waiting again...\u0026#34;); } // å‰µå»ºè«‹æ±‚ç‰©ä»¶ this-\u0026gt;request_ = std::make_shared\u0026lt;patrol::srv::Patrol::Request\u0026gt;(); // ç”Ÿæˆéš¨æ©Ÿç›®æ¨™ä½ç½® std::random_device rd; std::mt19937 gen(rd()); std::uniform_real_distribution\u0026lt;double\u0026gt; dis_float(1.0, 10.0); // è¨­ç½®éš¨æ©Ÿç›®æ¨™ä½ç½® this-\u0026gt;request_-\u0026gt;target_x = dis_float(gen); this-\u0026gt;request_-\u0026gt;target_y = dis_float(gen); // è¼¸å‡ºè«‹æ±‚è³‡è¨Š RCLCPP_INFO(this-\u0026gt;get_logger(), \u0026#34;Requesting patrol to (%f, %f)\u0026#34;, this-\u0026gt;request_-\u0026gt;target_x, this-\u0026gt;request_-\u0026gt;target_y); // ç™¼é€éåŒæ­¥è«‹æ±‚ auto result = this-\u0026gt;client_-\u0026gt;async_send_request( this-\u0026gt;request_, [this](rclcpp::Client\u0026lt;patrol::srv::Patrol\u0026gt;::SharedFuture future) { auto response = future.get(); if(response-\u0026gt;result == patrol::srv::Patrol::Response::SUCCESS) { RCLCPP_INFO(this-\u0026gt;get_logger(), \u0026#34;Patrol to (%f, %f) successful\u0026#34;, this-\u0026gt;request_-\u0026gt;target_x, this-\u0026gt;request_-\u0026gt;target_y); } else { RCLCPP_ERROR(this-\u0026gt;get_logger(), \u0026#34;Patrol to (%f, %f) failed\u0026#34;, this-\u0026gt;request_-\u0026gt;target_x, this-\u0026gt;request_-\u0026gt;target_y); } } ); } }; // ä¸»å‡½æ•¸ int main(int argc, char **argv) { rclcpp::init(argc, argv); // åˆå§‹åŒ– ROS2 auto client = std::make_shared\u0026lt;Client\u0026gt;(\u0026#34;patrol_client_node\u0026#34;); // å‰µå»ºå®¢æˆ¶ç«¯ç¯€é» rclcpp::spin(client); // é‹è¡Œç¯€é» rclcpp::shutdown(); // é—œé–‰ ROS2 return 0; } 4. é…ç½®æ–‡ä»¶èªªæ˜ #\r4.1 CMakeLists.txt #\r# æŒ‡å®š CMake æœ€ä½ç‰ˆæœ¬è¦æ±‚ cmake_minimum_required(VERSION 3.8) # å®šç¾©å°ˆæ¡ˆåç¨± project(patrol) # å¦‚æœä½¿ç”¨ GCC æˆ– Clang ç·¨è­¯å™¨ï¼Œæ·»åŠ ç·¨è­¯è­¦å‘Šé¸é … if(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES \u0026#34;Clang\u0026#34;) add_compile_options(-Wall -Wextra -Wpedantic) endif() # å°‹æ‰¾ä¸¦è¼‰å…¥æ‰€éœ€çš„ä¾è³´å¥—ä»¶ find_package(ament_cmake REQUIRED) # ROS 2 CMake å·¥å…· find_package(rclcpp REQUIRED) # ROS 2 C++ å®¢æˆ¶ç«¯ç¨‹å¼åº« find_package(std_msgs REQUIRED) # æ¨™æº–è¨Šæ¯é¡å‹ find_package(rosidl_default_generators REQUIRED)# æœå‹™ä»‹é¢ç”Ÿæˆå™¨ find_package(turtlesim REQUIRED) # çƒé¾œæ¨¡æ“¬å™¨å¥—ä»¶ find_package(geometry_msgs REQUIRED) # å¹¾ä½•è¨Šæ¯é¡å‹ # ç”Ÿæˆæœå‹™ä»‹é¢ rosidl_generate_interfaces(${PROJECT_NAME} \u0026#34;srv/Patrol.srv\u0026#34; ) # å‰µå»ºå¯åŸ·è¡Œæª” add_executable(service_node src/service.cpp) # ç‚ºå¯åŸ·è¡Œæª”æ·»åŠ ä¾è³´ ament_target_dependencies(service_node rclcpp # ROS 2 C++ å®¢æˆ¶ç«¯ç¨‹å¼åº« std_msgs # æ¨™æº–è¨Šæ¯é¡å‹ geometry_msgs # å¹¾ä½•è¨Šæ¯é¡å‹ turtlesim # çƒé¾œæ¨¡æ“¬å™¨å¥—ä»¶ ) # å®‰è£å¯åŸ·è¡Œæª”åˆ°æŒ‡å®šç›®éŒ„ install(TARGETS service_node DESTINATION lib/${PROJECT_NAME} ) # å®Œæˆ ament å¥—ä»¶çš„é…ç½® ament_package() 4.2 package.xml #\r\u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt; \u0026lt;!-- æŒ‡å®š XML æ¨¡å¼å®šç¾©ï¼ˆXSDï¼‰æª”æ¡ˆçš„ä½ç½®ï¼Œç”¨æ–¼é©—è­‰æ­¤æª”æ¡ˆçš„æ ¼å¼ --\u0026gt; \u0026lt;?xml-model href=\u0026#34;http://download.ros.org/schema/package_format3.xsd\u0026#34; schematypens=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34;?\u0026gt; \u0026lt;!-- ROS 2 å¥—ä»¶é…ç½®æª”æ¡ˆï¼Œä½¿ç”¨æ ¼å¼ç‰ˆæœ¬ 3 --\u0026gt; \u0026lt;package format=\u0026#34;3\u0026#34;\u0026gt; \u0026lt;!-- å¥—ä»¶åŸºæœ¬è³‡è¨Š --\u0026gt; \u0026lt;name\u0026gt;patrol\u0026lt;/name\u0026gt; \u0026lt;!-- å¥—ä»¶åç¨± --\u0026gt; \u0026lt;version\u0026gt;0.0.0\u0026lt;/version\u0026gt; \u0026lt;!-- å¥—ä»¶ç‰ˆæœ¬ --\u0026gt; \u0026lt;description\u0026gt;TODO: Package description\u0026lt;/description\u0026gt; \u0026lt;!-- å¥—ä»¶æè¿° --\u0026gt; \u0026lt;maintainer email=\u0026#34;tienyao@todo.todo\u0026#34;\u0026gt;tienyao\u0026lt;/maintainer\u0026gt; \u0026lt;!-- ç¶­è­·è€…è³‡è¨Š --\u0026gt; \u0026lt;license\u0026gt;TODO: License declaration\u0026lt;/license\u0026gt; \u0026lt;!-- æˆæ¬Šè²æ˜ --\u0026gt; \u0026lt;!-- å»ºæ§‹å·¥å…·ä¾è³´ --\u0026gt; \u0026lt;buildtool_depend\u0026gt;ament_cmake\u0026lt;/buildtool_depend\u0026gt; \u0026lt;!-- ä½¿ç”¨ ament_cmake ä½œç‚ºå»ºæ§‹å·¥å…· --\u0026gt; \u0026lt;!-- å»ºæ§‹æ™‚ä¾è³´ --\u0026gt; \u0026lt;build_depend\u0026gt;rosidl_default_generators\u0026lt;/build_depend\u0026gt;\u0026lt;!-- ç”¨æ–¼ç”Ÿæˆä»‹é¢æª”æ¡ˆ --\u0026gt; \u0026lt;!-- åŸ·è¡Œæ™‚ä¾è³´ --\u0026gt; \u0026lt;exec_depend\u0026gt;rosidl_default_runtime\u0026lt;/exec_depend\u0026gt; \u0026lt;!-- åŸ·è¡Œæ™‚éœ€è¦çš„ä»‹é¢é‹è¡Œåº« --\u0026gt; \u0026lt;!-- å»ºæ§‹å’ŒåŸ·è¡Œéƒ½éœ€è¦çš„ä¾è³´ --\u0026gt; \u0026lt;depend\u0026gt;rclcpp\u0026lt;/depend\u0026gt; \u0026lt;!-- ROS 2 C++ å®¢æˆ¶ç«¯ç¨‹å¼åº« --\u0026gt; \u0026lt;depend\u0026gt;std_msgs\u0026lt;/depend\u0026gt; \u0026lt;!-- æ¨™æº–è¨Šæ¯é¡å‹ --\u0026gt; \u0026lt;depend\u0026gt;turtlesim\u0026lt;/depend\u0026gt; \u0026lt;!-- çƒé¾œæ¨¡æ“¬å™¨å¥—ä»¶ --\u0026gt; \u0026lt;depend\u0026gt;geometry_msgs\u0026lt;/depend\u0026gt; \u0026lt;!-- å¹¾ä½•è¨Šæ¯é¡å‹ --\u0026gt; \u0026lt;!-- è²æ˜æ­¤å¥—ä»¶æ˜¯ä¸€å€‹ä»‹é¢å¥—ä»¶ --\u0026gt; \u0026lt;member_of_group\u0026gt;rosidl_interface_packages\u0026lt;/member_of_group\u0026gt; \u0026lt;!-- æ¸¬è©¦ç›¸é—œä¾è³´ --\u0026gt; \u0026lt;test_depend\u0026gt;ament_lint_auto\u0026lt;/test_depend\u0026gt; \u0026lt;!-- è‡ªå‹•åŒ–ç¨‹å¼ç¢¼æª¢æŸ¥å·¥å…· --\u0026gt; \u0026lt;test_depend\u0026gt;ament_lint_common\u0026lt;/test_depend\u0026gt; \u0026lt;!-- å¸¸ç”¨ç¨‹å¼ç¢¼æª¢æŸ¥è¦å‰‡ --\u0026gt; \u0026lt;!-- ROS 2 å¥—ä»¶ç‰¹å®šè³‡è¨Š --\u0026gt; \u0026lt;export\u0026gt; \u0026lt;build_type\u0026gt;ament_cmake\u0026lt;/build_type\u0026gt; \u0026lt;!-- æŒ‡å®šä½¿ç”¨ ament_cmake å»ºæ§‹ç³»çµ± --\u0026gt; \u0026lt;/export\u0026gt; \u0026lt;/package\u0026gt; åŸ·è¡Œæ–¹å¼ #\rç·¨è­¯å°ˆæ¡ˆ cd ros2_ws colcon build --packages-select patrol åŸ·è¡Œç¯€é» # çµ‚ç«¯æ©Ÿ 1ï¼šå•Ÿå‹• turtlesim ros2 run turtlesim turtlesim_node # çµ‚ç«¯æ©Ÿ 2ï¼šå•Ÿå‹•å·¡é‚æœå‹™ç«¯ ros2 run patrol service_node # çµ‚ç«¯æ©Ÿ 3ï¼šå•Ÿå‹•å·¡é‚å®¢æˆ¶ç«¯ ros2 run patrol client_node çµèª #\ré€éé€™å€‹å°ˆæ¡ˆï¼Œæˆ‘å€‘å­¸ç¿’äº†å¦‚ä½•åœ¨ ROS2 ä¸­çµåˆ Service å’Œ Client ä¾†å¯¦ç¾æ©Ÿå™¨äººçš„éš¨æ©Ÿé‹å‹•æ§åˆ¶ã€‚é€™ç¨®çµåˆä¸åŒé€šä¿¡æ©Ÿåˆ¶çš„æ–¹å¼ï¼Œèƒ½å¤ æ›´éˆæ´»åœ°è™•ç†å„ç¨®æ§åˆ¶éœ€æ±‚ã€‚å®Œæ•´çš„ç¨‹å¼ç¢¼å¯¦ç¾å’Œè©³ç´°çš„æ³¨è§£ï¼Œæœ‰åŠ©æ–¼ç†è§£ ROS2 çš„æ ¸å¿ƒæ¦‚å¿µå’Œå¯¦ä½œæ–¹æ³•ã€‚\n","date":"11 February 2025","externalUrl":null,"permalink":"/posts/ros2_node_srvice_client/","section":"Posts","summary":"\u003ch1 class=\"relative group\"\u003eğŸ¢ ROS2 å·¡é‚æœå‹™ç¯€é»é–‹ç™¼æ•™å­¸(ä½¿ç”¨ Service å’Œ Client) \r\n    \u003cdiv id=\"-ros2-%E5%B7%A1%E9%82%8F%E6%9C%8D%E5%8B%99%E7%AF%80%E9%BB%9E%E9%96%8B%E7%99%BC%E6%95%99%E5%AD%B8%E4%BD%BF%E7%94%A8-service-%E5%92%8C-client\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#-ros2-%E5%B7%A1%E9%82%8F%E6%9C%8D%E5%8B%99%E7%AF%80%E9%BB%9E%E9%96%8B%E7%99%BC%E6%95%99%E5%AD%B8%E4%BD%BF%E7%94%A8-service-%E5%92%8C-client\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h1\u003e\r\n\r\n\r\n\u003ch2 class=\"relative group\"\u003eå‰è¨€ \r\n    \u003cdiv id=\"%E5%89%8D%E8%A8%80\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h2\u003e\r\n\u003cp\u003eåœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å€‘å°‡å¯¦ä½œä¸€å€‹ ROS2 çš„å·¡é‚æœå‹™ç¯€é»ï¼Œé€é Service å’Œ Topic çš„çµåˆä¾†æ§åˆ¶ turtlesim ä¸­çš„çƒé¾œç§»å‹•åˆ°æŒ‡å®šä½ç½®ã€‚é€™å€‹å°ˆæ¡ˆå±•ç¤ºäº†å¦‚ä½•åœ¨ ROS2 ä¸­å¯¦ç¾æœå‹™ç«¯ï¼ˆServerï¼‰å’Œå®¢æˆ¶ç«¯ï¼ˆClientï¼‰çš„é€šä¿¡ï¼Œä»¥åŠåŸºæœ¬çš„é‹å‹•æ§åˆ¶ã€‚\u003c/p\u003e","title":"ğŸ¢ ROS2 å·¡é‚æœå‹™ç¯€é»é–‹ç™¼æ•™å­¸(ä½¿ç”¨ Service å’Œ Client)","type":"posts"},{"content":"","date":"11 February 2025","externalUrl":null,"permalink":"/tags/client/","section":"Tags","summary":"","title":"Client","type":"tags"},{"content":"","date":"11 February 2025","externalUrl":null,"permalink":"/tags/service/","section":"Tags","summary":"","title":"Service","type":"tags"},{"content":"\rğŸ”¢ æ•¸ä½é™¤æ³•å™¨è¨­è¨ˆèˆ‡å¯¦ç¾ - åŸºæ–¼FPGAçš„ç§»ä½é™¤æ³•ç®—æ³• #\rå‰è¨€ #\råœ¨æ•¸ä½é›»è·¯è¨­è¨ˆä¸­ï¼Œé™¤æ³•é‹ç®—æ˜¯ä¸€å€‹é‡è¦ä½†ç›¸å°è¤‡é›œçš„ç®—è¡“æ“ä½œã€‚æœ¬æ–‡å°‡ä»‹ç´¹ä¸€å€‹åŸºæ–¼FPGAçš„32ä½å…ƒé™¤æ³•å™¨è¨­è¨ˆï¼Œæ¡ç”¨ç§»ä½é™¤æ³•ç®—æ³•å¯¦ç¾ã€‚é€™å€‹è¨­è¨ˆä¸åƒ…å…·æœ‰è‰¯å¥½çš„å¯æ“´å±•æ€§ï¼Œé‚„æä¾›äº†å®Œæ•´çš„æ¸¬è©¦é©—è­‰å¹³å°ã€‚\nä¸€ã€è¨­è¨ˆç›®æ¨™ #\rå¯¦ç¾32ä½å…ƒç„¡è™Ÿæ•¸é™¤æ³•é‹ç®— æ”¯æ´å¯åƒæ•¸åŒ–çš„è³‡æ–™ä½å¯¬ æä¾›å®Œæ•´çš„æ§åˆ¶æ©Ÿåˆ¶ ç¢ºä¿é‹ç®—çµæœçš„æº–ç¢ºæ€§ äºŒã€è¨­è¨ˆæ¶æ§‹ #\r2.1 æ¨¡çµ„èªªæ˜ #\rdiv_go_tick: å•Ÿå‹•ä¿¡è™Ÿè™•ç†æ¨¡çµ„\nåŠŸèƒ½ï¼šç”¢ç”Ÿå–®ä¸€æ™‚é˜é€±æœŸçš„è§¸ç™¼è„ˆè¡ é¿å…å¤šé€±æœŸè§¸ç™¼å•é¡Œ division: é™¤æ³•å™¨æ ¸å¿ƒæ¨¡çµ„\nåŠŸèƒ½ï¼šåŸ·è¡Œç§»ä½é™¤æ³•é‹ç®— æä¾›å•†æ•¸å’Œç§»ä½è¨ˆæ•¸è¼¸å‡º ä¸‰ã€å®Œæ•´ç¨‹å¼ç¢¼ #\r3.1 è¨Šè™Ÿé‚Šç·£æª¢æ¸¬æ¨¡çµ„ #\r// ********************************************************************************* // è¨Šè™Ÿé‚Šç·£æª¢æ¸¬æ¨¡çµ„ // åŠŸèƒ½ï¼šæª¢æ¸¬è¼¸å…¥è¨Šè™Ÿçš„ä¸Šå‡é‚Šç·£ï¼Œç”¢ç”Ÿä¸€å€‹æ™‚é˜é€±æœŸçš„è„ˆè¡ // æ‡‰ç”¨ï¼šç”¨æ–¼é™¤æ³•å™¨çš„å•Ÿå‹•æ§åˆ¶ // ********************************************************************************* module div_go_tick ( input clk, // æ™‚é˜è¼¸å…¥ input nRst, // ä½é›»ä½æœ‰æ•ˆçš„é‡ç½®ä¿¡è™Ÿ input iSignal, // è¼¸å…¥è¨Šè™Ÿ output oSignal // è¼¸å‡ºè„ˆè¡ä¿¡è™Ÿ ); reg [1:0] rvSignal_d, rvSignal_q; always @(posedge clk or negedge nRst) begin if(!nRst) rvSignal_q \u0026lt;= 2\u0026#39;b00; else rvSignal_q \u0026lt;= rvSignal_d; end always @(*) begin rvSignal_d = {rvSignal_q[0], iSignal}; end assign oSignal = (rvSignal_q == 2\u0026#39;b01) ? 1\u0026#39;b1 : 1\u0026#39;b0; endmodule 3.2 å¯åƒæ•¸åŒ–çš„é™¤æ³•å™¨æ¨¡çµ„ #\rmodule division#( parameter DATA_WIDTH = 32 // è³‡æ–™ä½å¯¬åƒæ•¸ï¼Œé è¨­32ä½å…ƒ ) ( input clk, // æ™‚è„ˆè¼¸å…¥ input nRst, // ä½é›»ä½æœ‰æ•ˆçš„é‡ç½®ä¿¡è™Ÿ input [DATA_WIDTH-1:0] ivDivisor, // é™¤æ•¸è¼¸å…¥ input [DATA_WIDTH-1:0] ivDividend, // è¢«é™¤æ•¸è¼¸å…¥ output [DATA_WIDTH-1:0] ovQuotient, // å•†æ•¸è¼¸å‡º output [7:0] ovShift, // ç§»ä½è¨ˆæ•¸è¼¸å‡º input iGoTick, // é–‹å§‹é‹ç®—è§¸ç™¼ä¿¡è™Ÿ output oDone // é‹ç®—å®Œæˆä¿¡è™Ÿ ); // å¸¸æ•¸å®šç¾© localparam DATA_WIDTH_ = DATA_WIDTH - 1; // å…§éƒ¨æš«å­˜å™¨å®£å‘Š reg [DATA_WIDTH-1:0] rvDivisor_d, rvDivisor_q; reg [DATA_WIDTH-1:0] rvQuotientShift_d, rvQuotientShift_q; reg [DATA_WIDTH-1:0] rvRemainder_d, rvRemainder_q; wire [DATA_WIDTH-1:0] wvRemainder; reg [DATA_WIDTH-1:0] rvQuotient_d, rvQuotient_q; reg [7:0] rvShift_d, rvShift_q; // æ§åˆ¶ä¿¡è™Ÿæš«å­˜å™¨ reg rFlag_d, rFlag_q; reg [7:0] rvProcessCnt_d, rvProcessCnt_q; wire addProcessCnt, endProcessCnt; reg [7:0] rvShiftCnt_d, rvShiftCnt_q; reg [DATA_WIDTH-1:0] rvDivisorShift_d, rvDivisorShift_q; reg rProcessEn_d, rProcessEn_q; wire [DATA_WIDTH-1:0] wvCompare; reg rDone_d, rDone_q; //============================================================================= // ç¬¬ä¸€éšæ®µï¼šåˆå§‹å°é½Š // é€šéç§»ä½æ“ä½œæ‰¾åˆ°æ­£ç¢ºçš„èµ·å§‹ä½ç½® //============================================================================= // æ¯”è¼ƒé‚è¼¯ï¼šè¢«é™¤æ•¸æ¸›å»ç§»ä½å¾Œçš„é™¤æ•¸ assign wvCompare = ivDividend - rvDivisorShift_q; // é™¤æ•¸ç§»ä½æš«å­˜å™¨ always @(posedge clk or negedge nRst) begin if(!nRst) rvDivisorShift_q \u0026lt;= 8\u0026#39;h0; else rvDivisorShift_q \u0026lt;= rvDivisorShift_d; end // é™¤æ•¸ç§»ä½æ§åˆ¶é‚è¼¯ always @(*) begin if(endProcessCnt) rvDivisorShift_d = 8\u0026#39;h0; else if(iGoTick) rvDivisorShift_d = ivDivisor; else if(wvCompare[DATA_WIDTH-1] == 1\u0026#39;b0) // å¦‚æœæ¯”è¼ƒçµæœç‚ºæ­£ rvDivisorShift_d = rvDivisorShift_q \u0026lt;\u0026lt; 1; // ç¹¼çºŒå·¦ç§» else rvDivisorShift_d = rvDivisorShift_q; end // ç§»ä½è¨ˆæ•¸å™¨é‚è¼¯ always @(posedge clk or negedge nRst) begin if(!nRst) rvShiftCnt_q \u0026lt;= 8\u0026#39;h0; else rvShiftCnt_q \u0026lt;= rvShiftCnt_d; end // ç§»ä½è¨ˆæ•¸æ§åˆ¶ always @(*) begin if(iGoTick || !rFlag_q) rvShiftCnt_d = 8\u0026#39;h0; else if(wvCompare[DATA_WIDTH-1] == 1\u0026#39;b0) rvShiftCnt_d = rvShiftCnt_q + 1\u0026#39;b1; else rvShiftCnt_d = rvShiftCnt_q; end //============================================================================= // è™•ç†æ§åˆ¶é‚è¼¯ //============================================================================= // è™•ç†å•Ÿç”¨æ§åˆ¶ always @(posedge clk or negedge nRst) begin if(!nRst) rProcessEn_q \u0026lt;= 1\u0026#39;b0; else rProcessEn_q \u0026lt;= rProcessEn_d; end always @(*) begin if(iGoTick || endProcessCnt) rProcessEn_d = 1\u0026#39;b0; else if(wvCompare[DATA_WIDTH-1] == 1\u0026#39;b1) // ç•¶æ¯”è¼ƒçµæœç‚ºè² æ™‚é–‹å§‹è™•ç† rProcessEn_d = 1\u0026#39;b1; else rProcessEn_d = rProcessEn_q; end // é‹ç®—ç‹€æ…‹æ¨™èªŒæ§åˆ¶ always @(posedge clk or negedge nRst) begin if(!nRst) rFlag_q \u0026lt;= 1\u0026#39;b0; else rFlag_q \u0026lt;= rFlag_d; end always @(*) begin if(endProcessCnt) rFlag_d = 1\u0026#39;b0; else if(iGoTick) rFlag_d = 1\u0026#39;b1; else rFlag_d = rFlag_q; end //============================================================================= // ç¬¬äºŒéšæ®µï¼šåŸ·è¡Œé™¤æ³•é‹ç®— //============================================================================= // é¤˜æ•¸è¨ˆç®— assign wvRemainder = rvRemainder_q - rvDivisor_q; // è™•ç†è¨ˆæ•¸å™¨æ§åˆ¶ assign addProcessCnt = rProcessEn_q; assign endProcessCnt = addProcessCnt \u0026amp;\u0026amp; (rvProcessCnt_q == DATA_WIDTH); // è™•ç†è¨ˆæ•¸å™¨é‚è¼¯ always @(posedge clk or negedge nRst) begin if(!nRst) rvProcessCnt_q \u0026lt;= 8\u0026#39;h0; else rvProcessCnt_q \u0026lt;= rvProcessCnt_d; end always @(*) begin if(endProcessCnt) rvProcessCnt_d = 8\u0026#39;h0; else if(addProcessCnt) rvProcessCnt_d = rvProcessCnt_q + 1\u0026#39;b1; else rvProcessCnt_d = rvProcessCnt_q; end // æœ€çµ‚è¼¸å‡ºè³¦å€¼ assign ovQuotient = rvQuotient_q; assign ovShift = rvShift_q; assign oDone = rDone_q; endmodule 3.3 æ¸¬è©¦å¹³å° #\r// ********************************************************************************* // æ¸¬è©¦å¹³å° // ********************************************************************************* `timescale 1ns/1ps module division_tb; localparam DATA_WIDTH = 32; // è¨­å®šè³‡æ–™ä½å¯¬ç‚º32ä½å…ƒ // æ™‚é˜å’Œæ§åˆ¶ä¿¡è™Ÿ reg clk; // ç³»çµ±æ™‚é˜ reg nRst; // ä½é›»ä½æœ‰æ•ˆçš„é‡ç½®ä¿¡è™Ÿ reg [DATA_WIDTH-1:0] divisor1; // é™¤æ•¸è¼¸å…¥ reg [DATA_WIDTH-1:0] dividend1; // è¢«é™¤æ•¸è¼¸å…¥ wire [DATA_WIDTH-1:0] quotient1; // å•†æ•¸è¼¸å‡º wire [7:0] shift1; // ç§»ä½è¨ˆæ•¸è¼¸å‡º reg go; // å•Ÿå‹•ä¿¡è™Ÿ wire goTick; // é‚Šç·£æª¢æ¸¬å¾Œçš„å•Ÿå‹•è„ˆè¡ // é‚Šç·£æª¢æ¸¬æ¨¡çµ„å¯¦ä¾‹åŒ– div_go_tick div_go_tick_inst ( .clk (clk), .nRst (nRst), .iSignal (go), // è¼¸å…¥å•Ÿå‹•ä¿¡è™Ÿ .oSignal (goTick) // è¼¸å‡ºè„ˆè¡ä¿¡è™Ÿ ); // é™¤æ³•å™¨æ¨¡çµ„å¯¦ä¾‹åŒ– division #( .DATA_WIDTH(DATA_WIDTH) ) DUT ( .clk (clk), .nRst (nRst), .ivDivisor (divisor1), .ivDividend (dividend1), .ovQuotient (quotient1), .ovShift (shift1), .iGoTick (goTick) ); // æ™‚é˜ç”¢ç”Ÿå™¨ï¼šé€±æœŸç‚º20ns (50MHz) initial clk = 1\u0026#39;b0; always #10 clk = ~clk; // ç³»çµ±é‡ç½®ä»»å‹™ task SYSTEM_RESET; begin nRst = 1\u0026#39;b0; // å•Ÿå‹•é‡ç½® repeat(100) @(posedge clk); // ç­‰å¾…100å€‹æ™‚é˜é€±æœŸ nRst = 1\u0026#39;b1; // é‡‹æ”¾é‡ç½® end endtask // æ¸¬è©¦ç¨‹åº initial begin // åˆå§‹åŒ–å’Œç³»çµ±é‡ç½® SYSTEM_RESET; go = 0; #1000; // æ¸¬è©¦æ¡ˆä¾‹1: 300 Ã· 300 = 1 divisor1 = 300; dividend1 = 300; #100; go = 1; #100; go = 0; // æ¸¬è©¦æ¡ˆä¾‹2: 13 Ã· 3 = 4.333... #1000; divisor1 = 3; dividend1 = 13; #100; go = 1; #100; go = 0; // æ¸¬è©¦æ¡ˆä¾‹3: 280 Ã· 256 = 1.09375 #1000; divisor1 = 256; dividend1 = 280; #100; go = 1; #100; go = 0; // æ¸¬è©¦æ¡ˆä¾‹4: 83 Ã· 19 = 4.368421... #1000; divisor1 = 19; dividend1 = 83; #100; go = 1; #100; go = 0; // ç­‰å¾…é‹ç®—å®Œæˆ #300000; // çµæŸæ¨¡æ“¬ $stop; end endmodule å››ã€æ³¢å½¢åˆ†æ #\r4.1 å¯¦éš›æ³¢å½¢çµæœ #\ræ³¢å½¢èªªæ˜ï¼š\nå•Ÿå‹•æ§åˆ¶ä¿¡è™Ÿ\niSignal è§¸ç™¼å¾Œç”¢ç”Ÿ goTick è„ˆè¡ å–®ä¸€æ™‚é˜é€±æœŸçš„æ§åˆ¶ä¿¡è™Ÿ é™¤æ³•é‹ç®—éç¨‹\nåˆå§‹å°é½Šéšæ®µ ç§»ä½é™¤æ³•é‹ç®—éšæ®µ çµæœè¼¸å‡ºéšæ®µ é—œéµæ™‚åºé»\né‹ç®—é–‹å§‹æ™‚é–“é» å•†æ•¸ç”¢ç”Ÿæ™‚é–“é» å®Œæˆä¿¡è™Ÿç”¢ç”Ÿæ™‚é–“é» äº”ã€çµè«– #\ræœ¬è¨­è¨ˆå¯¦ç¾äº†ä¸€å€‹ç©©å®šå¯é çš„é™¤æ³•å™¨ï¼Œå…·æœ‰ï¼š\nè‰¯å¥½çš„å¯æ“´å±•æ€§ æº–ç¢ºçš„é‹ç®—çµæœ å®Œæ•´çš„æ§åˆ¶æ©Ÿåˆ¶ æ¸…æ™°çš„æ™‚åºé—œä¿‚ å…­ã€æœªä¾†å„ªåŒ–æ–¹å‘ #\rå¢åŠ ç®¡ç·šç´šæ•¸æé«˜é‹ç®—æ•ˆç‡ æ·»åŠ é™¤æ•¸ç‚ºé›¶æª¢æŸ¥ æ”¯æ´æœ‰è™Ÿæ•¸é‹ç®— å„ªåŒ–é—œéµè·¯å¾‘é™ä½å»¶é² ","date":"11 February 2025","externalUrl":null,"permalink":"/posts/fpga_divider/","section":"Posts","summary":"\u003ch1 class=\"relative group\"\u003eğŸ”¢ æ•¸ä½é™¤æ³•å™¨è¨­è¨ˆèˆ‡å¯¦ç¾ - åŸºæ–¼FPGAçš„ç§»ä½é™¤æ³•ç®—æ³• \r\n    \u003cdiv id=\"-%E6%95%B8%E4%BD%8D%E9%99%A4%E6%B3%95%E5%99%A8%E8%A8%AD%E8%A8%88%E8%88%87%E5%AF%A6%E7%8F%BE---%E5%9F%BA%E6%96%BCfpga%E7%9A%84%E7%A7%BB%E4%BD%8D%E9%99%A4%E6%B3%95%E7%AE%97%E6%B3%95\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#-%E6%95%B8%E4%BD%8D%E9%99%A4%E6%B3%95%E5%99%A8%E8%A8%AD%E8%A8%88%E8%88%87%E5%AF%A6%E7%8F%BE---%E5%9F%BA%E6%96%BCfpga%E7%9A%84%E7%A7%BB%E4%BD%8D%E9%99%A4%E6%B3%95%E7%AE%97%E6%B3%95\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h1\u003e\r\n\r\n\r\n\u003ch2 class=\"relative group\"\u003eå‰è¨€ \r\n    \u003cdiv id=\"%E5%89%8D%E8%A8%80\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h2\u003e\r\n\u003cp\u003eåœ¨æ•¸ä½é›»è·¯è¨­è¨ˆä¸­ï¼Œé™¤æ³•é‹ç®—æ˜¯ä¸€å€‹é‡è¦ä½†ç›¸å°è¤‡é›œçš„ç®—è¡“æ“ä½œã€‚æœ¬æ–‡å°‡ä»‹ç´¹ä¸€å€‹åŸºæ–¼FPGAçš„32ä½å…ƒé™¤æ³•å™¨è¨­è¨ˆï¼Œæ¡ç”¨ç§»ä½é™¤æ³•ç®—æ³•å¯¦ç¾ã€‚é€™å€‹è¨­è¨ˆä¸åƒ…å…·æœ‰è‰¯å¥½çš„å¯æ“´å±•æ€§ï¼Œé‚„æä¾›äº†å®Œæ•´çš„æ¸¬è©¦é©—è­‰å¹³å°ã€‚\u003c/p\u003e","title":"ğŸ”¢ æ•¸ä½é™¤æ³•å™¨è¨­è¨ˆèˆ‡å¯¦ç¾ - åŸºæ–¼FPGAçš„ç§»ä½é™¤æ³•ç®—æ³•","type":"posts"},{"content":"","date":"11 February 2025","externalUrl":null,"permalink":"/tags/fpga/","section":"Tags","summary":"","title":"FPGA","type":"tags"},{"content":"","date":"11 February 2025","externalUrl":null,"permalink":"/tags/verilog/","section":"Tags","summary":"","title":"Verilog","type":"tags"},{"content":"","date":"11 February 2025","externalUrl":null,"permalink":"/categories/verilog/","section":"Categories","summary":"","title":"Verilog","type":"categories"},{"content":"\rğŸ”§ Verilog HDL è¨Šè™Ÿå‘½ååŸå‰‡ #\rå‰è¨€ #\råœ¨æ•¸ä½é›»è·¯è¨­è¨ˆä¸­ï¼Œè‰¯å¥½çš„è¨Šè™Ÿå‘½ååŸå‰‡èˆ‡ coding style åŒç­‰é‡è¦ã€‚ç‰¹åˆ¥æ˜¯åœ¨å¤§å‹è¨­è¨ˆå°ˆæ¡ˆä¸­ï¼Œæ¸…æ™°çš„å‘½åæ–¹å¼ä¸åƒ…èƒ½è®“ä»£ç¢¼æ›´å®¹æ˜“ç¶­è­·ï¼Œä¹Ÿèƒ½å¹«åŠ©åœ˜éšŠæˆå“¡å¿«é€Ÿç†è§£è¨Šè™Ÿç‰¹æ€§ä¸¦é€²è¡Œé™¤éŒ¯ã€‚æœ¬æ–‡å°‡ä»‹ç´¹å¸¸ç”¨çš„ Verilog HDL è¨Šè™Ÿå‘½åè¦å‰‡ã€‚\nå°ˆæ¡ˆæ¶æ§‹ #\r1. FPGA å¤–éƒ¨è¼¸å…¥è¼¸å‡ºå‘½å #\rFPGA çš„å¤–éƒ¨æ¥å£ï¼ˆtop moduleï¼‰ä½¿ç”¨å…¨å¤§å¯«å­—æ¯ï¼Œä¸¦ç”¨åº•ç·šå€åˆ†å–®å­—ï¼š\ninput CLOCK_50 // 50MHz ç³»çµ±æ™‚è„ˆ output LED_STATUS // LED ç‹€æ…‹è¼¸å‡º input KEY_N // æŒ‰éµè¼¸å…¥ï¼ˆä½æ…‹å‹•ä½œï¼‰ 2. æ¨¡çµ„å…§éƒ¨è¨Šè™Ÿå‘½å #\r2.1 å­æ¨¡çµ„è¼¸å…¥è¼¸å‡ºå‘½å #\rè¼¸å…¥è¨Šè™Ÿï¼šå‰ç¶´ iï¼ˆé™¤ç³»çµ±æ™‚è„ˆåŠé‡ç½®è¼¸å…¥å¤–ï¼‰\ninput clk // ç³»çµ±æ™‚è„ˆè¼¸å…¥ input nRst // é‡ç½®è¼¸å…¥(ä½æ…‹å‹•ä½œ) input [7:0] iData // è³‡æ–™è¼¸å…¥ è¼¸å‡ºè¨Šè™Ÿï¼šå‰ç¶´ o\noutput oValid // æœ‰æ•ˆè¨Šè™Ÿè¼¸å‡º output [15:0] oResult // çµæœè¼¸å‡º 2.2 è¨Šè™Ÿé¡å‹æ¨™ç¤º #\ræš«å­˜å™¨é¡å‹ï¼šå‰ç¶´ r\nreg rState // ç‹€æ…‹æš«å­˜å™¨ reg [7:0] rCounter // è¨ˆæ•¸å™¨æš«å­˜å™¨ ç·šç¶²é¡å‹ï¼šå‰ç¶´ w\nwire wReady // å°±ç·’è¨Šè™Ÿ wire [15:0] wSum // ç¸½å’Œè¨Šè™Ÿ 2.3 å‘é‡é¡å‹è¨Šè™Ÿ #\rè¼¸å…¥å‘é‡ï¼šå‰ç¶´ iv\ninput [7:0] ivData // 8ä½å…ƒè³‡æ–™è¼¸å…¥ è¼¸å‡ºå‘é‡ï¼šå‰ç¶´ ov\noutput [15:0] ovResult // 16ä½å…ƒçµæœè¼¸å‡º æš«å­˜å™¨å‘é‡ï¼šå‰ç¶´ rv\nreg [31:0] rvBuffer // 32ä½å…ƒç·©è¡æš«å­˜å™¨ ç·šç¶²å‘é‡ï¼šå‰ç¶´ wv\nwire [7:0] wvSum // 8ä½å…ƒç¸½å’Œç·šç¶² 2.4 ç‰¹æ®Šè¨Šè™Ÿæ¨™ç¤º #\rD è§¸ç™¼å™¨ç›¸é—œï¼š reg rData_d // D è§¸ç™¼å™¨è¼¸å…¥ç«¯ reg rData_q // D è§¸ç™¼å™¨è¼¸å‡ºç«¯ å¯¦éš›æ‡‰ç”¨ç¯„ä¾‹ #\rè¨Šè™Ÿé‚Šç·£æª¢æ¸¬å™¨ #\rmodule tick_gen ( input clk, // ç³»çµ±æ™‚è„ˆ input nRst, // é‡ç½®è¨Šè™Ÿï¼ˆä½æ…‹å‹•ä½œï¼‰ input iSignal, // è¼¸å…¥è¨Šè™Ÿ output oSignalTick // è¨Šè™Ÿä¸Šå‡é‚Šç·£è„ˆè¡ ); reg [1:0] rvSignal_d, rvSignal_q; // è¨Šè™Ÿå»¶é²éˆ // åŒæ­¥æ™‚åºé‚è¼¯ always @(posedge clk or negedge nRst) begin if(!nRst) rvSignal_q \u0026lt;= 2\u0026#39;h0; else rvSignal_q \u0026lt;= rvSignal_d; end // çµ„åˆé‚è¼¯ always @(*) begin rvSignal_d = {rvSignal_q[0], iSignal}; end // æª¢æ¸¬ä¸Šå‡é‚Šç·£ï¼ˆ01åºåˆ—ï¼‰ assign oSignalTick = (rvSignal_q == 2\u0026#39;b01) ? 1\u0026#39;b1 : 1\u0026#39;b0; endmodule é€™å€‹ç¯„ä¾‹å±•ç¤ºäº†ï¼š\nç³»çµ±è¨Šè™Ÿï¼ˆclk, nRstï¼‰ä¸åŠ å‰ç¶´ ä¸€èˆ¬è¼¸å…¥åŠ  i å‰ç¶´ ä¸€èˆ¬è¼¸å‡ºåŠ  o å‰ç¶´ å‘é‡å‹æš«å­˜å™¨åŠ  rv å‰ç¶´ D è§¸ç™¼å™¨ç›¸é—œè¨Šè™ŸåŠ  _d å’Œ _q å¾Œç¶´ å‘½åè¦ç¯„å»ºè­° #\r1. ä¸€è‡´æ€§åŸå‰‡ #\råœ¨åŒä¸€å°ˆæ¡ˆä¸­ä¿æŒå‘½åé¢¨æ ¼ä¸€è‡´ éµå¾ªåœ˜éšŠæ—¢å®šçš„å‘½åè¦ç¯„ 2. æ¸…æ™°æ€§åŸå‰‡ #\ré¸æ“‡å…·æè¿°æ€§çš„åç¨± é¿å…éæ–¼ç°¡ç•¥æˆ–é›£ä»¥ç†è§£çš„ç¸®å¯« çµèª #\rè‰¯å¥½çš„è¨Šè™Ÿå‘½åè¦ç¯„ä¸åƒ…èƒ½æé«˜ä»£ç¢¼çš„å¯è®€æ€§ï¼Œä¹Ÿèƒ½æ¸›å°‘é–‹ç™¼éç¨‹ä¸­çš„éŒ¯èª¤ã€‚åœ¨å¯¦éš›å°ˆæ¡ˆä¸­ï¼Œå»ºè­°åœ˜éšŠæˆå“¡å…±åŒåˆ¶å®šä¸¦éµå¾ªçµ±ä¸€çš„å‘½åè¦ç¯„ï¼Œä»¥æé«˜é–‹ç™¼æ•ˆç‡å’Œä»£ç¢¼å“è³ªã€‚\n","date":"11 February 2025","externalUrl":null,"permalink":"/posts/verilog_signal_name/","section":"Posts","summary":"\u003ch1 class=\"relative group\"\u003eğŸ”§ Verilog HDL è¨Šè™Ÿå‘½ååŸå‰‡ \r\n    \u003cdiv id=\"-verilog-hdl-%E8%A8%8A%E8%99%9F%E5%91%BD%E5%90%8D%E5%8E%9F%E5%89%87\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#-verilog-hdl-%E8%A8%8A%E8%99%9F%E5%91%BD%E5%90%8D%E5%8E%9F%E5%89%87\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h1\u003e\r\n\r\n\r\n\u003ch2 class=\"relative group\"\u003eå‰è¨€ \r\n    \u003cdiv id=\"%E5%89%8D%E8%A8%80\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h2\u003e\r\n\u003cp\u003eåœ¨æ•¸ä½é›»è·¯è¨­è¨ˆä¸­ï¼Œè‰¯å¥½çš„è¨Šè™Ÿå‘½ååŸå‰‡èˆ‡ coding style åŒç­‰é‡è¦ã€‚ç‰¹åˆ¥æ˜¯åœ¨å¤§å‹è¨­è¨ˆå°ˆæ¡ˆä¸­ï¼Œæ¸…æ™°çš„å‘½åæ–¹å¼ä¸åƒ…èƒ½è®“ä»£ç¢¼æ›´å®¹æ˜“ç¶­è­·ï¼Œä¹Ÿèƒ½å¹«åŠ©åœ˜éšŠæˆå“¡å¿«é€Ÿç†è§£è¨Šè™Ÿç‰¹æ€§ä¸¦é€²è¡Œé™¤éŒ¯ã€‚æœ¬æ–‡å°‡ä»‹ç´¹å¸¸ç”¨çš„ Verilog HDL è¨Šè™Ÿå‘½åè¦å‰‡ã€‚\u003c/p\u003e","title":"ğŸ”§ Verilog HDL è¨Šè™Ÿå‘½ååŸå‰‡","type":"posts"},{"content":"\rğŸ”§ æ•¸å­—é›»è·¯æ¯›åˆºæ¿¾æ³¢å™¨è¨­è¨ˆèˆ‡å¯¦ç¾ #\rå‰è¨€ #\råœ¨æ•¸ä½é›»è·¯è¨­è¨ˆä¸­ï¼Œä¿¡è™Ÿæ¯›åˆºï¼ˆGlitchï¼‰æ˜¯ä¸€å€‹å¸¸è¦‹çš„å•é¡Œï¼Œå¸¸è¦‹æ–¼æŒ‰éµå»å½ˆè·³ã€å¤–éƒ¨ä¿¡è™Ÿè¼¸å…¥è™•ç†ã€éœ€è¦ç©©å®šä¿¡è™Ÿçš„æ§åˆ¶ç³»çµ±ã€æ•¸ä½é›»è·¯ä¸­çš„é›œè¨Šè™•ç†ç­‰ã€‚æœ¬æ–‡å°‡ä»‹ç´¹ä¸€å€‹ä½¿ç”¨Verilogå¯¦ç¾çš„æ¯›åˆºæ¿¾æ³¢å™¨è¨­è¨ˆï¼Œè©²æ¿¾æ³¢å™¨å¯ä»¥æœ‰æ•ˆéæ¿¾æ‰è¼¸å…¥ä¿¡è™Ÿä¸­çš„çŸ­æš«æ¯›åˆºï¼Œæé«˜ç³»çµ±çš„ç©©å®šæ€§ã€‚\nå°ˆæ¡ˆæ¶æ§‹ #\rRTLä»£ç¢¼å¯¦ç¾ #\rä»¥ä¸‹æ˜¯å®Œæ•´çš„Verilog RTLä»£ç¢¼ï¼š\nmodule glitch_filter ( input clk, // ç³»çµ±æ™‚è„ˆè¼¸å…¥ input nRst, // ä½é›»ä½æœ‰æ•ˆçš„é‡ç½®ä¿¡è™Ÿ input iSignal, // éœ€è¦é€²è¡Œæ¿¾æ³¢çš„è¼¸å…¥ä¿¡è™Ÿ output oSignal // ç¶“éæ¿¾æ³¢è™•ç†å¾Œçš„è¼¸å‡ºä¿¡è™Ÿ ); // å…§éƒ¨ä¿¡è™Ÿå®šç¾© reg [31:0] rvShiftSignal_d, rvShiftSignal_q; // 32ä½ç§»ä½æš«å­˜å™¨ï¼Œç”¨æ–¼å„²å­˜ä¿¡è™Ÿæ­·å² reg rSignal_d, rSignal_q; // è¼¸å‡ºä¿¡è™Ÿçš„çµ„åˆé‚è¼¯å’Œæ™‚åºé‚è¼¯æš«å­˜å™¨ // ç¬¬ä¸€å€‹æ™‚åºé‚è¼¯å€å¡Šï¼šç§»ä½æš«å­˜å™¨çš„æ™‚åºæ§åˆ¶ always @(posedge clk or negedge nRst) begin if(!nRst) rvShiftSignal_q \u0026lt;= 32\u0026#39;hFFFFFFFF; // é‡ç½®æ™‚è¨­å®šç‚ºå…¨1ç‹€æ…‹ else rvShiftSignal_q \u0026lt;= rvShiftSignal_d; // æ­£å¸¸å·¥ä½œæ™‚æ›´æ–°ç§»ä½æš«å­˜å™¨ end // ç¬¬ä¸€å€‹çµ„åˆé‚è¼¯å€å¡Šï¼šç§»ä½æ“ä½œ always @(*) begin rvShiftSignal_d = {rvShiftSignal_q[30:0], iSignal}; // æ¯å€‹æ™‚è„ˆé€±æœŸå°‡è¼¸å…¥ä¿¡è™Ÿç§»å…¥æœ€ä½ä½ end // ç¬¬äºŒå€‹æ™‚åºé‚è¼¯å€å¡Šï¼šè¼¸å‡ºä¿¡è™Ÿçš„æ™‚åºæ§åˆ¶ always @(posedge clk or negedge nRst) begin if(!nRst) rSignal_q \u0026lt;= 1\u0026#39;b1; // é‡ç½®æ™‚è¼¸å‡ºä¿¡è™Ÿè¨­å®šç‚º1 else rSignal_q \u0026lt;= rSignal_d; // æ­£å¸¸å·¥ä½œæ™‚æ›´æ–°è¼¸å‡ºä¿¡è™Ÿ end // ç¬¬äºŒå€‹çµ„åˆé‚è¼¯å€å¡Šï¼šè¼¸å‡ºä¿¡è™Ÿçš„é‚è¼¯åˆ¤æ–· always @(*) begin if(rvShiftSignal_q == 32\u0026#39;hFFFFFFFF) // å¦‚æœç§»ä½æš«å­˜å™¨ä¸­å…¨æ˜¯1 rSignal_d = 1\u0026#39;b1; // è¼¸å‡ºè¨­å®šç‚º1 else if(rvShiftSignal_q == 32\u0026#39;h0) // å¦‚æœç§»ä½æš«å­˜å™¨ä¸­å…¨æ˜¯0 rSignal_d = 1\u0026#39;b0; // è¼¸å‡ºè¨­å®šç‚º0 else rSignal_d = rSignal_q; // å…¶ä»–æƒ…æ³ä¿æŒåŸç‹€æ…‹ end assign oSignal = rSignal_q; // å°‡å…§éƒ¨ä¿¡è™Ÿé€£æ¥åˆ°è¼¸å‡ºç«¯ endmodule æŠ€è¡“è¦é»èªªæ˜ #\r1. ç§»ä½æš«å­˜å™¨æ©Ÿåˆ¶ #\rä½¿ç”¨32ä½ç§»ä½æš«å­˜å™¨è¨˜éŒ„è¼¸å…¥ä¿¡è™Ÿçš„æ­·å²ç‹€æ…‹ æ¯å€‹æ™‚è„ˆé€±æœŸï¼Œæ–°çš„è¼¸å…¥ä¿¡è™Ÿè¢«ç§»å…¥æš«å­˜å™¨çš„æœ€ä½ä½ é€™æ¨£å¯ä»¥è§€å¯Ÿä¿¡è™Ÿåœ¨32å€‹æ™‚è„ˆé€±æœŸå…§çš„è®ŠåŒ– 2. æ¿¾æ³¢é‚è¼¯è¨­è¨ˆ #\råªæœ‰ç•¶ç§»ä½æš«å­˜å™¨ä¸­çš„æ‰€æœ‰ä½å…ƒéƒ½ç‚º1æ™‚ï¼Œè¼¸å‡ºæ‰æœƒè®Šç‚º1 åªæœ‰ç•¶ç§»ä½æš«å­˜å™¨ä¸­çš„æ‰€æœ‰ä½å…ƒéƒ½ç‚º0æ™‚ï¼Œè¼¸å‡ºæ‰æœƒè®Šç‚º0 å…¶ä»–æƒ…æ³ä¸‹ä¿æŒåŸæœ‰è¼¸å‡ºç‹€æ…‹ä¸è®Š 3. é‡ç½®æ©Ÿåˆ¶å¯¦ç¾ #\rç•¶é‡ç½®ä¿¡è™Ÿï¼ˆnRstï¼‰ç‚ºä½é›»ä½æ™‚ï¼š ç§»ä½æš«å­˜å™¨è¢«è¨­å®šç‚ºå…¨1ï¼ˆ32\u0026rsquo;hFFFFFFFFï¼‰ è¼¸å‡ºä¿¡è™Ÿè¢«è¨­å®šç‚º1 æ‡‰ç”¨å ´æ™¯ #\rè©²æ¯›åˆºæ¿¾æ³¢å™¨é©ç”¨æ–¼ä»¥ä¸‹å ´æ™¯ï¼š\næŒ‰éµå»å½ˆè·³ å¤–éƒ¨ä¿¡è™Ÿè¼¸å…¥è™•ç† éœ€è¦ç©©å®šä¿¡è™Ÿçš„æ§åˆ¶ç³»çµ± æ•¸ä½é›»è·¯ä¸­çš„é›œè¨Šè™•ç† æ”¹é€²å»ºè­° #\r1. å¯é…ç½®çš„æ¿¾æ³¢å¯¬åº¦ #\rmodule glitch_filter #( parameter WIDTH = 32 // å¯é…ç½®çš„ç§»ä½æš«å­˜å™¨å¯¬åº¦ )( input clk, input nRst, input iSignal, output oSignal ); reg [WIDTH-1:0] rvShiftSignal_d, rvShiftSignal_q; // ... å…¶é¤˜ä»£ç¢¼ç›¸åŒ endmodule æ³¨æ„äº‹é … #\ræ¿¾æ³¢å™¨çš„å»¶é²æ™‚é–“èˆ‡ç§»ä½æš«å­˜å™¨çš„ä½å…ƒæ•¸ç›¸é—œï¼Œæœ¬è¨­è¨ˆä¸­ç‚º32å€‹æ™‚è„ˆé€±æœŸ éœ€è¦æ ¹æ“šå¯¦éš›æ‡‰ç”¨å ´æ™¯èª¿æ•´ç§»ä½æš«å­˜å™¨çš„ä½å…ƒæ•¸ æ™‚è„ˆé »ç‡çš„é¸æ“‡éœ€è¦è€ƒæ…®å¯¦éš›ä¿¡è™Ÿçš„ç‰¹æ€§ æ¨¡æ“¬çµæœ #\ræ³¢å½¢æ¨¡æ“¬ #\rä¸Šåœ–ç‚ºä½¿ç”¨ModelSimé€²è¡Œçš„æ³¢å½¢æ¨¡æ“¬çµæœï¼Œå¾ä¸Šåˆ°ä¸‹ä¾åºç‚ºï¼š\nclkï¼šç³»çµ±æ™‚è„ˆä¿¡è™Ÿ nRstï¼šé‡ç½®ä¿¡è™Ÿ iSignalï¼šè¼¸å…¥ä¿¡è™Ÿï¼ˆåŒ…å«æ¯›åˆºï¼‰ oSignalï¼šæ¿¾æ³¢å¾Œçš„è¼¸å‡ºä¿¡è™Ÿ æ¨¡æ“¬æƒ…å¢ƒèªªæ˜ #\ræ¯›åˆºæ¿¾é™¤æ¸¬è©¦\nè¼¸å…¥ä¿¡è™Ÿ(iSignal)åŒ…å«å¤šå€‹çŸ­æš«çš„æ¯›åˆºï¼ˆå°æ–¼32å€‹æ™‚è„ˆé€±æœŸï¼‰ è¼¸å‡ºä¿¡è™Ÿ(oSignal)ä¿æŒç©©å®šï¼ŒæˆåŠŸæ¿¾é™¤é€™äº›æ¯›åˆº å¯¦æ¸¬çµæœé¡¯ç¤ºï¼Œå¯¬åº¦å°æ–¼32å€‹æ™‚è„ˆé€±æœŸçš„æ¯›åˆºéƒ½è¢«æœ‰æ•ˆæ¿¾é™¤ æ­£å¸¸ä¿¡è™ŸéŸ¿æ‡‰\nç•¶è¼¸å…¥ä¿¡è™Ÿä¿æŒç©©å®šè¶…é32å€‹æ™‚è„ˆé€±æœŸ è¼¸å‡ºä¿¡è™Ÿæ‰æœƒè·Ÿéš¨è®ŠåŒ– é©—è­‰äº†è¨­è¨ˆçš„ç©©å®šæ€§è¦æ±‚ é‡ç½®åŠŸèƒ½é©—è­‰\né‡ç½®ä¿¡è™Ÿ(nRst)è§¸ç™¼æ™‚ è¼¸å‡ºç«‹å³å›åˆ°é è¨­ç‹€æ…‹ï¼ˆé«˜é›»ä½ï¼‰ ç§»ä½æš«å­˜å™¨æ­£ç¢ºæ¸…é™¤ç‚ºå…¨1 é—œéµæ€§èƒ½æŒ‡æ¨™ #\rå»¶é²ç‰¹æ€§\nä¿¡è™Ÿè®ŠåŒ–å»¶é²ï¼š32å€‹æ™‚è„ˆé€±æœŸ é‡ç½®éŸ¿æ‡‰æ™‚é–“ï¼š1å€‹æ™‚è„ˆé€±æœŸ è³‡æºä½¿ç”¨\nä½¿ç”¨32ä½å…ƒç§»ä½æš«å­˜å™¨ ç°¡å–®çš„çµ„åˆé‚è¼¯é›»è·¯ æ•´é«”è³‡æºä½¿ç”¨ç‡ä½ çµèª #\ré€™å€‹æ¯›åˆºæ¿¾æ³¢å™¨è¨­è¨ˆç°¡å–®ä½†æ•ˆæœé¡¯è‘—ï¼Œé€šéç§»ä½æš«å­˜å™¨å’Œç‹€æ…‹æ©Ÿåˆ¶å¯¦ç¾äº†å°è¼¸å…¥ä¿¡è™Ÿçš„æœ‰æ•ˆæ¿¾æ³¢ã€‚åœ¨å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œå¯ä»¥æ ¹æ“šå…·é«”éœ€æ±‚èª¿æ•´åƒæ•¸ï¼Œä½¿å…¶æ›´å¥½åœ°é©æ‡‰ä¸åŒçš„æ‡‰ç”¨å ´æ™¯ã€‚å®Œæ•´çš„ç¨‹å¼ç¢¼å¯¦ç¾å’Œè©³ç´°çš„è¨»è§£ï¼Œæœ‰åŠ©æ–¼ç†è§£æ•¸å­—é›»è·¯è¨­è¨ˆä¸­çš„æ¿¾æ³¢å™¨å¯¦ç¾æ–¹æ³•ã€‚\n","date":"11 February 2025","externalUrl":null,"permalink":"/posts/digital_filter/","section":"Posts","summary":"\u003ch1 class=\"relative group\"\u003eğŸ”§ æ•¸å­—é›»è·¯æ¯›åˆºæ¿¾æ³¢å™¨è¨­è¨ˆèˆ‡å¯¦ç¾ \r\n    \u003cdiv id=\"-%E6%95%B8%E5%AD%97%E9%9B%BB%E8%B7%AF%E6%AF%9B%E5%88%BA%E6%BF%BE%E6%B3%A2%E5%99%A8%E8%A8%AD%E8%A8%88%E8%88%87%E5%AF%A6%E7%8F%BE\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#-%E6%95%B8%E5%AD%97%E9%9B%BB%E8%B7%AF%E6%AF%9B%E5%88%BA%E6%BF%BE%E6%B3%A2%E5%99%A8%E8%A8%AD%E8%A8%88%E8%88%87%E5%AF%A6%E7%8F%BE\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h1\u003e\r\n\r\n\r\n\u003ch2 class=\"relative group\"\u003eå‰è¨€ \r\n    \u003cdiv id=\"%E5%89%8D%E8%A8%80\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h2\u003e\r\n\u003cp\u003eåœ¨æ•¸ä½é›»è·¯è¨­è¨ˆä¸­ï¼Œä¿¡è™Ÿæ¯›åˆºï¼ˆGlitchï¼‰æ˜¯ä¸€å€‹å¸¸è¦‹çš„å•é¡Œï¼Œå¸¸è¦‹æ–¼æŒ‰éµå»å½ˆè·³ã€å¤–éƒ¨ä¿¡è™Ÿè¼¸å…¥è™•ç†ã€éœ€è¦ç©©å®šä¿¡è™Ÿçš„æ§åˆ¶ç³»çµ±ã€æ•¸ä½é›»è·¯ä¸­çš„é›œè¨Šè™•ç†ç­‰ã€‚æœ¬æ–‡å°‡ä»‹ç´¹ä¸€å€‹ä½¿ç”¨Verilogå¯¦ç¾çš„æ¯›åˆºæ¿¾æ³¢å™¨è¨­è¨ˆï¼Œè©²æ¿¾æ³¢å™¨å¯ä»¥æœ‰æ•ˆéæ¿¾æ‰è¼¸å…¥ä¿¡è™Ÿä¸­çš„çŸ­æš«æ¯›åˆºï¼Œæé«˜ç³»çµ±çš„ç©©å®šæ€§ã€‚\u003c/p\u003e","title":"ğŸ”§ æ•¸å­—é›»è·¯æ¯›åˆºæ¿¾æ³¢å™¨è¨­è¨ˆèˆ‡å¯¦ç¾","type":"posts"},{"content":"","date":"11 February 2025","externalUrl":null,"permalink":"/tags/digital-filter/","section":"Tags","summary":"","title":"Digital Filter","type":"tags"},{"content":"\rğŸ¢ ROS2 å·¡é‚æœå‹™ç¯€é»é–‹ç™¼æ•™å­¸(ä½¿ç”¨ Service) #\rå‰è¨€ #\råœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å€‘å°‡å¯¦ä½œä¸€å€‹ ROS2 çš„å·¡é‚æœå‹™ç¯€é»ï¼Œé€é Service å’Œ Topic çš„çµåˆä¾†æ§åˆ¶ turtlesim ä¸­çš„çƒé¾œç§»å‹•åˆ°æŒ‡å®šä½ç½®ã€‚é€™å€‹å°ˆæ¡ˆå±•ç¤ºäº†å¦‚ä½•åœ¨ ROS2 ä¸­å¯¦ç¾æœå‹™ç«¯å’Œå®¢æˆ¶ç«¯çš„é€šä¿¡ï¼Œä»¥åŠåŸºæœ¬çš„é‹å‹•æ§åˆ¶ã€‚\nå°ˆæ¡ˆæ¶æ§‹ #\r1. æª”æ¡ˆçµæ§‹ #\rpatrol/\râ”œâ”€â”€ CMakeLists.txt # æ§‹å»ºé…ç½®æ–‡ä»¶\râ”œâ”€â”€ package.xml # åŒ…é…ç½®æ–‡ä»¶\râ”œâ”€â”€ src/\râ”‚ â””â”€â”€ service.cpp # æœå‹™ç¯€é»å¯¦ç¾\râ””â”€â”€ srv/\râ””â”€â”€ Patrol.srv # æœå‹™ä»‹é¢å®šç¾© 2. æœå‹™ä»‹é¢å®šç¾© #\r# Patrol.srv\rfloat64 target_x # ç›®æ¨™ X åº§æ¨™\rfloat64 target_y # ç›®æ¨™ Y åº§æ¨™\r---\rint8 SUCCESS = 1 # æˆåŠŸç‹€æ…‹ç¢¼\rint8 FAIL = 0 # å¤±æ•—ç‹€æ…‹ç¢¼\rint8 result # åŸ·è¡Œçµæœ 3. å®Œæ•´ç¨‹å¼ç¢¼å¯¦ç¾ #\r// åŒ…å«å¿…è¦çš„æ¨™é ­æ–‡ä»¶ #include \u0026#34;rclcpp/rclcpp.hpp\u0026#34; // ROS2 C++ å®¢æˆ¶ç«¯åº« #include \u0026#34;patrol/srv/patrol.hpp\u0026#34; // ç”Ÿæˆçš„æœå‹™ä»‹é¢ #include \u0026#34;geometry_msgs/msg/pose.hpp\u0026#34; // ä½ç½®è¨Šæ¯ #include \u0026#34;turtlesim/msg/pose.hpp\u0026#34; // turtlesim ä½ç½®è¨Šæ¯ #include \u0026#34;geometry_msgs/msg/twist.hpp\u0026#34; // é€Ÿåº¦è¨Šæ¯ // å·¡é‚æœå‹™ç¯€é»é¡åˆ¥ï¼Œç¹¼æ‰¿è‡ª rclcpp::Node class PatrolService: public rclcpp::Node { private: // æˆå“¡è®Šé‡ double targetX_ {1.0}; // ç›®æ¨™ X åº§æ¨™ double targetY_ {1.0}; // ç›®æ¨™ Y åº§æ¨™ // ROS2 é€šä¿¡çµ„ä»¶ rclcpp::Service\u0026lt;patrol::srv::Patrol\u0026gt;::SharedPtr service_; // æœå‹™ turtlesim::msg::Pose::SharedPtr turtlePose_; // ç•¶å‰ä½ç½® rclcpp::Subscription\u0026lt;turtlesim::msg::Pose\u0026gt;::SharedPtr turtlePoseSub_; // ä½ç½®è¨‚é–±è€… rclcpp::Publisher\u0026lt;geometry_msgs::msg::Twist\u0026gt;::SharedPtr publisher_; // é€Ÿåº¦ç™¼å¸ƒè€… public: // å»ºæ§‹å‡½æ•¸ PatrolService(std::string nodeName); // è§£æ§‹å‡½æ•¸ ~PatrolService() = default; // æœå‹™å›èª¿å‡½æ•¸ void handle_patrol(const std::shared_ptr\u0026lt;patrol::srv::Patrol::Request\u0026gt; request, const std::shared_ptr\u0026lt;patrol::srv::Patrol::Response\u0026gt; response); // ç§»å‹•æ§åˆ¶å‡½æ•¸ void move_to_target(double targetX, double targetY); }; // å»ºæ§‹å‡½æ•¸å¯¦ç¾ PatrolService::PatrolService(std::string nodeName): Node(nodeName) { // å‰µå»ºä½ç½®è¨‚é–±è€… turtlePoseSub_ = this-\u0026gt;create_subscription\u0026lt;turtlesim::msg::Pose\u0026gt;( \u0026#34;/turtle1/pose\u0026#34;, 10, [this](const turtlesim::msg::Pose::SharedPtr msg) { turtlePose_ = msg; move_to_target(turtlePose_-\u0026gt;x, turtlePose_-\u0026gt;y); } ); // å‰µå»ºé€Ÿåº¦ç™¼å¸ƒè€… publisher_ = this-\u0026gt;create_publisher\u0026lt;geometry_msgs::msg::Twist\u0026gt;(\u0026#34;/turtle1/cmd_vel\u0026#34;, 10); // å‰µå»ºæœå‹™ service_ = this-\u0026gt;create_service\u0026lt;patrol::srv::Patrol\u0026gt;( \u0026#34;patrol\u0026#34;, std::bind(\u0026amp;PatrolService::handle_patrol, this, std::placeholders::_1, std::placeholders::_2) ); } // æœå‹™å›èª¿å‡½æ•¸å¯¦ç¾ void PatrolService::handle_patrol( const std::shared_ptr\u0026lt;patrol::srv::Patrol::Request\u0026gt; request, const std::shared_ptr\u0026lt;patrol::srv::Patrol::Response\u0026gt; response) { // æª¢æŸ¥ç›®æ¨™åº§æ¨™æ˜¯å¦åœ¨æœ‰æ•ˆç¯„åœå…§ï¼ˆ0-12ä¹‹é–“ï¼‰ if((request-\u0026gt;target_x \u0026gt; 0.0f \u0026amp;\u0026amp; request-\u0026gt;target_x \u0026lt; 12.0f) \u0026amp;\u0026amp; (request-\u0026gt;target_y \u0026gt; 0.0f \u0026amp;\u0026amp; request-\u0026gt;target_y \u0026lt; 12.0f)) { // æ›´æ–°ç›®æ¨™ä½ç½® targetX_ = request-\u0026gt;target_x; targetY_ = request-\u0026gt;target_y; response-\u0026gt;result = patrol::srv::Patrol::Response::SUCCESS; } else { // åº§æ¨™ç„¡æ•ˆ response-\u0026gt;result = patrol::srv::Patrol::Response::FAIL; } } // ç§»å‹•æ§åˆ¶å‡½æ•¸å¯¦ç¾ void PatrolService::move_to_target(double currentX, double currentY) { // å‰µå»ºé€Ÿåº¦è¨Šæ¯ auto twist = geometry_msgs::msg::Twist(); // è¨ˆç®—è·é›¢å’Œè§’åº¦ double dx = targetX_ - currentX; double dy = targetY_ - currentY; double distance = std::sqrt(dx * dx + dy * dy); double target_angle = std::atan2(dy, dx); // å¦‚æœè·é›¢å¤§æ–¼é–¾å€¼ï¼Œå‰‡ç§»å‹• if (distance \u0026gt; 0.1) { // è¨ˆç®—è§’åº¦å·® double angle_diff = target_angle - turtlePose_-\u0026gt;theta; // è§’åº¦æ­¸ä¸€åŒ– if (angle_diff \u0026gt; M_PI) angle_diff -= 2 * M_PI; if (angle_diff \u0026lt; -M_PI) angle_diff += 2 * M_PI; // è¨­ç½®è§’é€Ÿåº¦å’Œç·šé€Ÿåº¦ twist.angular.z = 1.0 * angle_diff; twist.linear.x = 0.5 * distance; // è¼¸å‡ºç•¶å‰ä½ç½®è³‡è¨Š RCLCPP_INFO(this-\u0026gt;get_logger(), \u0026#34;currentX: %f, currentY: %f\u0026#34;, currentX, currentY); // ç™¼å¸ƒé€Ÿåº¦å‘½ä»¤ publisher_-\u0026gt;publish(twist); } } // ä¸»å‡½æ•¸ int main(int argc, char **argv) { // åˆå§‹åŒ– ROS2 rclcpp::init(argc, argv); // å‰µå»ºæœå‹™ç¯€é» auto node = std::make_shared\u0026lt;PatrolService\u0026gt;(\u0026#34;patrol_service_node\u0026#34;); // é‹è¡Œç¯€é» rclcpp::spin(node); // é—œé–‰ ROS2 rclcpp::shutdown(); return 0; } 4. é…ç½®æ–‡ä»¶èªªæ˜ #\r4.1 CMakeLists.txt #\r# æŒ‡å®š CMake æœ€ä½ç‰ˆæœ¬è¦æ±‚ cmake_minimum_required(VERSION 3.8) # å®šç¾©å°ˆæ¡ˆåç¨± project(patrol) # å¦‚æœä½¿ç”¨ GCC æˆ– Clang ç·¨è­¯å™¨ï¼Œæ·»åŠ ç·¨è­¯è­¦å‘Šé¸é … if(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES \u0026#34;Clang\u0026#34;) add_compile_options(-Wall -Wextra -Wpedantic) endif() # å°‹æ‰¾ä¸¦è¼‰å…¥æ‰€éœ€çš„ä¾è³´å¥—ä»¶ find_package(ament_cmake REQUIRED) # ROS 2 CMake å·¥å…· find_package(rclcpp REQUIRED) # ROS 2 C++ å®¢æˆ¶ç«¯ç¨‹å¼åº« find_package(std_msgs REQUIRED) # æ¨™æº–è¨Šæ¯é¡å‹ find_package(rosidl_default_generators REQUIRED)# æœå‹™ä»‹é¢ç”Ÿæˆå™¨ find_package(turtlesim REQUIRED) # çƒé¾œæ¨¡æ“¬å™¨å¥—ä»¶ find_package(geometry_msgs REQUIRED) # å¹¾ä½•è¨Šæ¯é¡å‹ # ç”Ÿæˆæœå‹™ä»‹é¢ rosidl_generate_interfaces(${PROJECT_NAME} \u0026#34;srv/Patrol.srv\u0026#34; ) # å‰µå»ºå¯åŸ·è¡Œæª” add_executable(service_node src/service.cpp) # ç‚ºå¯åŸ·è¡Œæª”æ·»åŠ ä¾è³´ ament_target_dependencies(service_node rclcpp # ROS 2 C++ å®¢æˆ¶ç«¯ç¨‹å¼åº« std_msgs # æ¨™æº–è¨Šæ¯é¡å‹ geometry_msgs # å¹¾ä½•è¨Šæ¯é¡å‹ turtlesim # çƒé¾œæ¨¡æ“¬å™¨å¥—ä»¶ ) # å®‰è£å¯åŸ·è¡Œæª”åˆ°æŒ‡å®šç›®éŒ„ install(TARGETS service_node DESTINATION lib/${PROJECT_NAME} ) # å®Œæˆ ament å¥—ä»¶çš„é…ç½® ament_package() 4.2 package.xml #\r\u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt; \u0026lt;!-- æŒ‡å®š XML æ¨¡å¼å®šç¾©ï¼ˆXSDï¼‰æª”æ¡ˆçš„ä½ç½®ï¼Œç”¨æ–¼é©—è­‰æ­¤æª”æ¡ˆçš„æ ¼å¼ --\u0026gt; \u0026lt;?xml-model href=\u0026#34;http://download.ros.org/schema/package_format3.xsd\u0026#34; schematypens=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34;?\u0026gt; \u0026lt;!-- ROS 2 å¥—ä»¶é…ç½®æª”æ¡ˆï¼Œä½¿ç”¨æ ¼å¼ç‰ˆæœ¬ 3 --\u0026gt; \u0026lt;package format=\u0026#34;3\u0026#34;\u0026gt; \u0026lt;!-- å¥—ä»¶åŸºæœ¬è³‡è¨Š --\u0026gt; \u0026lt;name\u0026gt;patrol\u0026lt;/name\u0026gt; \u0026lt;!-- å¥—ä»¶åç¨± --\u0026gt; \u0026lt;version\u0026gt;0.0.0\u0026lt;/version\u0026gt; \u0026lt;!-- å¥—ä»¶ç‰ˆæœ¬ --\u0026gt; \u0026lt;description\u0026gt;TODO: Package description\u0026lt;/description\u0026gt; \u0026lt;!-- å¥—ä»¶æè¿° --\u0026gt; \u0026lt;maintainer email=\u0026#34;tienyao@todo.todo\u0026#34;\u0026gt;tienyao\u0026lt;/maintainer\u0026gt; \u0026lt;!-- ç¶­è­·è€…è³‡è¨Š --\u0026gt; \u0026lt;license\u0026gt;TODO: License declaration\u0026lt;/license\u0026gt; \u0026lt;!-- æˆæ¬Šè²æ˜ --\u0026gt; \u0026lt;!-- å»ºæ§‹å·¥å…·ä¾è³´ --\u0026gt; \u0026lt;buildtool_depend\u0026gt;ament_cmake\u0026lt;/buildtool_depend\u0026gt; \u0026lt;!-- ä½¿ç”¨ ament_cmake ä½œç‚ºå»ºæ§‹å·¥å…· --\u0026gt; \u0026lt;!-- å»ºæ§‹æ™‚ä¾è³´ --\u0026gt; \u0026lt;build_depend\u0026gt;rosidl_default_generators\u0026lt;/build_depend\u0026gt;\u0026lt;!-- ç”¨æ–¼ç”Ÿæˆä»‹é¢æª”æ¡ˆ --\u0026gt; \u0026lt;!-- åŸ·è¡Œæ™‚ä¾è³´ --\u0026gt; \u0026lt;exec_depend\u0026gt;rosidl_default_runtime\u0026lt;/exec_depend\u0026gt; \u0026lt;!-- åŸ·è¡Œæ™‚éœ€è¦çš„ä»‹é¢é‹è¡Œåº« --\u0026gt; \u0026lt;!-- å»ºæ§‹å’ŒåŸ·è¡Œéƒ½éœ€è¦çš„ä¾è³´ --\u0026gt; \u0026lt;depend\u0026gt;rclcpp\u0026lt;/depend\u0026gt; \u0026lt;!-- ROS 2 C++ å®¢æˆ¶ç«¯ç¨‹å¼åº« --\u0026gt; \u0026lt;depend\u0026gt;std_msgs\u0026lt;/depend\u0026gt; \u0026lt;!-- æ¨™æº–è¨Šæ¯é¡å‹ --\u0026gt; \u0026lt;depend\u0026gt;turtlesim\u0026lt;/depend\u0026gt; \u0026lt;!-- çƒé¾œæ¨¡æ“¬å™¨å¥—ä»¶ --\u0026gt; \u0026lt;depend\u0026gt;geometry_msgs\u0026lt;/depend\u0026gt; \u0026lt;!-- å¹¾ä½•è¨Šæ¯é¡å‹ --\u0026gt; \u0026lt;!-- è²æ˜æ­¤å¥—ä»¶æ˜¯ä¸€å€‹ä»‹é¢å¥—ä»¶ --\u0026gt; \u0026lt;member_of_group\u0026gt;rosidl_interface_packages\u0026lt;/member_of_group\u0026gt; \u0026lt;!-- æ¸¬è©¦ç›¸é—œä¾è³´ --\u0026gt; \u0026lt;test_depend\u0026gt;ament_lint_auto\u0026lt;/test_depend\u0026gt; \u0026lt;!-- è‡ªå‹•åŒ–ç¨‹å¼ç¢¼æª¢æŸ¥å·¥å…· --\u0026gt; \u0026lt;test_depend\u0026gt;ament_lint_common\u0026lt;/test_depend\u0026gt; \u0026lt;!-- å¸¸ç”¨ç¨‹å¼ç¢¼æª¢æŸ¥è¦å‰‡ --\u0026gt; \u0026lt;!-- ROS 2 å¥—ä»¶ç‰¹å®šè³‡è¨Š --\u0026gt; \u0026lt;export\u0026gt; \u0026lt;build_type\u0026gt;ament_cmake\u0026lt;/build_type\u0026gt; \u0026lt;!-- æŒ‡å®šä½¿ç”¨ ament_cmake å»ºæ§‹ç³»çµ± --\u0026gt; \u0026lt;/export\u0026gt; \u0026lt;/package\u0026gt; åŸ·è¡Œæ–¹å¼ #\rç·¨è­¯å°ˆæ¡ˆ cd ros2_ws colcon build --packages-select patrol åŸ·è¡Œç¯€é» # çµ‚ç«¯æ©Ÿ 1ï¼šå•Ÿå‹• turtlesim ros2 run turtlesim turtlesim_node # çµ‚ç«¯æ©Ÿ 2ï¼šå•Ÿå‹•å·¡é‚æœå‹™ ros2 run patrol patrol_service # çµ‚ç«¯æ©Ÿ 3ï¼šç™¼é€æœå‹™è«‹æ±‚ ros2 service call /patrol patrol/srv/Patrol \u0026#34;{target_x: 5.0, target_y: 5.0}\u0026#34; ä½¿ç”¨ RQT æ¸¬è©¦ #\rRQT æ˜¯ ROS çš„åœ–å½¢åŒ–å·¥å…·ï¼Œå¯ä»¥ç”¨ä¾†ç›£æ§å’Œæ¸¬è©¦ç¯€é»ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ RQT æ¸¬è©¦å·¡é‚æœå‹™çš„æ­¥é©Ÿï¼š\nå•Ÿå‹• RQT rqt ä½¿ç”¨ Service Caller\nåœ¨èœå–®ä¸­é¸æ“‡ Plugins -\u0026gt; Services -\u0026gt; Service Caller åœ¨ Service ä¸‹æ‹‰é¸å–®ä¸­é¸æ“‡ /patrol å¡«å…¥æ¸¬è©¦æ•¸æ“šï¼š { \u0026#34;target_x\u0026#34;: 5.0, \u0026#34;target_y\u0026#34;: 5.0 } é»æ“Š \u0026ldquo;Call\u0026rdquo; æŒ‰éˆ•ç™¼é€è«‹æ±‚ ä½¿ç”¨ Plot å·¥å…·ç›£æ§ä½ç½®\né¸æ“‡ Plugins -\u0026gt; Visualization -\u0026gt; Plot æ·»åŠ ä»¥ä¸‹è©±é¡Œé€²è¡Œç›£æ§ï¼š /turtle1/pose/xï¼šçƒé¾œçš„ X åº§æ¨™ /turtle1/pose/yï¼šçƒé¾œçš„ Y åº§æ¨™ /turtle1/pose/thetaï¼šçƒé¾œçš„è§’åº¦ ä½¿ç”¨ Topic Monitor\né¸æ“‡ Plugins -\u0026gt; Topics -\u0026gt; Topic Monitor å¯ä»¥ç›£æ§ä»¥ä¸‹è©±é¡Œï¼š /turtle1/cmd_velï¼šç™¼å¸ƒçš„é€Ÿåº¦å‘½ä»¤ /turtle1/poseï¼šçƒé¾œçš„ç•¶å‰ä½ç½® RQT ç›£æ§æˆªåœ–ç¤ºä¾‹ #\rRQT çš„å„ªå‹¢ #\råœ–å½¢åŒ–ä»‹é¢ï¼Œæ“ä½œç›´è§€ å³æ™‚æ•¸æ“šå¯è¦–åŒ– æ–¹ä¾¿é€²è¡Œæœå‹™æ¸¬è©¦ æ”¯æ´å¤šç¨®ç›£æ§å·¥å…· æŠ€è¡“è¦é»èªªæ˜ #\ræœå‹™é€šä¿¡æ©Ÿåˆ¶\nä½¿ç”¨ Service è™•ç†ä¸€æ¬¡æ€§è«‹æ±‚ é€šé Topic å¯¦ç¾é€£çºŒçš„ä½ç½®å’Œé€Ÿåº¦æ›´æ–° çµåˆåŒæ­¥ï¼ˆServiceï¼‰å’Œç•°æ­¥ï¼ˆTopicï¼‰é€šä¿¡ é‹å‹•æ§åˆ¶\nä½¿ç”¨æ¯”ä¾‹æ§åˆ¶å¯¦ç¾å¹³æ»‘ç§»å‹• è€ƒæ…®è§’åº¦é€£çºŒæ€§ï¼Œé¿å…çªè®Š è·é›¢å’Œè§’åº¦çš„å¯¦æ™‚è¨ˆç®— éŒ¯èª¤è™•ç†\næª¢æŸ¥åº§æ¨™ç¯„åœæœ‰æ•ˆæ€§ å›å‚³é©ç•¶çš„åŸ·è¡Œçµæœ ç§»å‹•é–¾å€¼æ§åˆ¶ æ”¹é€²å»ºè­° #\rPID æ§åˆ¶å„ªåŒ– // æ·»åŠ ç©åˆ†å’Œå¾®åˆ†é … class PatrolService { private: double angle_integral = 0.0; double last_angle_error = 0.0; void move_to_target() { double angle_error = target_angle - current_angle; angle_integral += angle_error; double angle_derivative = angle_error - last_angle_error; twist.angular.z = Kp * angle_error + Ki * angle_integral + Kd * angle_derivative; last_angle_error = angle_error; } }; è¶…æ™‚è™•ç† class PatrolService { private: rclcpp::Time start_time_; const double timeout_duration_ = 10.0; // 10 ç§’è¶…æ™‚ bool move_timeout() { return (this-\u0026gt;now() - start_time_).seconds() \u0026gt; timeout_duration_; } void handle_patrol() { start_time_ = this-\u0026gt;now(); if (move_timeout()) { response-\u0026gt;result = patrol::srv::Patrol::Response::FAIL; return; } } }; åƒè€ƒè³‡æº #\rROS2 Service æ•™ç¨‹ turtlesim æ–‡æª” çµèª #\ré€éé€™å€‹å°ˆæ¡ˆï¼Œæˆ‘å€‘å­¸ç¿’äº†å¦‚ä½•åœ¨ ROS2 ä¸­çµåˆ Service å’Œ Topic ä¾†å¯¦ç¾æ©Ÿå™¨äººçš„é‹å‹•æ§åˆ¶ã€‚é€™ç¨®çµåˆä¸åŒé€šä¿¡æ©Ÿåˆ¶çš„æ–¹å¼ï¼Œèƒ½å¤ æ›´éˆæ´»åœ°è™•ç†å„ç¨®æ§åˆ¶éœ€æ±‚ã€‚å®Œæ•´çš„ç¨‹å¼ç¢¼å¯¦ç¾å’Œè©³ç´°çš„æ³¨è§£ï¼Œæœ‰åŠ©æ–¼ç†è§£ ROS2 çš„æ ¸å¿ƒæ¦‚å¿µå’Œå¯¦ä½œæ–¹æ³•ã€‚\n","date":"11 February 2025","externalUrl":null,"permalink":"/posts/ros2_service_node/","section":"Posts","summary":"\u003ch1 class=\"relative group\"\u003eğŸ¢ ROS2 å·¡é‚æœå‹™ç¯€é»é–‹ç™¼æ•™å­¸(ä½¿ç”¨ Service) \r\n    \u003cdiv id=\"-ros2-%E5%B7%A1%E9%82%8F%E6%9C%8D%E5%8B%99%E7%AF%80%E9%BB%9E%E9%96%8B%E7%99%BC%E6%95%99%E5%AD%B8%E4%BD%BF%E7%94%A8-service\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#-ros2-%E5%B7%A1%E9%82%8F%E6%9C%8D%E5%8B%99%E7%AF%80%E9%BB%9E%E9%96%8B%E7%99%BC%E6%95%99%E5%AD%B8%E4%BD%BF%E7%94%A8-service\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h1\u003e\r\n\r\n\r\n\u003ch2 class=\"relative group\"\u003eå‰è¨€ \r\n    \u003cdiv id=\"%E5%89%8D%E8%A8%80\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h2\u003e\r\n\u003cp\u003eåœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å€‘å°‡å¯¦ä½œä¸€å€‹ ROS2 çš„å·¡é‚æœå‹™ç¯€é»ï¼Œé€é Service å’Œ Topic çš„çµåˆä¾†æ§åˆ¶ turtlesim ä¸­çš„çƒé¾œç§»å‹•åˆ°æŒ‡å®šä½ç½®ã€‚é€™å€‹å°ˆæ¡ˆå±•ç¤ºäº†å¦‚ä½•åœ¨ ROS2 ä¸­å¯¦ç¾æœå‹™ç«¯å’Œå®¢æˆ¶ç«¯çš„é€šä¿¡ï¼Œä»¥åŠåŸºæœ¬çš„é‹å‹•æ§åˆ¶ã€‚\u003c/p\u003e","title":"ğŸ¢ ROS2 å·¡é‚æœå‹™ç¯€é»é–‹ç™¼æ•™å­¸(ä½¿ç”¨ Service)","type":"posts"},{"content":"\rğŸš€ ROS2 Launch æª”æ¡ˆå»ºç«‹ #\r1. Launch æª”æ¡ˆç°¡ä»‹ #\rLaunch æª”æ¡ˆå…è¨±æ‚¨åŒæ™‚å•Ÿå‹•å¤šå€‹ ROS2 ç¯€é»ï¼Œç°¡åŒ–äº†æ“ä½œæµç¨‹ã€‚\n2. åŸºæœ¬çµæ§‹ #\r2.1 æª”æ¡ˆä½ç½® #\ryour_package/ â”œâ”€â”€ launch/ â”‚ â””â”€â”€ multi_turtles.launch.py â””â”€â”€ setup.py 2.2 åŸºæœ¬ç¯„ä¾‹ #\r# å°å…¥å¿…è¦çš„å¥—ä»¶ import launch # å°å…¥ launch æ ¸å¿ƒåŠŸèƒ½ import launch_ros # å°å…¥ ROS2 ç›¸é—œçš„ launch åŠŸèƒ½ def generate_launch_description(): # å‰µå»ºç¬¬ä¸€å€‹çƒé¾œç¯€é» action_node_turtle0 = launch_ros.actions.Node( package=\u0026#39;turtlesim\u0026#39;, # å¥—ä»¶åç¨± executable=\u0026#39;turtlesim_node\u0026#39;, # å¯åŸ·è¡Œæª”åç¨± output=\u0026#39;both\u0026#39;, # è¼¸å‡ºæ–¹å¼ï¼šåŒæ™‚è¼¸å‡ºåˆ°çµ‚ç«¯å’Œæ—¥èªŒ ) # å‰µå»ºç¬¬äºŒå€‹çƒé¾œç¯€é» action_node_turtle1 = launch_ros.actions.Node( package=\u0026#39;turtlesim\u0026#39;, # å¥—ä»¶åç¨± executable=\u0026#39;turtlesim_node\u0026#39;, # å¯åŸ·è¡Œæª”åç¨± output=\u0026#39;both\u0026#39;, # è¼¸å‡ºæ–¹å¼ï¼šåŒæ™‚è¼¸å‡ºåˆ°çµ‚ç«¯å’Œæ—¥èªŒ ) # å‰µå»ºç¬¬ä¸‰å€‹çƒé¾œç¯€é» action_node_turtle2 = launch_ros.actions.Node( package=\u0026#39;turtlesim\u0026#39;, # å¥—ä»¶åç¨± executable=\u0026#39;turtlesim_node\u0026#39;, # å¯åŸ·è¡Œæª”åç¨± output=\u0026#39;both\u0026#39;, # è¼¸å‡ºæ–¹å¼ï¼šåŒæ™‚è¼¸å‡ºåˆ°çµ‚ç«¯å’Œæ—¥èªŒ ) # å‰µå»º launch æè¿°å°è±¡ï¼ŒåŒ…å«æ‰€æœ‰ç¯€é» launch_description = launch.LaunchDescription([ action_node_turtle0, # æ·»åŠ ç¬¬ä¸€å€‹çƒé¾œç¯€é» action_node_turtle1, # æ·»åŠ ç¬¬äºŒå€‹çƒé¾œç¯€é» action_node_turtle2, # æ·»åŠ ç¬¬ä¸‰å€‹çƒé¾œç¯€é» ]) # è¿”å› launch æè¿°å°è±¡ return launch_description 2.3 CMakeLists.txt é…ç½® #\rä¸»è¦é…ç½®åŒ…æ‹¬ï¼š\nå°ˆæ¡ˆåç¨±å’Œç‰ˆæœ¬è¦æ±‚ ä¾è³´å¥—ä»¶é…ç½® å¯åŸ·è¡Œæª”ç·¨è­¯è¨­å®š å®‰è£è·¯å¾‘é…ç½® ç‰¹åˆ¥æ³¨æ„ä»¥ä¸‹å®‰è£é…ç½®ï¼š\n# å®‰è£å¯åŸ·è¡Œæª” install(TARGETS service_parameters_node client_parameters_node DESTINATION lib/${PROJECT_NAME} ) # å®‰è£å•Ÿå‹•æ–‡ä»¶ install(DIRECTORY launch DESTINATION share/${PROJECT_NAME} ) # å®Œæˆ ament å¥—ä»¶é…ç½® ament_package() é€™äº›é…ç½®ç¢ºä¿äº†ï¼š\nå¯åŸ·è¡Œæª”è¢«æ­£ç¢ºå®‰è£åˆ°æŒ‡å®šç›®éŒ„ å•Ÿå‹•æ–‡ä»¶ï¼ˆlaunch filesï¼‰è¢«å®‰è£åˆ°å…±äº«ç›®éŒ„ å¥—ä»¶é…ç½®æ­£ç¢ºå®Œæˆ 3. åƒæ•¸èªªæ˜ #\r3.1 Node åƒæ•¸ #\rpackage: å¥—ä»¶åç¨± executable: å¯åŸ·è¡Œæª”åç¨± output: è¼¸å‡ºæ–¹å¼ï¼ˆ\u0026lsquo;screen\u0026rsquo;, \u0026rsquo;log\u0026rsquo;, \u0026lsquo;both\u0026rsquo;ï¼‰ name: ç¯€é»åç¨±ï¼ˆå¯é¸ï¼‰ namespace: å‘½åç©ºé–“ï¼ˆå¯é¸ï¼‰ 3.2 å¸¸ç”¨é…ç½® #\r# è¨­å®šç¯€é»åç¨±å’Œå‘½åç©ºé–“ Node( package=\u0026#39;turtlesim\u0026#39;, # å¥—ä»¶åç¨± executable=\u0026#39;turtlesim_node\u0026#39;, # å¯åŸ·è¡Œæª”åç¨± name=\u0026#39;turtle1\u0026#39;, # ç¯€é»åç¨± namespace=\u0026#39;group1\u0026#39; # å‘½åç©ºé–“ ) # æ·»åŠ åƒæ•¸é…ç½® Node( package=\u0026#39;turtlesim\u0026#39;, # å¥—ä»¶åç¨± executable=\u0026#39;turtlesim_node\u0026#39;, # å¯åŸ·è¡Œæª”åç¨± parameters=[{\u0026#39;background_r\u0026#39;: 255}, {\u0026#39;background_g\u0026#39;: 150}, {\u0026#39;background_b\u0026#39;: 50}] # è¨­å®šèƒŒæ™¯é¡è‰²åƒæ•¸ ) 4. ä½¿ç”¨æ–¹æ³• #\r4.1 åŸ·è¡Œ Launch æª”æ¡ˆ #\r# ç·¨è­¯å°ˆæ¡ˆ colcon build # åŸ·è¡Œ launch æª”æ¡ˆ ros2 launch your_package multi_turtles.launch.py 5. é€²éšåŠŸèƒ½ #\r5.1 æ¢ä»¶å¼å•Ÿå‹• #\r# å°å…¥å¿…è¦çš„æ¢ä»¶å’Œé…ç½®é¡åˆ¥ from launch.conditions import IfCondition from launch.substitutions import LaunchConfiguration # æ ¹æ“šæ¢ä»¶å•Ÿå‹•ç¯€é» Node( package=\u0026#39;turtlesim\u0026#39;, # å¥—ä»¶åç¨± executable=\u0026#39;turtlesim_node\u0026#39;, # å¯åŸ·è¡Œæª”åç¨± condition=IfCondition(LaunchConfiguration(\u0026#39;start_turtle\u0026#39;)) # æ¢ä»¶åˆ¤æ–· ) 5.2 ç¾¤çµ„ç®¡ç† #\r# å°å…¥å¿…è¦çš„é¡åˆ¥ from launch import LaunchDescription from launch_ros.actions import Node from launch.actions import GroupAction # å‰µå»ºç¯€é»ç¾¤çµ„ group = GroupAction([ Node(package=\u0026#39;turtlesim\u0026#39;, executable=\u0026#39;turtlesim_node\u0026#39;), # çƒé¾œæ¨¡æ“¬å™¨ç¯€é» Node(package=\u0026#39;turtlesim\u0026#39;, executable=\u0026#39;turtle_teleop_key\u0026#39;) # éµç›¤æ§åˆ¶ç¯€é» ]) ğŸ’¡ æç¤ºï¼š\nä½¿ç”¨ ros2 launch --show æŸ¥çœ‹ launch æª”æ¡ˆçš„é…ç½® å¯ä»¥åœ¨ launch æª”æ¡ˆä¸­åŒ…å«å…¶ä»– launch æª”æ¡ˆ å–„ç”¨å‘½åç©ºé–“é¿å…ç¯€é»åç¨±è¡çª ","date":"11 February 2025","externalUrl":null,"permalink":"/posts/c_array/","section":"Posts","summary":"\u003ch1 class=\"relative group\"\u003eğŸš€ ROS2 Launch æª”æ¡ˆå»ºç«‹ \r\n    \u003cdiv id=\"-ros2-launch-%E6%AA%94%E6%A1%88%E5%BB%BA%E7%AB%8B\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#-ros2-launch-%E6%AA%94%E6%A1%88%E5%BB%BA%E7%AB%8B\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h1\u003e\r\n\r\n\r\n\u003ch2 class=\"relative group\"\u003e1. Launch æª”æ¡ˆç°¡ä»‹ \r\n    \u003cdiv id=\"1-launch-%E6%AA%94%E6%A1%88%E7%B0%A1%E4%BB%8B\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#1-launch-%E6%AA%94%E6%A1%88%E7%B0%A1%E4%BB%8B\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h2\u003e\r\n\u003cp\u003eLaunch æª”æ¡ˆå…è¨±æ‚¨åŒæ™‚å•Ÿå‹•å¤šå€‹ ROS2 ç¯€é»ï¼Œç°¡åŒ–äº†æ“ä½œæµç¨‹ã€‚\u003c/p\u003e","title":"ğŸš€ ROS2 Launch æª”æ¡ˆå»ºç«‹","type":"posts"},{"content":"","date":"11 February 2025","externalUrl":null,"permalink":"/tags/array/","section":"Tags","summary":"","title":"Array","type":"tags"},{"content":"","date":"11 February 2025","externalUrl":null,"permalink":"/tags/c/","section":"Tags","summary":"","title":"C","type":"tags"},{"content":"","date":"11 February 2025","externalUrl":null,"permalink":"/categories/c/","section":"Categories","summary":"","title":"C","type":"categories"},{"content":"\rğŸš€ ROS2 Launch æª”æ¡ˆå»ºç«‹ #\r1. Launch æª”æ¡ˆç°¡ä»‹ #\rLaunch æª”æ¡ˆå…è¨±æ‚¨åŒæ™‚å•Ÿå‹•å¤šå€‹ ROS2 ç¯€é»ï¼Œç°¡åŒ–äº†æ“ä½œæµç¨‹ã€‚\n2. åŸºæœ¬çµæ§‹ #\r2.1 æª”æ¡ˆä½ç½® #\ryour_package/ â”œâ”€â”€ launch/ â”‚ â””â”€â”€ multi_turtles.launch.py â””â”€â”€ setup.py 2.2 åŸºæœ¬ç¯„ä¾‹ #\r# å°å…¥å¿…è¦çš„å¥—ä»¶ import launch # å°å…¥ launch æ ¸å¿ƒåŠŸèƒ½ import launch_ros # å°å…¥ ROS2 ç›¸é—œçš„ launch åŠŸèƒ½ def generate_launch_description(): # å‰µå»ºç¬¬ä¸€å€‹çƒé¾œç¯€é» action_node_turtle0 = launch_ros.actions.Node( package=\u0026#39;turtlesim\u0026#39;, # å¥—ä»¶åç¨± executable=\u0026#39;turtlesim_node\u0026#39;, # å¯åŸ·è¡Œæª”åç¨± output=\u0026#39;both\u0026#39;, # è¼¸å‡ºæ–¹å¼ï¼šåŒæ™‚è¼¸å‡ºåˆ°çµ‚ç«¯å’Œæ—¥èªŒ ) # å‰µå»ºç¬¬äºŒå€‹çƒé¾œç¯€é» action_node_turtle1 = launch_ros.actions.Node( package=\u0026#39;turtlesim\u0026#39;, # å¥—ä»¶åç¨± executable=\u0026#39;turtlesim_node\u0026#39;, # å¯åŸ·è¡Œæª”åç¨± output=\u0026#39;both\u0026#39;, # è¼¸å‡ºæ–¹å¼ï¼šåŒæ™‚è¼¸å‡ºåˆ°çµ‚ç«¯å’Œæ—¥èªŒ ) # å‰µå»ºç¬¬ä¸‰å€‹çƒé¾œç¯€é» action_node_turtle2 = launch_ros.actions.Node( package=\u0026#39;turtlesim\u0026#39;, # å¥—ä»¶åç¨± executable=\u0026#39;turtlesim_node\u0026#39;, # å¯åŸ·è¡Œæª”åç¨± output=\u0026#39;both\u0026#39;, # è¼¸å‡ºæ–¹å¼ï¼šåŒæ™‚è¼¸å‡ºåˆ°çµ‚ç«¯å’Œæ—¥èªŒ ) # å‰µå»º launch æè¿°å°è±¡ï¼ŒåŒ…å«æ‰€æœ‰ç¯€é» launch_description = launch.LaunchDescription([ action_node_turtle0, # æ·»åŠ ç¬¬ä¸€å€‹çƒé¾œç¯€é» action_node_turtle1, # æ·»åŠ ç¬¬äºŒå€‹çƒé¾œç¯€é» action_node_turtle2, # æ·»åŠ ç¬¬ä¸‰å€‹çƒé¾œç¯€é» ]) # è¿”å› launch æè¿°å°è±¡ return launch_description 2.3 CMakeLists.txt é…ç½® #\rä¸»è¦é…ç½®åŒ…æ‹¬ï¼š\nå°ˆæ¡ˆåç¨±å’Œç‰ˆæœ¬è¦æ±‚ ä¾è³´å¥—ä»¶é…ç½® å¯åŸ·è¡Œæª”ç·¨è­¯è¨­å®š å®‰è£è·¯å¾‘é…ç½® ç‰¹åˆ¥æ³¨æ„ä»¥ä¸‹å®‰è£é…ç½®ï¼š\n# å®‰è£å¯åŸ·è¡Œæª” install(TARGETS service_parameters_node client_parameters_node DESTINATION lib/${PROJECT_NAME} ) # å®‰è£å•Ÿå‹•æ–‡ä»¶ install(DIRECTORY launch DESTINATION share/${PROJECT_NAME} ) # å®Œæˆ ament å¥—ä»¶é…ç½® ament_package() é€™äº›é…ç½®ç¢ºä¿äº†ï¼š\nå¯åŸ·è¡Œæª”è¢«æ­£ç¢ºå®‰è£åˆ°æŒ‡å®šç›®éŒ„ å•Ÿå‹•æ–‡ä»¶ï¼ˆlaunch filesï¼‰è¢«å®‰è£åˆ°å…±äº«ç›®éŒ„ å¥—ä»¶é…ç½®æ­£ç¢ºå®Œæˆ 3. åƒæ•¸èªªæ˜ #\r3.1 Node åƒæ•¸ #\rpackage: å¥—ä»¶åç¨± executable: å¯åŸ·è¡Œæª”åç¨± output: è¼¸å‡ºæ–¹å¼ï¼ˆ\u0026lsquo;screen\u0026rsquo;, \u0026rsquo;log\u0026rsquo;, \u0026lsquo;both\u0026rsquo;ï¼‰ name: ç¯€é»åç¨±ï¼ˆå¯é¸ï¼‰ namespace: å‘½åç©ºé–“ï¼ˆå¯é¸ï¼‰ 3.2 å¸¸ç”¨é…ç½® #\r# è¨­å®šç¯€é»åç¨±å’Œå‘½åç©ºé–“ Node( package=\u0026#39;turtlesim\u0026#39;, # å¥—ä»¶åç¨± executable=\u0026#39;turtlesim_node\u0026#39;, # å¯åŸ·è¡Œæª”åç¨± name=\u0026#39;turtle1\u0026#39;, # ç¯€é»åç¨± namespace=\u0026#39;group1\u0026#39; # å‘½åç©ºé–“ ) # æ·»åŠ åƒæ•¸é…ç½® Node( package=\u0026#39;turtlesim\u0026#39;, # å¥—ä»¶åç¨± executable=\u0026#39;turtlesim_node\u0026#39;, # å¯åŸ·è¡Œæª”åç¨± parameters=[{\u0026#39;background_r\u0026#39;: 255}, {\u0026#39;background_g\u0026#39;: 150}, {\u0026#39;background_b\u0026#39;: 50}] # è¨­å®šèƒŒæ™¯é¡è‰²åƒæ•¸ ) 4. ä½¿ç”¨æ–¹æ³• #\r4.1 åŸ·è¡Œ Launch æª”æ¡ˆ #\r# ç·¨è­¯å°ˆæ¡ˆ colcon build # åŸ·è¡Œ launch æª”æ¡ˆ ros2 launch your_package multi_turtles.launch.py 5. é€²éšåŠŸèƒ½ #\r5.1 æ¢ä»¶å¼å•Ÿå‹• #\r# å°å…¥å¿…è¦çš„æ¢ä»¶å’Œé…ç½®é¡åˆ¥ from launch.conditions import IfCondition from launch.substitutions import LaunchConfiguration # æ ¹æ“šæ¢ä»¶å•Ÿå‹•ç¯€é» Node( package=\u0026#39;turtlesim\u0026#39;, # å¥—ä»¶åç¨± executable=\u0026#39;turtlesim_node\u0026#39;, # å¯åŸ·è¡Œæª”åç¨± condition=IfCondition(LaunchConfiguration(\u0026#39;start_turtle\u0026#39;)) # æ¢ä»¶åˆ¤æ–· ) 5.2 ç¾¤çµ„ç®¡ç† #\r# å°å…¥å¿…è¦çš„é¡åˆ¥ from launch import LaunchDescription from launch_ros.actions import Node from launch.actions import GroupAction # å‰µå»ºç¯€é»ç¾¤çµ„ group = GroupAction([ Node(package=\u0026#39;turtlesim\u0026#39;, executable=\u0026#39;turtlesim_node\u0026#39;), # çƒé¾œæ¨¡æ“¬å™¨ç¯€é» Node(package=\u0026#39;turtlesim\u0026#39;, executable=\u0026#39;turtle_teleop_key\u0026#39;) # éµç›¤æ§åˆ¶ç¯€é» ]) ğŸ’¡ æç¤ºï¼š\nä½¿ç”¨ ros2 launch --show æŸ¥çœ‹ launch æª”æ¡ˆçš„é…ç½® å¯ä»¥åœ¨ launch æª”æ¡ˆä¸­åŒ…å«å…¶ä»– launch æª”æ¡ˆ å–„ç”¨å‘½åç©ºé–“é¿å…ç¯€é»åç¨±è¡çª ","date":"11 February 2025","externalUrl":null,"permalink":"/posts/ros2_launch_file_create/","section":"Posts","summary":"\u003ch1 class=\"relative group\"\u003eğŸš€ ROS2 Launch æª”æ¡ˆå»ºç«‹ \r\n    \u003cdiv id=\"-ros2-launch-%E6%AA%94%E6%A1%88%E5%BB%BA%E7%AB%8B\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#-ros2-launch-%E6%AA%94%E6%A1%88%E5%BB%BA%E7%AB%8B\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h1\u003e\r\n\r\n\r\n\u003ch2 class=\"relative group\"\u003e1. Launch æª”æ¡ˆç°¡ä»‹ \r\n    \u003cdiv id=\"1-launch-%E6%AA%94%E6%A1%88%E7%B0%A1%E4%BB%8B\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#1-launch-%E6%AA%94%E6%A1%88%E7%B0%A1%E4%BB%8B\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h2\u003e\r\n\u003cp\u003eLaunch æª”æ¡ˆå…è¨±æ‚¨åŒæ™‚å•Ÿå‹•å¤šå€‹ ROS2 ç¯€é»ï¼Œç°¡åŒ–äº†æ“ä½œæµç¨‹ã€‚\u003c/p\u003e","title":"ğŸš€ ROS2 Launch æª”æ¡ˆå»ºç«‹","type":"posts"},{"content":"","date":"11 February 2025","externalUrl":null,"permalink":"/tags/launch/","section":"Tags","summary":"","title":"Launch","type":"tags"},{"content":"\rğŸ” ROS2 GDB é™¤éŒ¯æ–¹æ³• #\r1. è¨­å®š CMake é™¤éŒ¯æ¨¡å¼ #\råœ¨ CMakeLists.txt ä¸­æ·»åŠ ä»¥ä¸‹è¨­å®šï¼š\nSET(CMAKE_BUILD_TYPE \u0026#34;Debug\u0026#34;) SET(CMAKE_CXX_FLAGS_DEBUG \u0026#34;$ENV{CXXFLAGS} -O0 -Wall -g -ggdb\u0026#34;) SET(CMAKE_CXX_FLAGS_RELEASE \u0026#34;$ENV{CXXFLAGS} -O3 -Wall\u0026#34;) è¨­å®šèªªæ˜ #\rCMAKE_BUILD_TYPE \u0026quot;Debug\u0026quot;: è¨­å®šç‚ºé™¤éŒ¯æ¨¡å¼ -O0: é—œé–‰ç·¨è­¯å„ªåŒ–ï¼Œæ–¹ä¾¿é™¤éŒ¯ -Wall: é–‹å•Ÿæ‰€æœ‰è­¦å‘Šè¨Šæ¯ -g -ggdb: ç”Ÿæˆé™¤éŒ¯è³‡è¨Š 2. ä½¿ç”¨ GDB é™¤éŒ¯ #\r2.1 å•Ÿå‹• GDB #\r# åˆ‡æ›åˆ°å¥—ä»¶ç›®éŒ„ cd path/to/your_package # å•Ÿå‹• GDB gdb your_package 2.2 é–‹å§‹é™¤éŒ¯ #\råœ¨ GDB æç¤ºç¬¦ä¸‹è¼¸å…¥ï¼š\n# åŸ·è¡Œç¨‹å¼ (gdb) r 3. å¸¸ç”¨ GDB æŒ‡ä»¤ #\råŸºæœ¬æ§åˆ¶ #\rr (run): åŸ·è¡Œç¨‹å¼ c (continue): ç¹¼çºŒåŸ·è¡Œ n (next): ä¸‹ä¸€æ­¥ s (step): é€²å…¥å‡½å¼ q (quit): é€€å‡º GDB ğŸ’¡ æç¤ºï¼š\nç¢ºä¿å…ˆç·¨è­¯å°ˆæ¡ˆå†é€²è¡Œé™¤éŒ¯ å¯ä»¥ä½¿ç”¨ bt æŸ¥çœ‹å‘¼å«å †ç–Š ä½¿ç”¨ help ç²å–æ›´å¤š GDB æŒ‡ä»¤èªªæ˜ ","date":"11 February 2025","externalUrl":null,"permalink":"/posts/ros2_gdb_debug/","section":"Posts","summary":"\u003ch1 class=\"relative group\"\u003eğŸ” ROS2 GDB é™¤éŒ¯æ–¹æ³• \r\n    \u003cdiv id=\"-ros2-gdb-%E9%99%A4%E9%8C%AF%E6%96%B9%E6%B3%95\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#-ros2-gdb-%E9%99%A4%E9%8C%AF%E6%96%B9%E6%B3%95\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h1\u003e\r\n\r\n\r\n\u003ch2 class=\"relative group\"\u003e1. è¨­å®š CMake é™¤éŒ¯æ¨¡å¼ \r\n    \u003cdiv id=\"1-%E8%A8%AD%E5%AE%9A-cmake-%E9%99%A4%E9%8C%AF%E6%A8%A1%E5%BC%8F\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#1-%E8%A8%AD%E5%AE%9A-cmake-%E9%99%A4%E9%8C%AF%E6%A8%A1%E5%BC%8F\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h2\u003e\r\n\u003cp\u003eåœ¨ \u003ccode\u003eCMakeLists.txt\u003c/code\u003e ä¸­æ·»åŠ ä»¥ä¸‹è¨­å®šï¼š\u003c/p\u003e","title":"ğŸ” ROS2 GDB é™¤éŒ¯æ–¹æ³• ","type":"posts"},{"content":"","date":"11 February 2025","externalUrl":null,"permalink":"/tags/gdb/","section":"Tags","summary":"","title":"GDB","type":"tags"},{"content":"","date":"10 February 2025","externalUrl":null,"permalink":"/tags/ros/","section":"Tags","summary":"","title":"ROS","type":"tags"},{"content":"","date":"10 February 2025","externalUrl":null,"permalink":"/categories/ros/","section":"Categories","summary":"","title":"ROS","type":"categories"},{"content":"\rğŸ¤– ROS2 å‰µå»ºç¯€é» #\r1. å»ºç«‹å·¥ä½œç©ºé–“ #\rmkdir -p ~/ros2_ws/src cd ~/ros2_ws/src 2. å‰µå»ºå¥—ä»¶ #\rros2 pkg create --build-type ament_cmake hello_pkg 3. ç·¨å¯«ç¯€é»ç¨‹å¼ç¢¼ #\rå»ºç«‹ C++ æºæ–‡ä»¶ #\råœ¨ ~/ros2_ws/src/hello_pkg/src ç›®éŒ„ä¸‹å‰µå»º hello_node.cppï¼š\n#include \u0026#34;rclcpp/rclcpp.hpp\u0026#34; #include \u0026lt;chrono\u0026gt; class HelloNode : public rclcpp::Node { public: HelloNode() : Node(\u0026#34;hello_node\u0026#34;) { timer_ = this-\u0026gt;create_wall_timer( std::chrono::seconds(1), std::bind(\u0026amp;HelloNode::hello, this) ); } private: void hello() { RCLCPP_INFO(this-\u0026gt;get_logger(), \u0026#34;hello world\u0026#34;); } rclcpp::TimerBase::SharedPtr timer_; }; int main(int argc, char **argv) { rclcpp::init(argc, argv); auto node = std::make_shared\u0026lt;HelloNode\u0026gt;(); rclcpp::spin(node); rclcpp::shutdown(); return 0; } ç¨‹å¼ç¢¼èªªæ˜ #\rHelloNode é¡ç¹¼æ‰¿è‡ª rclcpp::Node å»ºæ§‹å‡½å¼ä¸­å‰µå»ºä¸€å€‹è¨ˆæ™‚å™¨ï¼Œæ¯ç§’åŸ·è¡Œä¸€æ¬¡ hello() å‡½å¼è¼¸å‡º \u0026ldquo;hello world\u0026rdquo; è¨Šæ¯ main() å‡½å¼åˆå§‹åŒ– ROS2 ä¸¦é‹è¡Œç¯€é» 4. ä¿®æ”¹ CMakeLists.txt #\råœ¨ ~/ros2_ws/src/hello_pkg/CMakeLists.txt åŠ å…¥ï¼š\ncmake_minimum_required(VERSION 3.8) project(hello_pkg) # è¨­å®š C++ æ¨™æº– if(NOT CMAKE_CXX_STANDARD) set(CMAKE_CXX_STANDARD 14) endif() # å°‹æ‰¾ç›¸ä¾å¥—ä»¶ find_package(ament_cmake REQUIRED) find_package(rclcpp REQUIRED) # æ·»åŠ å¯åŸ·è¡Œæ–‡ä»¶ add_executable(hello_node src/hello_node.cpp) ament_target_dependencies(hello_node rclcpp) # å®‰è£è¨­å®š install(TARGETS hello_node DESTINATION lib/${PROJECT_NAME} ) ament_package() 5. ç·¨è­¯èˆ‡åŸ·è¡Œ #\rç·¨è­¯å¥—ä»¶ #\rcd ~/ros2_ws colcon build --packages-select hello_pkg è¨­å®šç’°å¢ƒè®Šæ•¸ #\rsource ~/ros2_ws/install/setup.bash åŸ·è¡Œç¯€é» #\rros2 run hello_pkg hello_node ç¨‹å¼åŸ·è¡Œçµæœ #\rä½ å°‡çœ‹åˆ°æ¯ç§’è¼¸å‡ºä¸€æ¬¡ï¼š\n[INFO] [hello_node]: hello world å¸¸è¦‹å•é¡Œè§£æ±º #\rç·¨è­¯éŒ¯èª¤\næª¢æŸ¥ CMakeLists.txt è¨­å®š ç¢ºèªæ‰€æœ‰ç›¸ä¾å¥—ä»¶å·²å®‰è£ åŸ·è¡ŒéŒ¯èª¤\nç¢ºèªç’°å¢ƒè®Šæ•¸å·²æ­£ç¢ºè¨­å®š æª¢æŸ¥ç¯€é»åç¨±æ˜¯å¦æ­£ç¢º é€²éšä¸»é¡Œ #\rä½¿ç”¨åƒæ•¸ ç™¼å¸ƒ/è¨‚é–±è©±é¡Œ æœå‹™å®¢æˆ¶ç«¯/ä¼ºæœå™¨ è‡ªå®šç¾©è¨Šæ¯é¡å‹ ğŸ’¡ æç¤ºï¼š\nä½¿ç”¨ ros2 node list æŸ¥çœ‹é‹è¡Œä¸­çš„ç¯€é» ä½¿ç”¨ ros2 node info /hello_node æŸ¥çœ‹ç¯€é»è³‡è¨Š å–„ç”¨ rclcpp çš„æ—¥èªŒåŠŸèƒ½é€²è¡Œé™¤éŒ¯ ","date":"10 February 2025","externalUrl":null,"permalink":"/posts/create_ros_node/","section":"Posts","summary":"\u003ch1 class=\"relative group\"\u003eğŸ¤– ROS2 å‰µå»ºç¯€é» \r\n    \u003cdiv id=\"-ros2-%E5%89%B5%E5%BB%BA%E7%AF%80%E9%BB%9E\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#-ros2-%E5%89%B5%E5%BB%BA%E7%AF%80%E9%BB%9E\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h1\u003e\r\n\r\n\r\n\u003ch2 class=\"relative group\"\u003e1. å»ºç«‹å·¥ä½œç©ºé–“ \r\n    \u003cdiv id=\"1-%E5%BB%BA%E7%AB%8B%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%96%93\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#1-%E5%BB%BA%E7%AB%8B%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%96%93\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h2\u003e\r\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p ~/ros2_ws/src\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e ~/ros2_ws/src\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n\r\n\u003ch2 class=\"relative group\"\u003e2. å‰µå»ºå¥—ä»¶ \r\n    \u003cdiv id=\"2-%E5%89%B5%E5%BB%BA%E5%A5%97%E4%BB%B6\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#2-%E5%89%B5%E5%BB%BA%E5%A5%97%E4%BB%B6\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h2\u003e\r\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eros2 pkg create --build-type ament_cmake hello_pkg\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n\r\n\u003ch2 class=\"relative group\"\u003e3. ç·¨å¯«ç¯€é»ç¨‹å¼ç¢¼ \r\n    \u003cdiv id=\"3-%E7%B7%A8%E5%AF%AB%E7%AF%80%E9%BB%9E%E7%A8%8B%E5%BC%8F%E7%A2%BC\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#3-%E7%B7%A8%E5%AF%AB%E7%AF%80%E9%BB%9E%E7%A8%8B%E5%BC%8F%E7%A2%BC\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h2\u003e\r\n\r\n\r\n\u003ch3 class=\"relative group\"\u003eå»ºç«‹ C++ æºæ–‡ä»¶ \r\n    \u003cdiv id=\"%E5%BB%BA%E7%AB%8B-c-%E6%BA%90%E6%96%87%E4%BB%B6\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#%E5%BB%BA%E7%AB%8B-c-%E6%BA%90%E6%96%87%E4%BB%B6\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h3\u003e\r\n\u003cp\u003eåœ¨ \u003ccode\u003e~/ros2_ws/src/hello_pkg/src\u003c/code\u003e ç›®éŒ„ä¸‹å‰µå»º \u003ccode\u003ehello_node.cpp\u003c/code\u003eï¼š\u003c/p\u003e","title":"ğŸ¤– ROS2 å‰µå»ºç¯€é»","type":"posts"},{"content":"\rğŸ¢ ROS2 å•Ÿå‹•å°æµ·é¾œ #\r1. å®‰è£ ROS2 Humble #\rå®‰è£æ­¥é©Ÿ #\ré¦–å…ˆè«‹ä¾ç…§å®˜æ–¹æ–‡ä»¶å®‰è£ ROS2 Humbleï¼š ROS2 Humble / Ubuntu (deb packages)\nè¨­å®šç’°å¢ƒè®Šæ•¸ï¼š\nsource /opt/ros/humble/setup.bash ğŸ’¡ å»ºè­°å°‡æ­¤å‘½ä»¤åŠ å…¥ ~/.bashrcï¼š\necho \u0026#34;source /opt/ros/humble/setup.bash\u0026#34; \u0026gt;\u0026gt; ~/.bashrc 2. å•Ÿå‹•å°æµ·é¾œæ¨¡æ“¬å™¨ #\råŸ·è¡Œæ¨¡æ“¬å™¨ #\råœ¨çµ‚ç«¯æ©Ÿè¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼š\nros2 run turtlesim turtlesim_node æŒ‡ä»¤èªªæ˜ #\rros2 runï¼šä½¿ç”¨ ros2 é‹è¡Œç¨‹åº turtlesimï¼šç¨‹åºåŒ…çš„åç¨± turtlesim_nodeï¼šå¯åŸ·è¡Œæ–‡ä»¶åç¨± 3. æ§åˆ¶å°æµ·é¾œ #\rå•Ÿå‹•æ§åˆ¶ç¨‹åº #\ré–‹å•Ÿæ–°çš„çµ‚ç«¯æ©Ÿ åŸ·è¡Œ source æŒ‡ä»¤ï¼š source /opt/ros/humble/setup.bash è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤å•Ÿå‹•éµç›¤æ§åˆ¶ï¼š ros2 run turtlesim turtle_teleop_key æ§åˆ¶èªªæ˜ #\rä½¿ç”¨æ–¹å‘éµæ§åˆ¶æµ·é¾œç§»å‹• Upï¼šå‘å‰ç§»å‹• Downï¼šå‘å¾Œç§»å‹• Leftï¼šå‘å·¦è½‰ Rightï¼šå‘å³è½‰ å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ #\r1. æ‰¾ä¸åˆ° ROS2 å‘½ä»¤ #\rè§£æ±ºæ–¹æ¡ˆï¼š\nç¢ºèª ROS2 å®‰è£æ˜¯å¦æˆåŠŸ æª¢æŸ¥ç’°å¢ƒè®Šæ•¸æ˜¯å¦æ­£ç¢ºè¨­å®š é‡æ–° source ç’°å¢ƒè¨­å®šæª” 2. ç„¡æ³•å•Ÿå‹•å°æµ·é¾œ #\rè§£æ±ºæ–¹æ¡ˆï¼š\nç¢ºèª turtlesim å¥—ä»¶æ˜¯å¦å®‰è£ æª¢æŸ¥ç³»çµ±è³‡æºä½¿ç”¨ç‹€æ³ æŸ¥çœ‹éŒ¯èª¤è¨Šæ¯ ç›¸é—œè³‡æº #\rROS2 å®˜æ–¹æ–‡ä»¶ Turtlesim æ•™å­¸ ROS2 æŒ‡ä»¤åƒè€ƒ ğŸ”” æ³¨æ„äº‹é …ï¼š\næ¯æ¬¡é–‹å•Ÿæ–°çµ‚ç«¯æ©Ÿéƒ½éœ€è¦é‡æ–° source ç’°å¢ƒè®Šæ•¸ ç¢ºä¿ç³»çµ±ç¬¦åˆ ROS2 çš„æœ€ä½éœ€æ±‚ å»ºè­°ä½¿ç”¨ Ubuntu 22.04 LTS ","date":"10 February 2025","externalUrl":null,"permalink":"/posts/turtle_launch/","section":"Posts","summary":"\u003ch1 class=\"relative group\"\u003eğŸ¢ ROS2 å•Ÿå‹•å°æµ·é¾œ \r\n    \u003cdiv id=\"-ros2-%E5%95%9F%E5%8B%95%E5%B0%8F%E6%B5%B7%E9%BE%9C\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#-ros2-%E5%95%9F%E5%8B%95%E5%B0%8F%E6%B5%B7%E9%BE%9C\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h1\u003e\r\n\r\n\r\n\u003ch2 class=\"relative group\"\u003e1. å®‰è£ ROS2 Humble \r\n    \u003cdiv id=\"1-%E5%AE%89%E8%A3%9D-ros2-humble\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#1-%E5%AE%89%E8%A3%9D-ros2-humble\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h2\u003e\r\n\r\n\r\n\u003ch3 class=\"relative group\"\u003eå®‰è£æ­¥é©Ÿ \r\n    \u003cdiv id=\"%E5%AE%89%E8%A3%9D%E6%AD%A5%E9%A9%9F\" class=\"anchor\"\u003e\u003c/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\"absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\"\u003e\r\n        \u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\"\r\n            style=\"text-decoration-line: none !important;\" href=\"#%E5%AE%89%E8%A3%9D%E6%AD%A5%E9%A9%9F\" aria-label=\"Anchor\"\u003e#\u003c/a\u003e\r\n    \u003c/span\u003e        \r\n    \r\n\u003c/h3\u003e\r\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eé¦–å…ˆè«‹ä¾ç…§å®˜æ–¹æ–‡ä»¶å®‰è£ ROS2 Humbleï¼š\n\u003ca href=\"https://docs.ros.org/en/humble/Installation/Ubuntu-Install-Debs.html\"title=\"å‰å¾€humbleå®‰è£æµç¨‹\" target=\"_blank\"\u003eROS2 Humble / Ubuntu (deb packages)\u003c/a\u003e\u003c/p\u003e","title":"ğŸ¢ ROS2 å•Ÿå‹•å°æµ·é¾œ","type":"posts"},{"content":"ğŸ‘¨â€ğŸ’» å·¥ç¨‹å¸«ä¸€å€‹ï¼Œå° FPGA/SoC FPGA/Verilog/C++/C/ROS éƒ½æœ‰èˆˆè¶£ ğŸ‘¨â€ğŸ’» An engineer with interests in FPGA/SoC FPGA/Verilog/C++/C/ROS\né€™å€‹ä¸–ç•Œæœ‰å¤ªå¤šå€¼å¾—å­¸ç¿’é …ç›®ï¼Œå› ç‚ºå­¸ä¸å®Œäº†æ‰€ä»¥é€™è£¡è¨˜éŒ„æˆ‘å­¸ç¿’éçš„ç—•è·¡ï¼Œå¿˜è¨˜å°±ä¾†é€™è£¡çœ‹çœ‹ã€‚\nğŸ“ è¨˜éŒ„æ—¥å¸¸å­¸ç¿’å¿ƒå¾—\nâ“ å•é¡Œè§£æ±ºç´€éŒ„\nğŸ“ˆ å­¸ç¿’æˆæœè¿½è¹¤\nğŸ“‚ è³‡æºæ•´ç†\nğŸ” çŸ¥è­˜åº«å­˜\n","date":"10 February 2025","externalUrl":null,"permalink":"/about/","section":"TienYao@Tech","summary":"\u003cp\u003eğŸ‘¨â€ğŸ’» å·¥ç¨‹å¸«ä¸€å€‹ï¼Œå° FPGA/SoC FPGA/Verilog/C++/C/ROS éƒ½æœ‰èˆˆè¶£\nğŸ‘¨â€ğŸ’» An engineer with interests in FPGA/SoC FPGA/Verilog/C++/C/ROS\u003c/p\u003e\n\u003cp\u003eé€™å€‹ä¸–ç•Œæœ‰å¤ªå¤šå€¼å¾—å­¸ç¿’é …ç›®ï¼Œå› ç‚ºå­¸ä¸å®Œäº†æ‰€ä»¥é€™è£¡è¨˜éŒ„æˆ‘å­¸ç¿’éçš„ç—•è·¡ï¼Œå¿˜è¨˜å°±ä¾†é€™è£¡çœ‹çœ‹ã€‚\u003c/p\u003e","title":"About","type":"page"},{"content":"","externalUrl":null,"permalink":"/series/","section":"Series","summary":"","title":"Series","type":"series"},{"content":"","externalUrl":null,"permalink":"/tienyao/","section":"Tienyao","summary":"","title":"Tienyao","type":"tienyao"}]